---
title: "R Notebook"
output: html_notebook
---


## Load required libraries
```{r, warning=FALSE, message=FALSE}
library(dplyr)
library(tidyr)
library(tidyverse)
library(tibble)
library(ggplot2)
library(reshape2)
library(ggtext)
library(gridExtra)
library(cowplot)
library(ComplexUpset)
library(plot.matrix)
library(ggstatsplot)
library(ggforce)
library(ggcorrplot)
library(GGally)
library(comprehenr)
library(dunn.test)
#(DescTools)
library(viridis)
library(RColorBrewer)
library(scico)
library(kableExtra)
```


## Get the input data
```{r}
# Set the Working Directory
wd <- "/home/aftimo/Documents/practiques/Documents_Elias/MasterAdriaMompart/Execute"

# Populations
Pops <- c("AFR", "EUR", "EAS")

# Imputation Methods
Imp.Methods <- c("Beagle", "Impute2", "Impute5", "Minimac4", "ScoreInvHap")

# Phasing Methods
Phase.Methods <- c("BEAGLE_Phase", "Shapeit_Phase", "Unphased")

# Filters
Filts <- c("0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")

# Get the imputed inversion names
Inversions <- read.table(paste0(wd,'/../VCFs/30X/Invs2Imp'),col.names = "INV")

# Get information about the inversions (type: NH/NAHR, breakpoints...) This has inversions not studied in the analysis!!
Inversion.Info <- read.csv(paste0(wd,'/../VCFs/30X/InvCoordenates_hg38_v1.csv'))

# Get the imputation results for the inversions
Imputation.Info <- read.csv(paste0(wd,"/Results_Stats/FullData_Imputation.txt"))
colnames(Imputation.Info) <- gsub("Standard", "BEAGLE_Phase", colnames(Imputation.Info))

# Get total number of individuals per inversion and population
Indivs.Info <- read.csv(paste0(wd,"/Results_Stats/Inv_Inds.txt"),sep = "\t")

# Get the number of individuals per filter for each inversion and population
Invs.Indiv.Info <- read.csv(paste0(wd,"/Results_Stats/Indiv_per_Filt.txt"))
colnames(Invs.Indiv.Info) <- gsub("Standard", "BEAGLE_Phase", colnames(Invs.Indiv.Info))

# Get the inversion frequency per population
AFR_Freq <- read.csv(paste0(wd,"/Results_Stats/Inversions_Freq_AFR.txt"), sep = "\t", header = FALSE, 
                     col.names = c("INV", "Freq"))
EUR_Freq <- read.csv(paste0(wd,"/Results_Stats/Inversions_Freq_EUR.txt"), sep = "\t", header = FALSE,
                     col.names = c("INV", "Freq"))
EAS_Freq <- read.csv(paste0(wd,"/Results_Stats/Inversions_Freq_EAS.txt"), sep = "\t", header = FALSE,
                     col.names = c("INV", "Freq"))


Inv.Freq <- cbind(AFR_Freq, EUR_Freq[2], EAS_Freq[2])
colnames(Inv.Freq) <- c("INV","AFR","EUR","EAS")

AFR_MAF <- read.csv(paste0(wd,"/Results_Stats/MAF_Freq_AFR.txt"), sep = "\t", header = FALSE, 
                     col.names = c("INV", "MAF"))
EUR_MAF <- read.csv(paste0(wd,"/Results_Stats/MAF_Freq_EUR.txt"), sep = "\t", header = FALSE,
                     col.names = c("INV", "MAF"))
EAS_MAF <- read.csv(paste0(wd,"/Results_Stats/MAF_Freq_EAS.txt"), sep = "\t", header = FALSE,
                     col.names = c("INV", "MAF"))


Inv.MAF <- cbind(AFR_MAF, EUR_MAF[2], EAS_MAF[2])
colnames(Inv.MAF) <- c("INV","AFR","EUR","EAS")


# Inv.Freq <- melt(Inv.Freq, id.vars = "INV", variable.name = "Population", value.name = "Freq")

# Get the inversion state per population (mono/polymorphic)
AFR_Info <- read.csv(paste0(wd,"/Results_Stats/Inversions_State_AFR.txt"), sep = "\t", header = FALSE)
EUR_Info <- read.csv(paste0(wd,"/Results_Stats/Inversions_State_EUR.txt"), sep = "\t", header = FALSE)
EAS_Info <- read.csv(paste0(wd,"/Results_Stats/Inversions_State_EAS.txt"), sep = "\t", header = FALSE)

# Get the number of SNPs per inversion
AFR_SNPs <- read.csv(paste0(wd,"/Results_Stats/Inversions_SNPs_AFR.txt"), sep = "\t", header = FALSE,
                     col.names = c("INV", "SNPs"))
EUR_SNPs <- read.csv(paste0(wd,"/Results_Stats/Inversions_SNPs_EUR.txt"), sep = "\t", header = FALSE,
                      col.names = c("INV", "SNPs"))
EAS_SNPs <- read.csv(paste0(wd,"/Results_Stats/Inversions_SNPs_EAS.txt"), sep = "\t", header = FALSE,
                      col.names = c("INV", "SNPs"))
Inv.SNPs <- cbind(AFR_SNPs, EUR_SNPs[2], EAS_SNPs[2])
colnames(Inv.SNPs) <- c("INV", "AFR", "EUR", "EAS")

```

```{r}
# Save inversion information in a LaTex style table
table <- Inv.Data[c(1:5,8,10 )]
colnames(table) <- c("Inversion", "Type", "Origin", "Chr", "Start", "End", "Length")
table %>% kbl() %>%
  kable_classic(full_width = F, html_font = "Cambria") %>%
  save_kable("../Results_Stats/taula.png")
```

## Transform the data to be able to perform the analysis
```{r}
# Produce minor allelle count (MAC) objects 

AFR_MAC <- data.frame("INV" = AFR_Freq$INV, "MAC" = round(Indivs.Info$AFR.Num.Samples * AFR_MAF$MAF * 2))
EUR_MAC <- data.frame("INV" = EUR_Freq$INV, "MAC" = round(Indivs.Info$EUR.Num.Samples * EUR_MAF$MAF * 2))
EAS_MAC <- data.frame("INV" = EAS_Freq$INV, "MAC" = round(Indivs.Info$EAS.Num.Samples * EAS_MAF$MAF * 2))

# Inversion numbers info
AFR_Nums <- cbind(Indivs.Info[c(1,2)], AFR_MAF[2], AFR_MAC[2])
EUR_Nums <- cbind(Indivs.Info[c(1,4)], EUR_MAF[2], EUR_MAC[2])
EAS_Nums <- cbind(Indivs.Info[c(1,3)], EAS_MAF[2], EAS_MAC[2])

# Get the inversion info of the inversions of interest (merge the dataframes)
Inv.Data <- merge(Inversion.Info,Inversions, by = "INV")

# Perform some data manipulation
Inv.Data$Origin <- factor(Inv.Data$Origin)
Inv.Data$Chr <- factor(Inv.Data$Chr)

# Add columns to the data based on existing columns (inversion length, inverted repeats length, inversion body length, ratio between body length and IR length)
Inv.Data <- Inv.Data %>% mutate(Rep.Length = abs(BP1_2..HG38. + BP2_2..HG38. - BP2_1..HG38. - BP1_1..HG38.)/2)
Inv.Data <- Inv.Data %>% mutate(Inv.Length = abs(BP2_2..HG38. - BP1_1..HG38.))
Inv.Data <- Inv.Data %>% mutate(Interior.Length = abs(BP2_1..HG38. - BP1_2..HG38.))
Inv.Data <- Inv.Data %>% mutate(Ratio = Rep.Length / Interior.Length)

# Add the information regarding the number of individuals per inversion and population
Inv.Data <- merge(Inv.Data,Indivs.Info, by="INV")
```


## Plot summary data
```{r}
# Plot the Inversion Length 
Inversion_length_plot <- Inv.Data %>% ggplot(mapping = aes(x=factor(INV, levels=INV[order(Inv.Length)]),y=Inv.Length)) + 
                                   geom_bar(stat = "identity") + 
                                   labs(y = "Inversion Length (bp)", title = "Imputed Inversions Length") + 
                                   theme(
                                     axis.title.x = element_blank(),
                                     axis.text.x = element_text(angle = 50, hjust = 1)
                                   ); Inversion_length_plot
```
```{r}
# Plot the IR Length (only for NAHR)
IR_length_plot <- Inv.Data[Inv.Data$Origin == "NAHR",] %>% ggplot(mapping = aes(x=factor(INV, levels=INV[order(Rep.Length)]),y=Rep.Length)) + 
                                   geom_bar(stat = "identity") + 
                                   labs(y = "IR Length (bp)", title = "Imputed NAHR Inversions IR Length") + 
                                   theme(
                                     axis.title.x = element_blank(),
                                     axis.text.x = element_text(angle = 50, hjust = 1)
                                   ); IR_length_plot

```
```{r, fig.width=15}
# Plot the inversion Frequency
Inv.Freq.Plot <- Inv.Freq %>% rowwise() %>% mutate(Max = max(c_across(c("AFR","EUR","EAS"))))
Inv.Freq.Plot <- Inv.Freq.Plot %>% arrange(desc(Max))
Inv.Freq.Plot$INV <- factor(Inv.Freq.Plot$INV, levels = Inv.Freq.Plot$INV)
Inv.Freq.Plot <- Inv.Freq.Plot  %>% pivot_longer(cols = c("AFR", "EUR", "EAS"), names_to = "Population", values_to = "Freq")

ggplot(Inv.Freq.Plot, aes(x = INV, y = Freq, fill = Population)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Inversion", y = "Frequency", fill = "Population", title = "Frequency of Inversion per Population") +
  scale_fill_manual(values = c("#F8766D","#00BA38", "#619CFF"),labels = c("AFR", "EAS", "EUR")) + 
  theme_minimal() +
  facet_wrap(~ INV, ncol = 11, scales = "free_x") +
  theme(
    plot.title = element_text(face = "bold", size = 30, hjust = .5, margin = margin(10,0,20,0)),
    strip.background = element_rect(fill = "lightblue"),
    strip.text = element_text(color = "darkblue", face = "bold"),
    panel.grid.major = element_line(linewidth = 0.5, linetype = 'solid', color = "grey80"),
    panel.grid.minor = element_line(linewidth = 0.25, linetype = 'solid', color = "grey90"),
    axis.title.x = element_blank(),
    axis.title.y = element_text(size = 18),
    legend.text = element_text(size = 13),
    legend.title = element_text(size = 15),
    axis.text.x = element_blank(),
    axis.text.y = element_text(size = 13))

```

```{r, fig.width=15}
# Plot the segregating SNPs per Inversion and Population
Inv.SNPs.Plot <- Inv.SNPs %>% rowwise() %>% mutate(Max = max(c_across(c("AFR","EUR","EAS"))))
Inv.SNPs.Plot <- Inv.SNPs.Plot %>% arrange(desc(Max))
Inv.SNPs.Plot$INV <- factor(Inv.SNPs.Plot$INV, levels = Inv.SNPs.Plot$INV)
Inv.SNPs.Plot <- Inv.SNPs.Plot  %>% pivot_longer(cols = c("AFR", "EUR", "EAS"), names_to = "Population", values_to = "SNPs")

ggplot(Inv.SNPs.Plot, aes(x = INV, y = SNPs, fill = Population)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Inversion", y = "SNPs", fill = "Population", title = "SNPs per Inversion and Population") +
  scale_fill_manual(values = c("#F8766D","#00BA38", "#619CFF"),labels = c("AFR", "EAS", "EUR")) + 
  theme_minimal() +
  facet_wrap(~ INV, ncol = 11, scales = "free_x") +
  theme(
    plot.title = element_text(face = "bold", size = 30, hjust = .5, margin = margin(10,0,20,0)),
    strip.background = element_rect(fill = "lightblue"),
    strip.text = element_text(color = "darkblue", face = "bold"),
    panel.grid.major = element_line(linewidth = 0.5, linetype = 'solid', color = "grey80"),
    panel.grid.minor = element_line(linewidth = 0.25, linetype = 'solid', color = "grey90"),
    axis.title.x = element_blank(),
    axis.title.y = element_text(size = 18),
    legend.text = element_text(size = 13),
    legend.title = element_text(size = 15),
    axis.text.x = element_blank(),
    axis.text.y = element_text(size = 13))
```

```{r}
# Plot the number of individuals per inversion and population
AFR_plot <- Inv.Data %>% ggplot(mapping = aes(x=factor(INV, levels=INV[order(AFR.Num.Samples)]),y=AFR.Num.Samples)) + 
                                geom_bar(stat = "identity") +
                                labs(y = "# Individuals", title = "Number of Individuals per Inversion in AFR Population") + 
                                theme(
                                  axis.title.x = element_blank(),
                                  axis.text.x = element_text(angle = 50, hjust = 1)
                                ); AFR_plot

EUR_plot <- Inv.Data %>% ggplot(mapping = aes(x=factor(INV, levels=INV[order(EUR.Num.Samples)]),y=EUR.Num.Samples)) + 
                                geom_bar(stat = "identity") +
                                labs(y = "# Individuals", title = "Number of Individuals per Inversion in EUR Population") + 
                                theme(
                                  axis.title.x = element_blank(),
                                  axis.text.x = element_text(angle = 50, hjust = 1)
                                ); EUR_plot

EAS_plot <- Inv.Data %>% ggplot(mapping = aes(x=factor(INV, levels=INV[order(EAS.Num.Samples)]),y=EAS.Num.Samples)) + 
                                geom_bar(stat = "identity") +
                                labs(y = "# Individuals", title = "Number of Individuals per Inversion in EAS Population") + 
                                theme(
                                  axis.title.x = element_blank(),
                                  axis.text.x = element_text(angle = 50, hjust = 1)
                                ); EAS_plot
```
```{r}
# Plot number of individuals per inversion, joined populations

## 1. 3 Different rows divided by the average number of individuals per inversion
Inv.Data.IndvsPerPop <- Inv.Data[c(1,13,14,15)]
Inv.Data.IndvsPerPop.Long <- melt(Inv.Data.IndvsPerPop, id.vars = "INV", variable.name = "Population", value.name = "Individual.Number")
Inv.Data.IndvsPerPop.Long$INV <- factor(Inv.Data.IndvsPerPop.Long$INV,
                                        levels = unique(Inv.Data.IndvsPerPop.Long$INV[order(Inv.Data.IndvsPerPop.Long$Individual.Number)]))

### Get the total number of individuals per inversion
Inv.Data.IndvsPerPop.Total <- cbind(Inv.Data.IndvsPerPop[1], data.frame("Total.Indivs" = rowSums(Inv.Data.IndvsPerPop[-1])))

### Add that to the dataframe to plot
GroupedInv.Data.IndvsPerPop <- Inv.Data.IndvsPerPop.Long %>%
  group_by(INV) %>% dplyr::summarise(Total.Indvs = sum(Individual.Number))


### Split the inversions into 3 groups (low, medium and high number of individuals)
breaks <- quantile(GroupedInv.Data.IndvsPerPop$Total.Indvs, probs = c(0, 1/3, 105/200, 1))
GroupedInv.Data.IndvsPerPop$Group <- cut(GroupedInv.Data.IndvsPerPop$Total.Indvs, breaks = breaks, labels = c("Low", "Medium", "High"), include.lowest = TRUE)


### Create the Dataframe to Plot the 3 different groups, modify the dataframe to plot all the inversions together
Inv.Data.IndvsPerPop.Long.Plot <- merge(Inv.Data.IndvsPerPop.Long, GroupedInv.Data.IndvsPerPop, by = "INV")
Inv.Data.IndvsPerPop.Long$Group <- cut(Inv.Data.IndvsPerPop.Long$Individual.Number, breaks = breaks, labels = c("Low", "Medium", "High"), include.lowest = TRUE)
Inv.Data.IndvsPerPop.Long.Plot %>% group_by(Population,Group) %>% summarise(mode = Mode(Individual.Number), mean = mean(Individual.Number), median = median(Individual.Number))


### Plot the 3 groups
ggplot(Inv.Data.IndvsPerPop.Long.Plot, aes(x = INV, y = Individual.Number, fill = Population)) +
  geom_bar(stat = "identity") +
  labs(x = "Inversion", y = "Num of Individuals", fill = "Population") +
  scale_fill_manual(values = c("#F8766D","#00BA38", "#619CFF"),labels = c("AFR", "EAS", "EUR")) + 
  theme_minimal() +
  facet_wrap(~ Group, nrow = 3,scales = c("free")) +
  theme(
    axis.text.x = element_text(angle = 30, hjust = 1))

### Plot 3 groups, using dodge (prefered)
ggplot(Inv.Data.IndvsPerPop.Long.Plot, aes(x = INV, y = Individual.Number, fill = Population)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Inversion", y = "Num of Individuals", fill = "Population", title = "Number of individuals per Inversion and Population") +
  scale_fill_manual(values = c("#F8766D","#00BA38", "#619CFF"),labels = c("AFR", "EAS", "EUR")) + 
  theme_minimal() +
  facet_wrap(~ Group, nrow = 3,scales = c("free")) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.6),
    strip.text = element_text(size = 10),
    axis.text.x = element_text(angle = 30, hjust = 1, size = 7),
    axis.title = element_text(face = "bold"),
    )


### Plot together
ggplot(Inv.Data.IndvsPerPop.Long, aes(x=INV, y = Individual.Number, fill = Population)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete(labels = c("AFR.Num.Samples" = "AFR", "EAS.Num.Samples" = "EAS", "EUR.Num.Samples" = "EUR")) +
  labs(x = c(), y = "Num of Individuals", fill = "Population", title = "Aggregate number of individuals per inversion") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1))

```

## Create functions to work with the data
```{r}
# From a df (usually the Imputation.Info, extract information regarding a particular imputation method, condition, filter... or more than one together)
sel_df <- function(df,imp_method=NULL, condition = NULL, filter=NULL, pop=NULL, imputability = NULL){
  arg.names <- names(as.list(match.call())[c(-1,-2)])
  for (arg in arg.names) {
    arg_value <- get(arg)
    if (arg_value == "No"){
      assign(arg,NULL)
    }
  }
  if (!is.null(imp_method)){
    sel_imp_method <- grep(imp_method, names(df), value = TRUE)
    df <- df[c("INV",sel_imp_method)]
  }
  if (!is.null(filter)){
    sel_filter <- grep(filter, names(df), value = TRUE)
    df <- df[c("INV",sel_filter)]
  }
  if (!is.null(condition)){
    sel_condition <- grep(condition, names(df), value = TRUE)
    df <- df[c("INV",sel_condition)]
  }
  if (!is.null(pop)){
    sel_pop <- grep(pop, names(df), value = TRUE)
    df <- df[c("INV",sel_pop)]
  }
  if (!is.null(imputability)){
    sel_imputability <- grep(imputability, names(df), value = TRUE)
    df <- df[c("INV",sel_imputability)]
  }
  return(df)
}

## Returns a grob object, used by grob arrange to plot the amount of imputable, 
## barely imputable and not imputable for an imputation method and population 
## (also can be used with a specific condition and filter)
plot_count_true <- function(imp_method, condition = NULL, population, filter = NULL) {
  plot_list <- list()
  num <- 1
  if (!is.null(filter)) {
    filters <- "No"
  } else {
    filters <- c("0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")
    }
  for (filter in filters) {
    temporal_df <- sel_df(Imputation.Info, imp_method = imp_method, condition = condition, pop = population, filter = filter)
    temporal.to.plot <- temporal_df %>%
  summarise_at(
    vars(contains("Imputable")),
    list(
      count_true = ~ sum(. == TRUE, na.rm = TRUE),
      count_false = ~ sum(. == FALSE, na.rm = TRUE),
      count_na = ~ sum(is.na(.))
    )
  )  %>%
  pivot_longer(cols = everything(), 
               names_to = c(".value", "measure"), 
               names_pattern = "(.*)\\.(.*)") %>% as.data.frame()
  temporal.to.plot <- t(temporal.to.plot[c(-2,-3)])
  transposed.to.plot <- as.data.frame(temporal.to.plot[-1,])
  transposed.to.plot <- as.data.frame(apply(temporal.to.plot[-1,],2, as.numeric))
  colnames(transposed.to.plot) <- temporal.to.plot[1,]
  rownames(transposed.to.plot) <- colnames(temporal.to.plot)[-1]
  plot_list[[num]] <- ggplot(data = transposed.to.plot, mapping = aes(x = factor(row.names(transposed.to.plot), levels = rev(levels(factor(row.names(transposed.to.plot))))), y = get(paste0(population,"_count_true")), ymin = 0, ymax = 40)) + geom_bar(stat = "identity") + geom_text(aes(label = get(paste0(population,"_count_true"))), vjust = -0.5, color = "black", size = 3) + labs(x = "Imputability", y = "# Inversions", title = paste0(imp_method, " ", condition, " Phasing ", population, " ", filter, " Filter" )) + scale_x_discrete(labels = c("Not imputable\n(< 0.60)", "Barely imputable\n(0.60 - 0.80)", "Imputable\n(> 0.80)")) + theme(plot.title = element_text(size = 10, face = "bold"),
                                                                                                                                                                                   axis.title = element_text(size = 10),)
  num <- num + 1
  }
  grobs <- lapply(plot_list, ggplotGrob)
  return(grobs)
}

## Example execution
# grid.arrange(grobs = plot_count_true("Beagle", "Shapeit_Phase", "EUR"), ncol = 2)
# grid.arrange(grobs = plot_count_true("Beagle", "BEAGLE_Phase", "EUR"), ncol = 2)

# TO PLOT THE LOSS OF INDIVIDUALS VS THE GAIN IN IMPUTABILITY
## Primitive function to either plot the gain in imputability and the loss of 
## individuals for some Inversions or to subset that info in the form of a df
plot_method_vs_indiv <- function(imp_method, condition, pop, plot = TRUE) {
  df.indivs <- sel_df(Invs.Indiv.Info, imp_method = imp_method, condition = condition, pop = pop)
  df.indivs.percentages <- df.indivs[-1] / as.vector(df.indivs[paste0("Indvs.",imp_method,".",condition,".0.00.",pop)]) * 100
  df.indivs.percentages <- cbind(df.indivs[1],df.indivs.percentages)
  df.invs <- sel_df(Imputation.Info, imp_method = imp_method, condition = condition, pop = pop, filter = "Mean")
  if (plot) {
  print(ggplot(melt(df.invs[c(1:5),c(1:8)], id.vars = "INV"), aes(x = variable, y = value, group = INV, color = factor(INV))) +
  geom_line() +
  labs(x = "GP Filter", y = expression(~r^2~""), title = "Inversion Imputability Using Different GP Filters") + scale_x_discrete(labels = c("0.00","0.30","0.50", "0.70", "0.80", "0.90", "0.95")))

  print(ggplot(melt(df.indivs.percentages[c(1:5),c(1:8)], id.vars = "INV"), aes(x = variable, y = value, group = INV, color = factor(INV), ymin = 0)) +
  geom_line() +
  labs(x = "GP Filter", y = "% Initial Indivs", title = "Loss of Individuals by Using Different GP Filters") + scale_x_discrete(labels = c("0.00","0.30","0.50", "0.70", "0.80", "0.90", "0.95")))
  } else {
    return(list(df.indivs.percentages,df.invs))
  }
}
### Example
## plot_method_vs_indiv("Beagle", "BEAGLE_Phase", "EUR", plot = TRUE)


check_loss <- function(imp.method, pop, filter) {
  df.indivs.per <- plot_method_vs_indiv(imp_method = imp.method, "BEAGLE_Phase", pop = pop, plot = FALSE)
  df.indivs.perc <- df.indivs.per[[1]] %>% arrange(INV)
  sel_filt <- grep(filter, names(df.indivs.perc), value = TRUE)
  Indivs <- df.indivs.perc[c("INV", sel_filt)] %>% arrange(INV)
  Passin_Invs <- Indivs[Indivs[,2] >= 66.6,]$INV
  return(Passin_Invs)
}

## Get the mean number of individual loss with GP filter per method, condition and population
## This returns the df with that information
get_method_indvs_curve <- function(imp_method, condition, pop, plot = TRUE) {
  dfs <- plot_method_vs_indiv(imp_method, condition, pop, plot = FALSE)
  df.indivs.perc <- dfs[[1]]
  df.invs <- dfs[[2]]

  df.Anterior.Percentages <- colMeans(df.indivs.perc[-1])
  df.invs <- colMeans(df.invs[-1], na.rm = TRUE)*100
  
  summary_df <- data.frame("Individual.Percentage.Loss" = df.Anterior.Percentages, "Inversion.Imputability" = df.invs)
  summary_df2 <- rownames_to_column(summary_df, var = "Filter")
  summary_df2 <- pivot_longer(summary_df2,cols = -Filter)
  
  if (plot) { 
    print(
      summary_df2 %>% 
        ggplot(aes(x = Filter, y = value, group = name, ymin = 0, color = factor(name))) +
            geom_line() +
            labs(x = "GP Filter", y = "Percentage", 
                 title = "Inversion Imputability vs Individuals Loss",
                 subtitle = paste0(imp_method, ", ",condition, " Phasing, ", pop, " Population")) +
            scale_x_discrete(labels = c("0.00","0.30","0.50", "0.70", "0.80", "0.90", "0.95")) + 
            scale_color_manual(values = c("#F8766D","#00BFC4"),
                               labels = c("Remaining Individuals", "Inversion Imputability")) +
            theme(legend.title = element_blank()
        )
    )
  } else {
  return(summary_df2)
  }
}
Beagle_Loss <- check_loss("Beagle","EUR","0.50")
EUR_Poli <- EUR_Info[EUR_Info$V2 == "Polymorphic",]$V1

## Plot in the same dataframe the invidivual loss and the gain of imputability (means),
## if type == all compare imputation methods, if type == population, compare populations
## within method, if type == condition, compare phasing methods
plot_joint_condition <- function(type, spec) {
  if (type == "all") {
    plot_list <- list()
    i <- 1
    methods <- c("Beagle", "Impute2", "Impute5", "Minimac4")
    method_colors <- c(Beagle = "#F8766D", Impute2 = "#00BFC4", Impute5 = "#7CAE00", Minimac4 = "#C77CFF")
    pops <- c("AFR", "EUR", "EAS")
    conditions <- c("BEAGLE_Phase", "Shapeit_Phase")
    for (condition in conditions) {
      for (pop in pops) { 
        Poli <- get(paste0(pop,"_Info"))[get(paste0(pop,"_Info"))$V2 == "Polymorphic",]$V1
        Beagle_info <- get_method_indvs_curve("Beagle", condition, pop, plot = FALSE)
        Beagle_info$Filter <- c(0.00,0.00,0.30,0.30,0.50,0.50,0.70,0.70,0.80,0.80,0.90,0.90,0.95,0.95)
        Beagle_plot <- geom_line(data = Beagle_info, 
                         aes(x = Filter, y = value, ymin = 0, group = name, 
                             linetype = factor(name), color = "Beagle"), 
                         inherit.aes = FALSE)
        
        Impute2_info <- get_method_indvs_curve("Impute2", condition, pop, plot = FALSE)
        Impute2_info$Filter <- c(0.00,0.00,0.30,0.30,0.50,0.50,0.70,0.70,0.80,0.80,0.90,0.90,0.95,0.95)
        Impute2_plot <- geom_line(data = Impute2_info, 
                         aes(x = Filter, y = value, ymin = 0, group = name, 
                             linetype = factor(name), color = "Impute2"), 
                         inherit.aes = FALSE)
        Impute5_info <- get_method_indvs_curve("Impute5", condition, pop, plot = FALSE)
        Impute5_info$Filter <- c(0.00,0.00,0.30,0.30,0.50,0.50,0.70,0.70,0.80,0.80,0.90,0.90,0.95,0.95)
        Impute5_plot <- geom_line(data = Impute5_info, 
                         aes(x = Filter, y = value, ymin = 0, group = name, 
                             linetype = factor(name), color = "Impute5"), 
                         inherit.aes = FALSE)
        Minimac4_info <- get_method_indvs_curve("Minimac4", condition, pop, plot = FALSE)
        Minimac4_info$Filter <- c(0.00,0.00,0.30,0.30,0.50,0.50,0.70,0.70,0.80,0.80,0.90,0.90,0.95,0.95)
        Minimac4_plot <- geom_line(data = Minimac4_info, 
                         aes(x = Filter, y = value, ymin = 0, group = name, 
                             linetype = factor(name), color = "Minimac4"), 
                         inherit.aes = FALSE)
          
        pop_plot <- ggplot() + Beagle_plot + Impute2_plot + Impute5_plot + Minimac4_plot + 
               labs(x = "GP Filter", y = "Percentage", 
                    title = "Inversion Imputability vs Individuals Loss",
                    subtitle = paste0("All Methods, ", condition, " Phasing, ", pop, " Population")) +
              scale_x_continuous(breaks = c(0.00, 0.30, 0.50, 0.70, 0.80, 0.90, 0.95), labels = c("0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) +
              scale_color_manual(values = method_colors,
#                                 labels = c("Beagle", "Impute2", "Impute5", "Minimac4"),
                                 name = c()) +
              scale_linetype_manual(values = c(2,1),
                                    labels = c("Remaining Individuals", "Inversion Imputability"),
                                    name = c()) + 
             scale_y_continuous(position = "right", name = "Remaining Individuals (%)" , sec.axis = sec_axis(trans=~./100, name=expression("Imputability ("~r^2~")"))) + 
            theme(plot.title = element_text(hjust = 0.5),
                  plot.subtitle = element_text(hjust = 0.3),
                  axis.title = element_text(size = 9),
                  legend.position = "bottom")
        plot_list[[i]] <- ggplotGrob(pop_plot)
        DF <-  data.frame(
          Method = c("Beagle", "Impute2", "Impute5", "Minimac4"),
          "0.00" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.00"))),length(intersect(Poli,check_loss("Impute2",pop,"0.00"))),length(intersect(Poli,check_loss("Impute5",pop,"0.00"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.00")))),
          "0.30" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.30"))),length(intersect(Poli,check_loss("Impute2",pop,"0.30"))),length(intersect(Poli,check_loss("Impute5",pop,"0.30"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.30")))),
          "0.50" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.50"))),length(intersect(Poli,check_loss("Impute2",pop,"0.50"))),length(intersect(Poli,check_loss("Impute5",pop,"0.50"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.50")))),
          "0.70" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.70"))),length(intersect(Poli,check_loss("Impute2",pop,"0.70"))),length(intersect(Poli,check_loss("Impute5",pop,"0.70"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.70")))),
          "0.80" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.80"))),length(intersect(Poli,check_loss("Impute2",pop,"0.80"))),length(intersect(Poli,check_loss("Impute5",pop,"0.80"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.80")))),
          "0.90" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.90"))),length(intersect(Poli,check_loss("Impute2",pop,"0.90"))),length(intersect(Poli,check_loss("Impute5",pop,"0.90"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.90")))),
          "0.95" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.95"))),length(intersect(Poli,check_loss("Impute2",pop,"0.95"))),length(intersect(Poli,check_loss("Impute5",pop,"0.95"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.95"))))
          )
        plot_list[[i+1]] <- tableGrob(DF, rows = c(), cols = c("Method", "0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) 
        i <- i + 2
      }
    }
    return(plot_list)
  } else if (type == "population") {
      plot_list <- list()
      i <- 1
      pop_colors <- c("AFR" = "#F8766D", "EUR" = "#619CFF", "EAS" = "#00BA38")
      conditions <- c("BEAGLE_Phase", "Shapeit_Phase")
      for (condition in conditions) {
        AFR_info <- get_method_indvs_curve(spec, condition, "AFR", plot = FALSE)
        EUR_info <- get_method_indvs_curve(spec, condition, "EUR", plot = FALSE)
        EAS_info <- get_method_indvs_curve(spec, condition, "EAS", plot = FALSE)
        
        AFR_info$Filter <- c("0.00","0.00","0.30","0.30","0.50","0.50","0.70","0.70","0.80","0.80","0.90","0.90","0.95","0.95")
        AFR_plot <- geom_line(data = AFR_info, 
                         aes(x = Filter, y = value, ymin = 0, group = name, 
                             linetype = factor(name), color = "AFR"), 
                         inherit.aes = FALSE)
        EUR_info$Filter <- c("0.00","0.00","0.30","0.30","0.50","0.50","0.70","0.70","0.80","0.80","0.90","0.90","0.95","0.95")
        EUR_plot <- geom_line(data = EUR_info, 
                         aes(x = Filter, y = value, ymin = 0, group = name, 
                             linetype = factor(name), color = "EUR"), 
                         inherit.aes = FALSE)
        EAS_info$Filter <- c("0.00","0.00","0.30","0.30","0.50","0.50","0.70","0.70","0.80","0.80","0.90","0.90","0.95","0.95")
        EAS_plot <- geom_line(data = EAS_info, 
                         aes(x = Filter, y = value, ymin = 0, group = name, 
                             linetype = factor(name), color = "EAS"), 
                         inherit.aes = FALSE)
        pops_plot <- ggplot() + AFR_plot + EUR_plot + EAS_plot +
               labs(x = "GP Filter", y = "Percentage", 
                    title = "Inversion Imputability vs Individuals Loss",
                    subtitle = paste0(spec, " Imputation, ", condition, " Phasing, All Populations")) +
              scale_x_discrete(labels = c("0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) +
              scale_color_manual(values = pop_colors,
#                                 labels = c("AFR", "EUR", "EAS"),
                                 name = "Population") +
              scale_linetype_manual(values = c(2,1),
                                    labels = c("Remaining Individuals", "Inversion Imputability"),
                                    name = c()) + 
             scale_y_continuous(position = "right",name = "Remaining Individuals (%)" , sec.axis = sec_axis(trans=~./100, name=expression("Imputability ("~r^2~")"))) + 
            theme(plot.title = element_text(hjust = 0.5),
                  plot.subtitle = element_text(hjust = 0.3),
                  axis.title = element_text(size = 9))
      
        plot_list[[i]] <- pops_plot
        i <- i + 1
      }
      if (spec == "Impute2") {
        AFR_info <- get_method_indvs_curve(spec, "Unphased", "AFR", plot = FALSE)
        EUR_info <- get_method_indvs_curve(spec, "Unphased", "EUR", plot = FALSE)
        EAS_info <- get_method_indvs_curve(spec, "Unphased", "EAS", plot = FALSE)
        
        AFR_info$Filter <- c("0.00","0.00","0.30","0.30","0.50","0.50","0.70","0.70","0.80","0.80","0.90","0.90","0.95","0.95")
        AFR_plot <- geom_line(data = AFR_info, 
                         aes(x = Filter, y = value, ymin = 0, group = name, 
                             linetype = factor(name), color = "AFR"), 
                         inherit.aes = FALSE)
        EUR_info$Filter <- c("0.00","0.00","0.30","0.30","0.50","0.50","0.70","0.70","0.80","0.80","0.90","0.90","0.95","0.95")
        EUR_plot <- geom_line(data = EUR_info, 
                         aes(x = Filter, y = value, ymin = 0, group = name, 
                             linetype = factor(name), color = "EUR"), 
                         inherit.aes = FALSE)
        EAS_info$Filter <- c("0.00","0.00","0.30","0.30","0.50","0.50","0.70","0.70","0.80","0.80","0.90","0.90","0.95","0.95")
        EAS_plot <- geom_line(data = EAS_info, 
                         aes(x = Filter, y = value, ymin = 0, group = name, 
                             linetype = factor(name), color = "EAS"), 
                         inherit.aes = FALSE)
        pops_plot <- ggplot() + AFR_plot + EUR_plot + EAS_plot +
               labs(x = "GP Filter", y = "Percentage", 
                    title = "Inversion Imputability vs Individuals Loss",
                    subtitle = paste0(spec, " Imputation, Unphased Phasing, All Populations")) +
              scale_x_discrete(labels = c("0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) +
              scale_color_manual(values = pop_colors,
#                                 labels = c("AFR", "EUR", "EAS"),
                                 name = "Population") +
              scale_linetype_manual(values = c(2,1),
                                    labels = c("Remaining Individuals", "Inversion Imputability"),
                                    name = c()) + 
             scale_y_continuous(position = "right", name = "Remaining Individuals (%)" , sec.axis = sec_axis(trans=~./100, name=expression("Imputability ("~r^2~")"))) + 
            theme(plot.title = element_text(hjust = 0.5),
                  plot.subtitle = element_text(hjust = 0.3),
                  axis.title = element_text(size = 9))
        plot_list[[i]] <- pops_plot
      }
      
      grobs <- lapply(plot_list, ggplotGrob)
      return(grobs)
  } else if (type == "condition") {
      plot_list <- list()
      i <- 1
      pops <- c("AFR", "EUR", "EAS")
      condition_colors <- c("BEAGLE_Phase" = "#F8766D", "Shapeit_Phase" = "#619CFF", "Unphased" = "#00BA38")
      for (pop in pops) {
        Standard_info <- get_method_indvs_curve(spec, "BEAGLE_Phase", pop, plot = FALSE)
        Shapeit_Phase_info <- get_method_indvs_curve(spec, "Shapeit_Phase", pop, plot = FALSE)
            
        Standard_info$Filter <- c("0.00","0.00","0.30","0.30","0.50","0.50","0.70","0.70","0.80","0.80","0.90","0.90","0.95","0.95")
        Standard_plot <- geom_line(data = Standard_info, 
                           aes(x = Filter, y = value, ymin = 0, group = name, 
                               linetype = factor(name), color = "BEAGLE_Phase"), 
                           inherit.aes = FALSE)
        Shapeit_Phase_info$Filter <- c("0.00","0.00","0.30","0.30","0.50","0.50","0.70","0.70","0.80","0.80","0.90","0.90","0.95","0.95")
        Shapeit_Phase_plot <- geom_line(data = Shapeit_Phase_info, 
                           aes(x = Filter, y = value, ymin = 0, group = name, 
                               linetype = factor(name), color = "Shapeit_Phase"), 
                           inherit.aes = FALSE)
        conditions_plot <- ggplot() + Standard_plot + Shapeit_Phase_plot
            
            if (spec == "Impute2") {
              Unphased_info <- get_method_indvs_curve(spec, "Unphased", pop, plot = FALSE)
              Unphased_info$Filter <- c("0.00","0.00","0.30","0.30","0.50","0.50","0.70","0.70","0.80","0.80","0.90","0.90","0.95","0.95")
              Unphased_plot <- geom_line(data = Unphased_info, 
                           aes(x = Filter, y = value, ymin = 0, group = name, 
                               linetype = factor(name), color = "Unphased"), 
                           inherit.aes = FALSE)
              conditions_plot <- conditions_plot + Unphased_plot
            }
        conditions_plot <- conditions_plot + labs(x = "GP Filter", y = "Percentage", 
                      title = "Inversion Imputability vs Individuals Loss",
                      subtitle = paste0(spec, " Imputation, All Phasings, ", pop)) +
                scale_x_discrete(labels = c("0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) +
                scale_color_manual(values = condition_colors,
#                                   labels = c("Standard", "Shapeit_Phase", "Unphased"),
                                   name = "Population") +
                scale_linetype_manual(values = c(2,1),
                                      labels = c("Remaining Individuals", "Inversion Imputability"),
                                      name = c()) + 
               scale_y_continuous(position = "right", name = "Remaining Individuals (%)" , sec.axis = sec_axis(trans=~./100, name=expression("Imputability ("~r^2~")"))) + 
            theme(plot.title = element_text(hjust = 0.5),
                  plot.subtitle = element_text(hjust = 0.3),
                  axis.title = element_text(size = 9))
        plot_list[[i]] <- conditions_plot
        i <- i + 1
      }
      grobs <- lapply(plot_list, ggplotGrob)
      return(grobs)
  }
  
}


## Rounding function to perform on df
roundAll <- function(df, dig){
  ndf <- df
  for(c in colnames(df)){
    df[[c]] <- as.numeric(df[[c]])
  }
  
  for(i in seq(dim(df)[1])){
    for(j in seq(dim(df)[2])){
      if(!is.na(ndf[i,j])){
        ndf[i,j] <- round(as.numeric(df[i,j]), dig)
      }
    }
  }
  return(ndf)
}

get_improvement_steps <- function(Imp.Method, Ph.Method = "No"){
  filters <- Filts[-2]
  types <- c("Imp", "Indvs", "Cost")
  res <- list()
  if (Ph.Method == "No") {
    if (Imp.Method == "Impute2") {
      phases <- Phase.Methods
    } else {
      phases <- Phase.Methods[-3]
    }
  } else{
    phases <- Ph.Method
  }
  df <- data.frame("Condition" = c(to_vec(for(x in phases) for(y in Pops) for(z in types) paste0(x,".",y,".",z))))
  for (i in 1:(length(filters)-1)) {
    temp <- c()
    for (phase in phases) {
      for (pop in Pops) {
        Invds.Imp <- get_method_indvs_curve(Imp.Method, phase, pop, plot = FALSE)
        Imp.diff <- Invds.Imp[Invds.Imp$Filter == paste0("Indvs.", Imp.Method, ".", phase, ".", filters[i+1], ".", pop) & Invds.Imp$name == "Inversion.Imputability",]$value - 
                    Invds.Imp[Invds.Imp$Filter == paste0("Indvs.", Imp.Method, ".", phase, ".", filters[i], ".", pop) & Invds.Imp$name == "Inversion.Imputability",]$value
        Indv.diff <-Invds.Imp[Invds.Imp$Filter == paste0("Indvs.", Imp.Method, ".", phase, ".", filters[i+1], ".", pop) & Invds.Imp$name == "Individual.Percentage.Loss",]$value - 
                    Invds.Imp[Invds.Imp$Filter == paste0("Indvs.", Imp.Method, ".", phase, ".", filters[i], ".", pop) & Invds.Imp$name == "Individual.Percentage.Loss",]$value
        Imp.Cost <- abs(Indv.diff/Imp.diff)
        temp <- c(temp, Imp.diff, Indv.diff, Imp.Cost)
      }
    }
    df <- cbind(df, data.frame(temp))
  }
  colnames(df) <- c("Condition", "0.00_0.50", "0.50_0.70", "0.70_0.80", "0.80_0.90", "0.90_0.95")
  return(df)
}


get_improvement <- function(Imp.Method, Ph.Method = "No"){
  Imp.diffs <- c()
  Indv.diffs <- c()
  
  if (Ph.Method == "No") {
    if (Imp.Method == "Impute2") {
      phases <- Phase.Methods
    } else {
      phases <- Phase.Methods[-3]
    }
  } else{
    phases <- Ph.Method
  }
  
  for (phase in phases) {
    for (pop in Pops) {
    Invds.Imp <- get_method_indvs_curve(Imp.Method, phase, pop, plot = FALSE)
    Imp.diff <- Invds.Imp[Invds.Imp$Filter == paste0("Indvs.", Imp.Method, ".", phase, ".0.95.", pop) & Invds.Imp$name == "Inversion.Imputability",]$value - 
                Invds.Imp[Invds.Imp$Filter == paste0("Indvs.", Imp.Method, ".", phase, ".0.00.", pop) & Invds.Imp$name == "Inversion.Imputability",]$value
    Indv.diff <-Invds.Imp[Invds.Imp$Filter == paste0("Indvs.", Imp.Method, ".", phase, ".0.95.", pop) & Invds.Imp$name == "Individual.Percentage.Loss",]$value - 
                Invds.Imp[Invds.Imp$Filter == paste0("Indvs.", Imp.Method, ".", phase, ".0.00.", pop) & Invds.Imp$name == "Individual.Percentage.Loss",]$value
    
    Imp.diffs <- c(Imp.diffs, Imp.diff)
    Indv.diffs <- c(Indv.diffs, Indv.diff)
    }
  }
  return(list(mean(Imp.diffs), mean(Indv.diffs)))
}


get_bestest <- function(pop, frequency) {
  Top <- data.frame("INV" = sort(Inversions$INV), "Best Method" = c(rep("None",55)), "Best Filter" = c(rep(NA,55)), "R2" = c(rep(0,55)), "Freq" = c(rep(0,55)), "Remaining Indivs" = c(rep(NA,55)), "Remaining Indivs Perc" = c(rep(NA,55)))
  Freqs <- get(paste0(pop,"_MAF")) %>% arrange(INV)
  for (method in Imp.Methods[-5]) {
    df.indivs <- sel_df(Invs.Indiv.Info, imp_method = method, condition = "BEAGLE_Phase", pop = pop)
    df.indivs <- df.indivs %>% arrange(INV)
    df.indivs.per <- plot_method_vs_indiv(imp_method = method, "BEAGLE_Phase", pop = pop, plot = FALSE)
    df.indivs.perc <- df.indivs.per[[1]] %>% arrange(INV)
    df.invs <- df.indivs.per[[2]]
    for (i in 1:55) {
      max <- Top$R2[i]
      meth <- Top$Best.Method[i]
      RI <- Top$Remaining.Indivs[i]
      RIP <- Top$Remaining.Indivs.Perc[i]
      filt <- Top$Best.Filter[i]
      freq <- Freqs[i,2]
      if (freq <= frequency) {
        Top$Best.Method[i] <- "None"
        Top$Best.Filter[i] <- NA
        Top$R2[i] <- NA
        Top$Freq[i] <- freq
        Top$Remaining.Indivs[i] <- NA
        Top$Remaining.Indivs.Perc[i] <- NA
        next
      }
      Top$Freq[i] <- freq
      for (j in 2:8) {
        RIC <- df.indivs.perc[i, j]
        if (RIC < 66) {
          break
        }
        inv <- df.invs[i, j]
        RC <- df.indivs[i ,j]
        if ((!is.na(inv) & (inv > max)) | (!is.na(inv) & (inv == max) & (RC > RI))) {
          max <- inv
          meth <- method
          RI <- RC
          RIP <- RIC
          filt <- Filts[j-1]
        } else if (!is.na(inv) & (inv == max) & (RC == RI) & !(grepl(method, meth))) {
          max <- inv
          meth <- paste0(meth,", ",method)
          RI <- RC
          RIP <- RIC
          filt <- Filts[j-1]
        }
      }
      Top$Best.Method[i] <- meth
      Top$Best.Filter[i] <- filt
      Top$R2[i] <- max
      Top$Remaining.Indivs[i] <- RI
      Top$Remaining.Indivs.Perc[i] <- RIP
    }
  }
  siH <- sel_df(Imputation.Info, imp_method = "ScoreInvHap", pop = pop, filter = "Mean") %>% arrange(INV)
  sel_pop <- grep(pop, names(Indivs.Info), value = TRUE)
  Indivs <- Indivs.Info[c("INV", sel_pop)] %>% arrange(INV)
  method <- "ScoreInvHap"
  for (i in 1:55) {
    max <- Top$R2[i]
    meth <- Top$Best.Method[i]
    RI <- Top$Remaining.Indivs[i]
    RIP <- Top$Remaining.Indivs.Perc[i]
    filt <- Top$Best.Filter[i]
    freq <- Freqs[i,2]
    if (freq <= frequency) {
      Top$Best.Method[i] <- "Freq too low"
      Top$Best.Filter[i] <- NA
      Top$R2[i] <- NA
      Top$Freq[i] <- freq
      Top$Remaining.Indivs[i] <- NA
      Top$Remaining.Indivs.Perc[i] <- NA
      next
    }
    Top$Freq[i] <- freq
    inv <- siH[i, 2]
    RC <- Indivs[i ,2]
    RIC <- 100
    if ((!is.na(inv) & (inv > max)) | (!is.na(inv) & (inv == max) & (RC > RI))) {
        max <- inv
        meth <- method
        RI <- RC
        RIP <- RIC
        filt <- "0.00"
      } else if (!is.na(inv) & (inv == max) & (RC == RI) & !(grepl(method, meth))) {
        max <- inv
        meth <- paste0(meth,", ",method)
        RI <- RC
        RIP <- RIC
        filt <- "0.00"
      }
      Top$Best.Method[i] <- meth
      Top$Best.Filter[i] <- filt
      Top$R2[i] <- max
      Top$Remaining.Indivs[i] <- RI
      Top$Remaining.Indivs.Perc[i] <- RIP
    }
  return(Top)
}

check_imp <- function(method, pop, frequency) {
  Top <- data.frame("INV" = sort(Inversions$INV), "Method" = c(rep(method,55)), "Best Filter" = c(rep(0.0,55)), "R2" = c(rep(0,55)), "Freq" = c(rep(0,55)), "Remaining Indivs" = c(rep(0,55)), "Remaining Indivs Perc" = c(rep(0,55)))
  Freqs <- get(paste0(pop,"_MAF")) %>% arrange(INV)
    df.indivs <- sel_df(Invs.Indiv.Info, imp_method = method, condition = "BEAGLE_Phase", pop = pop)
    df.indivs <- df.indivs %>% arrange(INV)
    df.indivs.per <- plot_method_vs_indiv(imp_method = method, "BEAGLE_Phase", pop = pop, plot = FALSE)
    df.indivs.perc <- df.indivs.per[[1]] %>% arrange(INV)
    df.invs <- df.indivs.per[[2]]
    for (i in 1:55) {
      max <- Top$R2[i]
      RI <- Top$Remaining.Indivs[i]
      RIP <- Top$Remaining.Indivs.Perc[i]
      filt <- Top$Best.Filter[i]
      freq <- Freqs[i,2]
      if (freq < frequency) {
        Top$Method[i] <- "Freq too low"
        Top$Best.Filter[i] <- NA
        Top$R2[i] <- NA
        Top$Freq[i] <- freq
        Top$Remaining.Indivs[i] <- NA
        Top$Remaining.Indivs.Perc[i] <- NA
        next
      }
      Top$Freq[i] <- freq
      for (j in 2:8) {
        RIC <- df.indivs.perc[i, j]
        if (RIC < 66) {
          break
        }
        inv <- df.invs[i, j]
        RC <- df.indivs[i ,j]
        if ((!is.na(inv) & (inv > max))) {
          max <- inv
          RI <- RC
          RIP <- RIC
          filt <- Filts[j-1]
        }
      }
      Top$Best.Filter[i] <- filt
      Top$R2[i] <- max
      Top$Remaining.Indivs[i] <- RI
      Top$Remaining.Indivs.Perc[i] <- RIP
    }
  
  return(Top)
}

add_sIH <- function(pop) {
  Top <- data.frame("INV" = sort(Inversions$INV), "Method" = c(rep("ScoreInvHap",55)), "Best Filter" = c(rep(0.00,55)), "R2" = c(rep(0,55)), "Freq" = c(rep(0,55)), "Remaining Indivs" = c(rep(0,55)), "Remaining Indivs Perc" = c(rep(100,55)))
  Freqs <- get(paste0(pop,"_MAF")) %>% arrange(INV)
  Invs <- sel_df(Imputation.Info, imp_method = "ScoreInvHap", pop = pop, filter = "Mean") %>% arrange(INV)
  sel_pop <- grep(pop, names(Indivs.Info), value = TRUE)
  Indivs <- Indivs.Info[c("INV", sel_pop)] %>% arrange(INV)
  
  Top$R2 <- ifelse(Invs[,2][Freqs$MAF > 0.05], Invs[,2], NA)
  Top$Method <- ifelse(Freqs$MAF > 0.05, "ScoreInvHap", "Frequency too low")
}


valid_invs <- function(pop, freq_thres = 0.01, MAC_thres = 6, type = "both") {
  df <- get(paste0(pop,"_Nums"))
  if (type == "both") {
    Passin_Invs <- df[df$MAC >= MAC_thres & df$MAF >= freq_thres, ]$INV
  } else if (type == "either") {
    Passin_Invs <- df[df$MAC >= MAC_thres | df$MAF >= freq_thres, ]$INV
  }
  return(Passin_Invs)
}

InvNA <- function(df) {
  Invs_list <- list()
  for (i in 2:ncol(df)) {
    tmp <- df[!is.na(df[,i]),][c(1)]
    Invs_list[[i-1]] <- tmp
  }
  return(Invs_list)
}

```

```{r, fig.height=10, fig.width = 8, warning=FALSE}
    plot_list <- list()
    methods <- c("Beagle", "Impute2", "Impute5", "Minimac4")
    method_colors <- c(Beagle = "#F8766D", Impute2 = "#00BFC4", Impute5 = "#7CAE00", Minimac4 = "#C77CFF")
    
    Beagle_inf <- plot_method_vs_indiv("Beagle", "BEAGLE_Phase", "AFR", plot = FALSE)[[2]]
    Beagle_info <- Beagle_inf %>% 
          mutate(Mean.Beagle.BEAGLE_Phase.0.00.AFR = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.00"), Mean.Beagle.BEAGLE_Phase.0.00.AFR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.30.AFR = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.30"), Mean.Beagle.BEAGLE_Phase.0.30.AFR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.50.AFR = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.50"), Mean.Beagle.BEAGLE_Phase.0.50.AFR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.70.AFR = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.70"), Mean.Beagle.BEAGLE_Phase.0.70.AFR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.80.AFR = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.80"), Mean.Beagle.BEAGLE_Phase.0.80.AFR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.90.AFR = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.90"), Mean.Beagle.BEAGLE_Phase.0.90.AFR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.95.AFR = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.95"), Mean.Beagle.BEAGLE_Phase.0.95.AFR, NA))
    
    Beagle_info <- colMeans(Beagle_info[-1], na.rm = TRUE) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Beagle_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Beagle_info) <- c("Filter", "Imp")
        Beagle_plot <- geom_line(data = Beagle_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 1,  color = "Beagle"), 
                         inherit.aes = FALSE)
        
        Impute2_inf <- plot_method_vs_indiv("Impute2", "BEAGLE_Phase", "AFR", plot = FALSE)[[2]]
    Impute2_info <- Impute2_inf %>% 
          mutate(Mean.Impute2.BEAGLE_Phase.0.00.AFR = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.00"), Mean.Impute2.BEAGLE_Phase.0.00.AFR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.30.AFR = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.30"), Mean.Impute2.BEAGLE_Phase.0.30.AFR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.50.AFR = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.50"), Mean.Impute2.BEAGLE_Phase.0.50.AFR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.70.AFR = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.70"), Mean.Impute2.BEAGLE_Phase.0.70.AFR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.80.AFR = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.80"), Mean.Impute2.BEAGLE_Phase.0.80.AFR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.90.AFR = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.90"), Mean.Impute2.BEAGLE_Phase.0.90.AFR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.95.AFR = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.95"), Mean.Impute2.BEAGLE_Phase.0.95.AFR, NA))

    Impute2_info <- colMeans(Impute2_info[-1], na.rm = TRUE) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute2_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute2_info) <- c("Filter", "Imp")
        Impute2_plot <- geom_line(data = Impute2_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 1,  color = "Impute2"), 
                         inherit.aes = FALSE)
        
        Impute5_inf <- plot_method_vs_indiv("Impute5", "BEAGLE_Phase", "AFR", plot = FALSE)[[2]]
    Impute5_info <- Impute5_inf %>% 
          mutate(Mean.Impute5.BEAGLE_Phase.0.00.AFR = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.00"), Mean.Impute5.BEAGLE_Phase.0.00.AFR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.30.AFR = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.30"), Mean.Impute5.BEAGLE_Phase.0.30.AFR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.50.AFR = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.50"), Mean.Impute5.BEAGLE_Phase.0.50.AFR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.70.AFR = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.70"), Mean.Impute5.BEAGLE_Phase.0.70.AFR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.80.AFR = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.80"), Mean.Impute5.BEAGLE_Phase.0.80.AFR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.90.AFR = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.90"), Mean.Impute5.BEAGLE_Phase.0.90.AFR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.95.AFR = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.95"), Mean.Impute5.BEAGLE_Phase.0.95.AFR, NA))
    
    Impute5_info <- colMeans(Impute5_info[-1], na.rm = TRUE) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute5_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute5_info) <- c("Filter","Imp")
        Impute5_plot <- geom_line(data = Impute5_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 1,  color = "Impute5"), 
                         inherit.aes = FALSE)
        
        Minimac4_inf <- plot_method_vs_indiv("Minimac4", "BEAGLE_Phase", "AFR", plot = FALSE)[[2]]
    Minimac4_info <- Minimac4_inf %>% 
          mutate(Mean.Minimac4.BEAGLE_Phase.0.00.AFR = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.00"), Mean.Minimac4.BEAGLE_Phase.0.00.AFR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.30.AFR = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.30"), Mean.Minimac4.BEAGLE_Phase.0.30.AFR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.50.AFR = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.50"), Mean.Minimac4.BEAGLE_Phase.0.50.AFR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.70.AFR = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.70"), Mean.Minimac4.BEAGLE_Phase.0.70.AFR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.80.AFR = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.80"), Mean.Minimac4.BEAGLE_Phase.0.80.AFR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.90.AFR = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.90"), Mean.Minimac4.BEAGLE_Phase.0.90.AFR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.95.AFR = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.95"), Mean.Minimac4.BEAGLE_Phase.0.95.AFR, NA))
    
    Minimac4_info <- colMeans(Minimac4_info[-1], na.rm = TRUE) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Minimac4_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Minimac4_info) <- c("Filter", "Imp")
        Minimac4_plot <- geom_line(data = Minimac4_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 1,  color = "Minimac4"), 
                         inherit.aes = FALSE)
          
        pop_plot <- ggplot() + Beagle_plot + Impute2_plot + Impute5_plot + Minimac4_plot + 
               labs(x = "GP Filter", y = expression("Imputability ("~r^2~")"), 
                    title = "Inversion Imputability with Inversions Filtered",
                    subtitle = paste0("All Methods, ", "BEAGLE_Phase Phasing AFR Population")) +
              scale_x_continuous(breaks = c(0.00, 0.30, 0.50, 0.70, 0.80, 0.90, 0.95), labels = c("0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) +
              scale_color_manual(values = method_colors,
#                                 labels = c("Beagle", "Impute2", "Impute5", "Minimac4"),
                                 name = c()) +
            theme(plot.title = element_text(hjust = 0.5),
                  plot.subtitle = element_text(hjust = 0.3),
                  axis.title = element_text(size = 9),
                  legend.position = "bottom")
        plot_list[[1]] <- ggplotGrob(pop_plot)
        Poli <- AFR_Info[AFR_Info$V2 == "Polymorphic",]$V1
        Beagle_list <- InvNA(Beagle_inf)
        Impute2_list <- InvNA(Impute2_inf)
        Impute5_list <- InvNA(Impute5_inf)
        Minimac4_list <- InvNA(Minimac4_inf)
        
        DF <-  data.frame(
          Method = c("Beagle", "Impute2", "Impute5", "Minimac4"),
          "0.00" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","AFR","0.00"),Beagle_list[[1]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","AFR","0.00"),Impute2_list[[1]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","AFR","0.00"),Impute5_list[[1]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","AFR","0.00"),Minimac4_list[[1]]$INV)))),
          "0.30" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","AFR","0.30"),Beagle_list[[2]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","AFR","0.30"),Impute2_list[[2]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","AFR","0.30"),Impute5_list[[2]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","AFR","0.30"),Minimac4_list[[2]]$INV)))),
          "0.50" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","AFR","0.50"),Beagle_list[[3]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","AFR","0.50"),Impute2_list[[3]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","AFR","0.50"),Impute5_list[[3]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","AFR","0.50"),Minimac4_list[[3]]$INV)))),
          "0.70" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","AFR","0.70"),Beagle_list[[4]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","AFR","0.70"),Impute2_list[[4]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","AFR","0.70"),Impute5_list[[4]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","AFR","0.70"),Minimac4_list[[4]]$INV)))),
          "0.80" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","AFR","0.80"),Beagle_list[[5]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","AFR","0.80"),Impute2_list[[5]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","AFR","0.80"),Impute5_list[[5]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","AFR","0.80"),Minimac4_list[[5]]$INV)))),
          "0.90" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","AFR","0.90"),Beagle_list[[6]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","AFR","0.90"),Impute2_list[[6]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","AFR","0.90"),Impute5_list[[6]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","AFR","0.90"),Minimac4_list[[6]]$INV)))),
          "0.95" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","AFR","0.95"),Beagle_list[[7]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","AFR","0.95"),Impute2_list[[7]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","AFR","0.95"),Impute5_list[[7]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","AFR","0.95"),Minimac4_list[[7]]$INV)))))
        plot_list[[2]] <- tableGrob(DF, rows = c(), cols = c("Method", "0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) 
        # DF <-  data.frame(
        #   Method = c("Beagle", "Impute2", "Impute5", "Minimac4"),
        #   "0.00" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.00"))),length(intersect(Poli,check_loss("Impute2",pop,"0.00"))),length(intersect(Poli,check_loss("Impute5",pop,"0.00"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.00")))),
        #   "0.30" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.30"))),length(intersect(Poli,check_loss("Impute2",pop,"0.30"))),length(intersect(Poli,check_loss("Impute5",pop,"0.30"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.30")))),
        #   "0.50" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.50"))),length(intersect(Poli,check_loss("Impute2",pop,"0.50"))),length(intersect(Poli,check_loss("Impute5",pop,"0.50"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.50")))),
        #   "0.70" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.70"))),length(intersect(Poli,check_loss("Impute2",pop,"0.70"))),length(intersect(Poli,check_loss("Impute5",pop,"0.70"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.70")))),
        #   "0.80" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.80"))),length(intersect(Poli,check_loss("Impute2",pop,"0.80"))),length(intersect(Poli,check_loss("Impute5",pop,"0.80"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.80")))),
        #   "0.90" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.90"))),length(intersect(Poli,check_loss("Impute2",pop,"0.90"))),length(intersect(Poli,check_loss("Impute5",pop,"0.90"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.90")))),
        #   "0.95" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.95"))),length(intersect(Poli,check_loss("Impute2",pop,"0.95"))),length(intersect(Poli,check_loss("Impute5",pop,"0.95"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.95"))))
        #   )
        # plot_list[[i+1]] <- tableGrob(DF, rows = c(), cols = c("Method", "0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) 
        # i <- i + 2
            Beagle_inf <- plot_method_vs_indiv("Beagle", "BEAGLE_Phase", "EUR", plot = FALSE)[[2]]
   Beagle_info <- Beagle_inf %>% 
          mutate(Mean.Beagle.BEAGLE_Phase.0.00.EUR = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.00"), Mean.Beagle.BEAGLE_Phase.0.00.EUR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.30.EUR = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.30"), Mean.Beagle.BEAGLE_Phase.0.30.EUR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.50.EUR = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.50"), Mean.Beagle.BEAGLE_Phase.0.50.EUR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.70.EUR = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.70"), Mean.Beagle.BEAGLE_Phase.0.70.EUR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.80.EUR = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.80"), Mean.Beagle.BEAGLE_Phase.0.80.EUR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.90.EUR = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.90"), Mean.Beagle.BEAGLE_Phase.0.90.EUR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.95.EUR = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.95"), Mean.Beagle.BEAGLE_Phase.0.95.EUR, NA))
    
    Beagle_info <- colMeans(Beagle_info[-1], na.rm = TRUE) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Beagle_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Beagle_info) <- c("Filter","Imp")
        Beagle_plot <- geom_line(data = Beagle_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 1,  color = "Beagle"), 
                         inherit.aes = FALSE)
        
        Impute2_inf <- plot_method_vs_indiv("Impute2", "BEAGLE_Phase", "EUR", plot = FALSE)[[2]]
    Impute2_info <- Impute2_inf %>% 
          mutate(Mean.Impute2.BEAGLE_Phase.0.00.EUR = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.00"), Mean.Impute2.BEAGLE_Phase.0.00.EUR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.30.EUR = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.30"), Mean.Impute2.BEAGLE_Phase.0.30.EUR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.50.EUR = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.50"), Mean.Impute2.BEAGLE_Phase.0.50.EUR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.70.EUR = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.70"), Mean.Impute2.BEAGLE_Phase.0.70.EUR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.80.EUR = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.80"), Mean.Impute2.BEAGLE_Phase.0.80.EUR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.90.EUR = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.90"), Mean.Impute2.BEAGLE_Phase.0.90.EUR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.95.EUR = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.95"), Mean.Impute2.BEAGLE_Phase.0.95.EUR, NA))
    
    Impute2_info <- colMeans(Impute2_info[-1], na.rm = TRUE) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute2_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute2_info) <- c("Filter", "Imp")
        Impute2_plot <- geom_line(data = Impute2_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 1,  color = "Impute2"), 
                         inherit.aes = FALSE)
        
        Impute5_inf <- plot_method_vs_indiv("Impute5", "BEAGLE_Phase", "EUR", plot = FALSE)[[2]]
    Impute5_info <- Impute5_inf %>% 
          mutate(Mean.Impute5.BEAGLE_Phase.0.00.EUR = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.00"), Mean.Impute5.BEAGLE_Phase.0.00.EUR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.30.EUR = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.30"), Mean.Impute5.BEAGLE_Phase.0.30.EUR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.50.EUR = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.50"), Mean.Impute5.BEAGLE_Phase.0.50.EUR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.70.EUR = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.70"), Mean.Impute5.BEAGLE_Phase.0.70.EUR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.80.EUR = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.80"), Mean.Impute5.BEAGLE_Phase.0.80.EUR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.90.EUR = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.90"), Mean.Impute5.BEAGLE_Phase.0.90.EUR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.95.EUR = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.95"), Mean.Impute5.BEAGLE_Phase.0.95.EUR, NA))
    
    Impute5_info <- colMeans(Impute5_info[-1], na.rm = TRUE) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute5_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute5_info) <- c("Filter", "Imp")
        Impute5_plot <- geom_line(data = Impute5_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 1,  color = "Impute5"), 
                         inherit.aes = FALSE)
        
        Minimac4_inf <- plot_method_vs_indiv("Minimac4", "BEAGLE_Phase", "EUR", plot = FALSE)[[2]]
    Minimac4_info <- Minimac4_inf %>% 
         mutate(Mean.Minimac4.BEAGLE_Phase.0.00.EUR = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.00"), Mean.Minimac4.BEAGLE_Phase.0.00.EUR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.30.EUR = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.30"), Mean.Minimac4.BEAGLE_Phase.0.30.EUR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.50.EUR = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.50"), Mean.Minimac4.BEAGLE_Phase.0.50.EUR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.70.EUR = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.70"), Mean.Minimac4.BEAGLE_Phase.0.70.EUR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.80.EUR = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.80"), Mean.Minimac4.BEAGLE_Phase.0.80.EUR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.90.EUR = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.90"), Mean.Minimac4.BEAGLE_Phase.0.90.EUR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.95.EUR = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.95"), Mean.Minimac4.BEAGLE_Phase.0.95.EUR, NA))
    
    Minimac4_info <- colMeans(Minimac4_info[-1], na.rm = TRUE) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Minimac4_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Minimac4_info) <- c("Filter", "Imp")
        Minimac4_plot <- geom_line(data = Minimac4_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 1,  color = "Minimac4"), 
                         inherit.aes = FALSE)
          
        pop_plot <- ggplot() + Beagle_plot + Impute2_plot + Impute5_plot + Minimac4_plot + 
               labs(x = "GP Filter", y = expression("Imputability ("~r^2~")"), 
                    title = "Inversion Imputability with Inversions Filtered",
                    subtitle = paste0("All Methods, ", "BEAGLE_Phase Phasing EUR Population")) +
              scale_x_continuous(breaks = c(0.00, 0.30, 0.50, 0.70, 0.80, 0.90, 0.95), labels = c("0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) +
              scale_color_manual(values = method_colors,
#                                 labels = c("Beagle", "Impute2", "Impute5", "Minimac4"),
                                 name = c()) +
            theme(plot.title = element_text(hjust = 0.5),
                  plot.subtitle = element_text(hjust = 0.3),
                  axis.title = element_text(size = 9),
                  legend.position = "bottom")
        plot_list[[3]] <- ggplotGrob(pop_plot)

        Poli <- EUR_Info[EUR_Info$V2 == "Polymorphic",]$V1
        Beagle_list <- InvNA(Beagle_inf)
        Impute2_list <- InvNA(Impute2_inf)
        Impute5_list <- InvNA(Impute5_inf)
        Minimac4_list <- InvNA(Minimac4_inf)
        
        DF <-  data.frame(
          Method = c("Beagle", "Impute2", "Impute5", "Minimac4"),
          "0.00" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","EUR","0.00"),Beagle_list[[1]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","EUR","0.00"),Impute2_list[[1]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","EUR","0.00"),Impute5_list[[1]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","EUR","0.00"),Minimac4_list[[1]]$INV)))),
          "0.30" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","EUR","0.30"),Beagle_list[[2]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","EUR","0.30"),Impute2_list[[2]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","EUR","0.30"),Impute5_list[[2]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","EUR","0.30"),Minimac4_list[[2]]$INV)))),
          "0.50" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","EUR","0.50"),Beagle_list[[3]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","EUR","0.50"),Impute2_list[[3]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","EUR","0.50"),Impute5_list[[3]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","EUR","0.50"),Minimac4_list[[3]]$INV)))),
          "0.70" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","EUR","0.70"),Beagle_list[[4]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","EUR","0.70"),Impute2_list[[4]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","EUR","0.70"),Impute5_list[[4]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","EUR","0.70"),Minimac4_list[[4]]$INV)))),
          "0.80" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","EUR","0.80"),Beagle_list[[5]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","EUR","0.80"),Impute2_list[[5]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","EUR","0.80"),Impute5_list[[5]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","EUR","0.80"),Minimac4_list[[5]]$INV)))),
          "0.90" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","EUR","0.90"),Beagle_list[[6]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","EUR","0.90"),Impute2_list[[6]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","EUR","0.90"),Impute5_list[[6]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","EUR","0.90"),Minimac4_list[[6]]$INV)))),
          "0.95" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","EUR","0.95"),Beagle_list[[7]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","EUR","0.95"),Impute2_list[[7]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","EUR","0.95"),Impute5_list[[7]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","EUR","0.95"),Minimac4_list[[7]]$INV)))))
        plot_list[[4]] <- tableGrob(DF, rows = c(), cols = c("Method", "0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95"))         
        
        
            Beagle_inf <- plot_method_vs_indiv("Beagle", "BEAGLE_Phase", "EAS", plot = FALSE)[[2]]
    Beagle_info <- Beagle_inf %>% 
         mutate(Mean.Beagle.BEAGLE_Phase.0.00.EAS = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.00"), Mean.Beagle.BEAGLE_Phase.0.00.EAS, NA),
                 Mean.Beagle.BEAGLE_Phase.0.30.EAS = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.30"), Mean.Beagle.BEAGLE_Phase.0.30.EAS, NA),
                 Mean.Beagle.BEAGLE_Phase.0.50.EAS = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.50"), Mean.Beagle.BEAGLE_Phase.0.50.EAS, NA),
                 Mean.Beagle.BEAGLE_Phase.0.70.EAS = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.70"), Mean.Beagle.BEAGLE_Phase.0.70.EAS, NA),
                 Mean.Beagle.BEAGLE_Phase.0.80.EAS = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.80"), Mean.Beagle.BEAGLE_Phase.0.80.EAS, NA),
                 Mean.Beagle.BEAGLE_Phase.0.90.EAS = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.90"), Mean.Beagle.BEAGLE_Phase.0.90.EAS, NA),
                 Mean.Beagle.BEAGLE_Phase.0.95.EAS = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.95"), Mean.Beagle.BEAGLE_Phase.0.95.EAS, NA))
    Beagle_info <- colMeans(Beagle_info[-1], na.rm = TRUE) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Beagle_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Beagle_info) <- c("Filter","Imp")
        Beagle_plot <- geom_line(data = Beagle_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 1,  color = "Beagle"), 
                         inherit.aes = FALSE)
        
        Impute2_inf <- plot_method_vs_indiv("Impute2", "BEAGLE_Phase", "EAS", plot = FALSE)[[2]]
    Impute2_info <- Impute2_inf %>% 
          mutate(Mean.Impute2.BEAGLE_Phase.0.00.EAS = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.00"), Mean.Impute2.BEAGLE_Phase.0.00.EAS, NA),
                 Mean.Impute2.BEAGLE_Phase.0.30.EAS = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.30"), Mean.Impute2.BEAGLE_Phase.0.30.EAS, NA),
                 Mean.Impute2.BEAGLE_Phase.0.50.EAS = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.50"), Mean.Impute2.BEAGLE_Phase.0.50.EAS, NA),
                 Mean.Impute2.BEAGLE_Phase.0.70.EAS = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.70"), Mean.Impute2.BEAGLE_Phase.0.70.EAS, NA),
                 Mean.Impute2.BEAGLE_Phase.0.80.EAS = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.80"), Mean.Impute2.BEAGLE_Phase.0.80.EAS, NA),
                 Mean.Impute2.BEAGLE_Phase.0.90.EAS = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.90"), Mean.Impute2.BEAGLE_Phase.0.90.EAS, NA),
                 Mean.Impute2.BEAGLE_Phase.0.95.EAS = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.95"), Mean.Impute2.BEAGLE_Phase.0.95.EAS, NA))
    Impute2_info <- colMeans(Impute2_info[-1], na.rm = TRUE) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute2_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute2_info) <- c("Filter", "Imp")
        Impute2_plot <- geom_line(data = Impute2_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 1,  color = "Impute2"), 
                         inherit.aes = FALSE)
        
        Impute5_inf <- plot_method_vs_indiv("Impute5", "BEAGLE_Phase", "EAS", plot = FALSE)[[2]]
    Impute5_info <- Impute5_inf %>% 
          mutate(Mean.Impute5.BEAGLE_Phase.0.00.EAS = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.00"), Mean.Impute5.BEAGLE_Phase.0.00.EAS, NA),
                 Mean.Impute5.BEAGLE_Phase.0.30.EAS = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.30"), Mean.Impute5.BEAGLE_Phase.0.30.EAS, NA),
                 Mean.Impute5.BEAGLE_Phase.0.50.EAS = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.50"), Mean.Impute5.BEAGLE_Phase.0.50.EAS, NA),
                 Mean.Impute5.BEAGLE_Phase.0.70.EAS = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.70"), Mean.Impute5.BEAGLE_Phase.0.70.EAS, NA),
                 Mean.Impute5.BEAGLE_Phase.0.80.EAS = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.80"), Mean.Impute5.BEAGLE_Phase.0.80.EAS, NA),
                 Mean.Impute5.BEAGLE_Phase.0.90.EAS = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.90"), Mean.Impute5.BEAGLE_Phase.0.90.EAS, NA),
                 Mean.Impute5.BEAGLE_Phase.0.95.EAS = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.95"), Mean.Impute5.BEAGLE_Phase.0.95.EAS, NA))
    
    Impute5_info <- colMeans(Impute5_info[-1], na.rm = TRUE) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute5_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute5_info) <- c("Filter","Imp")
        Impute5_plot <- geom_line(data = Impute5_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 1,  color = "Impute5"), 
                         inherit.aes = FALSE)
        
        Minimac4_inf <- plot_method_vs_indiv("Minimac4", "BEAGLE_Phase", "EAS", plot = FALSE)[[2]]
    Minimac4_info <- Minimac4_inf %>% 
          mutate(Mean.Minimac4.BEAGLE_Phase.0.00.EAS = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.00"), Mean.Minimac4.BEAGLE_Phase.0.00.EAS, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.30.EAS = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.30"), Mean.Minimac4.BEAGLE_Phase.0.30.EAS, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.50.EAS = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.50"), Mean.Minimac4.BEAGLE_Phase.0.50.EAS, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.70.EAS = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.70"), Mean.Minimac4.BEAGLE_Phase.0.70.EAS, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.80.EAS = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.80"), Mean.Minimac4.BEAGLE_Phase.0.80.EAS, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.90.EAS = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.90"), Mean.Minimac4.BEAGLE_Phase.0.90.EAS, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.95.EAS = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.95"), Mean.Minimac4.BEAGLE_Phase.0.95.EAS, NA))
    
    Minimac4_info <- colMeans(Minimac4_info[-1], na.rm = TRUE) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Minimac4_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Minimac4_info) <- c("Filter", "Imp")
        Minimac4_plot <- geom_line(data = Minimac4_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 1,  color = "Minimac4"), 
                         inherit.aes = FALSE)
          
        pop_plot <- ggplot() + Beagle_plot + Impute2_plot + Impute5_plot + Minimac4_plot + 
               labs(x = "GP Filter", y = expression("Imputability ("~r^2~")"), 
                    title = "Inversion Imputability with Inversions Filtered",
                    subtitle = paste0("All Methods, ", "BEAGLE_Phase Phasing EAS Population")) +
              scale_x_continuous(breaks = c(0.00, 0.30, 0.50, 0.70, 0.80, 0.90, 0.95), labels = c("0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) +
              scale_color_manual(values = method_colors,
#                                 labels = c("Beagle", "Impute2", "Impute5", "Minimac4"),
                                 name = c()) +
            theme(plot.title = element_text(hjust = 0.5),
                  plot.subtitle = element_text(hjust = 0.3),
                  axis.title = element_text(size = 9),
                  legend.position = "bottom")
        plot_list[[5]] <- ggplotGrob(pop_plot)
        
        Poli <- EAS_Info[EAS_Info$V2 == "Polymorphic",]$V1
        Beagle_list <- InvNA(Beagle_inf)
        Impute2_list <- InvNA(Impute2_inf)
        Impute5_list <- InvNA(Impute5_inf)
        Minimac4_list <- InvNA(Minimac4_inf)
        
        DF <-  data.frame(
          Method = c("Beagle", "Impute2", "Impute5", "Minimac4"),
          "0.00" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","EAS","0.00"),Beagle_list[[1]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","EAS","0.00"),Impute2_list[[1]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","EAS","0.00"),Impute5_list[[1]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","EAS","0.00"),Minimac4_list[[1]]$INV)))),
          "0.30" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","EAS","0.30"),Beagle_list[[2]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","EAS","0.30"),Impute2_list[[2]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","EAS","0.30"),Impute5_list[[2]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","EAS","0.30"),Minimac4_list[[2]]$INV)))),
          "0.50" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","EAS","0.50"),Beagle_list[[3]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","EAS","0.50"),Impute2_list[[3]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","EAS","0.50"),Impute5_list[[3]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","EAS","0.50"),Minimac4_list[[3]]$INV)))),
          "0.70" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","EAS","0.70"),Beagle_list[[4]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","EAS","0.70"),Impute2_list[[4]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","EAS","0.70"),Impute5_list[[4]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","EAS","0.70"),Minimac4_list[[4]]$INV)))),
          "0.80" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","EAS","0.80"),Beagle_list[[5]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","EAS","0.80"),Impute2_list[[5]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","EAS","0.80"),Impute5_list[[5]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","EAS","0.80"),Minimac4_list[[5]]$INV)))),
          "0.90" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","EAS","0.90"),Beagle_list[[6]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","EAS","0.90"),Impute2_list[[6]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","EAS","0.90"),Impute5_list[[6]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","EAS","0.90"),Minimac4_list[[6]]$INV)))),
          "0.95" = c(length(Reduce(intersect, list(Poli,check_loss("Beagle","EAS","0.95"),Beagle_list[[7]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute2","EAS","0.95"),Impute2_list[[7]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Impute5","EAS","0.95"),Impute5_list[[7]]$INV))),length(Reduce(intersect, list(Poli,check_loss("Minimac4","EAS","0.95"),Minimac4_list[[7]]$INV)))))
        plot_list[[6]] <- tableGrob(DF, rows = c(), cols = c("Method", "0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) 
```


```{r, warning=FALSE}
grid.arrange(plot_list[[1]], plot_list[[2]], ncol = 1, heights = c(2,1))
grid.arrange(plot_list[[3]], plot_list[[4]], ncol = 1, heights = c(2,1))
grid.arrange(plot_list[[5]], plot_list[[6]], ncol = 1, heights = c(2,1))
```

```{r}
    plot_list <- list()
    methods <- c("Beagle", "Impute2", "Impute5", "Minimac4")
    method_colors <- c(Beagle = "#F8766D", Impute2 = "#00BFC4", Impute5 = "#7CAE00", Minimac4 = "#C77CFF")
    
    Beagle_inf <- plot_method_vs_indiv("Beagle", "BEAGLE_Phase", "AFR", plot = FALSE)[[2]]
    Beagle_info <- Beagle_inf %>% 
          mutate(Mean.Beagle.BEAGLE_Phase.0.00.AFR = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.00"), Mean.Beagle.BEAGLE_Phase.0.00.AFR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.30.AFR = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.30"), Mean.Beagle.BEAGLE_Phase.0.30.AFR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.50.AFR = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.50"), Mean.Beagle.BEAGLE_Phase.0.50.AFR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.70.AFR = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.70"), Mean.Beagle.BEAGLE_Phase.0.70.AFR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.80.AFR = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.80"), Mean.Beagle.BEAGLE_Phase.0.80.AFR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.90.AFR = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.90"), Mean.Beagle.BEAGLE_Phase.0.90.AFR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.95.AFR = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.95"), Mean.Beagle.BEAGLE_Phase.0.95.AFR, NA))
    
    Beagle_info <- apply(Beagle_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Beagle_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Beagle_info) <- c("Filter", "Imp")
        Beagle_plot <- geom_line(data = Beagle_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Beagle"), 
                         inherit.aes = FALSE)
        
        Impute2_inf <- plot_method_vs_indiv("Impute2", "BEAGLE_Phase", "AFR", plot = FALSE)[[2]]
    Impute2_info <- Impute2_inf %>% 
          mutate(Mean.Impute2.BEAGLE_Phase.0.00.AFR = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.00"), Mean.Impute2.BEAGLE_Phase.0.00.AFR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.30.AFR = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.30"), Mean.Impute2.BEAGLE_Phase.0.30.AFR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.50.AFR = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.50"), Mean.Impute2.BEAGLE_Phase.0.50.AFR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.70.AFR = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.70"), Mean.Impute2.BEAGLE_Phase.0.70.AFR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.80.AFR = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.80"), Mean.Impute2.BEAGLE_Phase.0.80.AFR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.90.AFR = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.90"), Mean.Impute2.BEAGLE_Phase.0.90.AFR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.95.AFR = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.95"), Mean.Impute2.BEAGLE_Phase.0.95.AFR, NA))

    Impute2_info <- apply(Impute2_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute2_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute2_info) <- c("Filter", "Imp")
        Impute2_plot <- geom_line(data = Impute2_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Impute2"), 
                         inherit.aes = FALSE)
        
        Impute5_inf <- plot_method_vs_indiv("Impute5", "BEAGLE_Phase", "AFR", plot = FALSE)[[2]]
    Impute5_info <- Impute5_inf %>% 
          mutate(Mean.Impute5.BEAGLE_Phase.0.00.AFR = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.00"), Mean.Impute5.BEAGLE_Phase.0.00.AFR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.30.AFR = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.30"), Mean.Impute5.BEAGLE_Phase.0.30.AFR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.50.AFR = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.50"), Mean.Impute5.BEAGLE_Phase.0.50.AFR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.70.AFR = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.70"), Mean.Impute5.BEAGLE_Phase.0.70.AFR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.80.AFR = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.80"), Mean.Impute5.BEAGLE_Phase.0.80.AFR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.90.AFR = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.90"), Mean.Impute5.BEAGLE_Phase.0.90.AFR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.95.AFR = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.95"), Mean.Impute5.BEAGLE_Phase.0.95.AFR, NA))
    
    Impute5_info <- apply(Impute5_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute5_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute5_info) <- c("Filter","Imp")
        Impute5_plot <- geom_line(data = Impute5_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Impute5"), 
                         inherit.aes = FALSE)
        
        Minimac4_inf <- plot_method_vs_indiv("Minimac4", "BEAGLE_Phase", "AFR", plot = FALSE)[[2]]
    Minimac4_info <- Minimac4_inf %>% 
          mutate(Mean.Minimac4.BEAGLE_Phase.0.00.AFR = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.00"), Mean.Minimac4.BEAGLE_Phase.0.00.AFR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.30.AFR = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.30"), Mean.Minimac4.BEAGLE_Phase.0.30.AFR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.50.AFR = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.50"), Mean.Minimac4.BEAGLE_Phase.0.50.AFR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.70.AFR = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.70"), Mean.Minimac4.BEAGLE_Phase.0.70.AFR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.80.AFR = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.80"), Mean.Minimac4.BEAGLE_Phase.0.80.AFR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.90.AFR = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.90"), Mean.Minimac4.BEAGLE_Phase.0.90.AFR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.95.AFR = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.95"), Mean.Minimac4.BEAGLE_Phase.0.95.AFR, NA))
    
    Minimac4_info <- apply(Minimac4_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Minimac4_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Minimac4_info) <- c("Filter", "Imp")
        Minimac4_plot <- geom_line(data = Minimac4_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Minimac4"), 
                         inherit.aes = FALSE)
          
        pop_plot <- ggplot() + Beagle_plot + Impute2_plot + Impute5_plot + Minimac4_plot + 
               labs(x = "GP Filter", y = "Num of Inversions", 
                    title = "Imputable Inversions with Inversions Filtered",
                    subtitle = paste0("All Methods, ", "BEAGLE_Phase Phasing AFR Population")) +
              scale_x_continuous(breaks = c(0.00, 0.30, 0.50, 0.70, 0.80, 0.90, 0.95), labels = c("0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) +
              scale_color_manual(values = method_colors,
#                                 labels = c("Beagle", "Impute2", "Impute5", "Minimac4"),
                                 name = c()) +
            theme(plot.title = element_text(hjust = 0.5),
                  plot.subtitle = element_text(hjust = 0.3),
                  axis.title = element_text(size = 9),
                  legend.position = "bottom")
        plot_list[[1]] <- ggplotGrob(pop_plot)
        Poli <- AFR_Info[AFR_Info$V2 == "Polymorphic",]$V1
        Beagle_list <- InvNA(Beagle_inf)
        Impute2_list <- InvNA(Impute2_inf)
        Impute5_list <- InvNA(Impute5_inf)
        Minimac4_list <- InvNA(Minimac4_inf)
        
       DF <-  data.frame(
          Method = c("Beagle", "Impute2", "Impute5", "Minimac4"),
          "0.00" = c(Beagle_info$Imp[1],Impute2_info$Imp[1],Impute5_info$Imp[1],Minimac4_info$Imp[1]),
          "0.30" = c(Beagle_info$Imp[2],Impute2_info$Imp[2],Impute5_info$Imp[2],Minimac4_info$Imp[2]),
          "0.50" = c(Beagle_info$Imp[3],Impute2_info$Imp[3],Impute5_info$Imp[3],Minimac4_info$Imp[3]),
          "0.70" = c(Beagle_info$Imp[4],Impute2_info$Imp[4],Impute5_info$Imp[4],Minimac4_info$Imp[4]),
          "0.80" = c(Beagle_info$Imp[5],Impute2_info$Imp[5],Impute5_info$Imp[5],Minimac4_info$Imp[5]),
          "0.90" = c(Beagle_info$Imp[6],Impute2_info$Imp[6],Impute5_info$Imp[6],Minimac4_info$Imp[6]),
          "0.95" = c(Beagle_info$Imp[7],Impute2_info$Imp[7],Impute5_info$Imp[7],Minimac4_info$Imp[7]))
        plot_list[[2]] <- tableGrob(DF, rows = c(), cols = c("Method", "0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) 
        # DF <-  data.frame(
        #   Method = c("Beagle", "Impute2", "Impute5", "Minimac4"),
        #   "0.00" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.00"))),length(intersect(Poli,check_loss("Impute2",pop,"0.00"))),length(intersect(Poli,check_loss("Impute5",pop,"0.00"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.00")))),
        #   "0.30" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.30"))),length(intersect(Poli,check_loss("Impute2",pop,"0.30"))),length(intersect(Poli,check_loss("Impute5",pop,"0.30"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.30")))),
        #   "0.50" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.50"))),length(intersect(Poli,check_loss("Impute2",pop,"0.50"))),length(intersect(Poli,check_loss("Impute5",pop,"0.50"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.50")))),
        #   "0.70" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.70"))),length(intersect(Poli,check_loss("Impute2",pop,"0.70"))),length(intersect(Poli,check_loss("Impute5",pop,"0.70"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.70")))),
        #   "0.80" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.80"))),length(intersect(Poli,check_loss("Impute2",pop,"0.80"))),length(intersect(Poli,check_loss("Impute5",pop,"0.80"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.80")))),
        #   "0.90" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.90"))),length(intersect(Poli,check_loss("Impute2",pop,"0.90"))),length(intersect(Poli,check_loss("Impute5",pop,"0.90"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.90")))),
        #   "0.95" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.95"))),length(intersect(Poli,check_loss("Impute2",pop,"0.95"))),length(intersect(Poli,check_loss("Impute5",pop,"0.95"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.95"))))
        #   )
        # plot_list[[i+1]] <- tableGrob(DF, rows = c(), cols = c("Method", "0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) 
        # i <- i + 2
            Beagle_inf <- plot_method_vs_indiv("Beagle", "BEAGLE_Phase", "EUR", plot = FALSE)[[2]]
   Beagle_info <- Beagle_inf %>% 
          mutate(Mean.Beagle.BEAGLE_Phase.0.00.EUR = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.00"), Mean.Beagle.BEAGLE_Phase.0.00.EUR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.30.EUR = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.30"), Mean.Beagle.BEAGLE_Phase.0.30.EUR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.50.EUR = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.50"), Mean.Beagle.BEAGLE_Phase.0.50.EUR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.70.EUR = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.70"), Mean.Beagle.BEAGLE_Phase.0.70.EUR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.80.EUR = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.80"), Mean.Beagle.BEAGLE_Phase.0.80.EUR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.90.EUR = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.90"), Mean.Beagle.BEAGLE_Phase.0.90.EUR, NA),
                 Mean.Beagle.BEAGLE_Phase.0.95.EUR = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.95"), Mean.Beagle.BEAGLE_Phase.0.95.EUR, NA))
    
    Beagle_info <- apply(Beagle_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Beagle_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Beagle_info) <- c("Filter","Imp")
        Beagle_plot <- geom_line(data = Beagle_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Beagle"), 
                         inherit.aes = FALSE)
        
        Impute2_inf <- plot_method_vs_indiv("Impute2", "BEAGLE_Phase", "EUR", plot = FALSE)[[2]]
    Impute2_info <- Impute2_inf %>% 
          mutate(Mean.Impute2.BEAGLE_Phase.0.00.EUR = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.00"), Mean.Impute2.BEAGLE_Phase.0.00.EUR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.30.EUR = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.30"), Mean.Impute2.BEAGLE_Phase.0.30.EUR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.50.EUR = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.50"), Mean.Impute2.BEAGLE_Phase.0.50.EUR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.70.EUR = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.70"), Mean.Impute2.BEAGLE_Phase.0.70.EUR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.80.EUR = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.80"), Mean.Impute2.BEAGLE_Phase.0.80.EUR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.90.EUR = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.90"), Mean.Impute2.BEAGLE_Phase.0.90.EUR, NA),
                 Mean.Impute2.BEAGLE_Phase.0.95.EUR = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.95"), Mean.Impute2.BEAGLE_Phase.0.95.EUR, NA))
    
    Impute2_info <- apply(Impute2_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute2_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute2_info) <- c("Filter", "Imp")
        Impute2_plot <- geom_line(data = Impute2_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Impute2"), 
                         inherit.aes = FALSE)
        
        Impute5_inf <- plot_method_vs_indiv("Impute5", "BEAGLE_Phase", "EUR", plot = FALSE)[[2]]
    Impute5_info <- Impute5_inf %>% 
          mutate(Mean.Impute5.BEAGLE_Phase.0.00.EUR = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.00"), Mean.Impute5.BEAGLE_Phase.0.00.EUR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.30.EUR = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.30"), Mean.Impute5.BEAGLE_Phase.0.30.EUR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.50.EUR = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.50"), Mean.Impute5.BEAGLE_Phase.0.50.EUR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.70.EUR = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.70"), Mean.Impute5.BEAGLE_Phase.0.70.EUR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.80.EUR = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.80"), Mean.Impute5.BEAGLE_Phase.0.80.EUR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.90.EUR = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.90"), Mean.Impute5.BEAGLE_Phase.0.90.EUR, NA),
                 Mean.Impute5.BEAGLE_Phase.0.95.EUR = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.95"), Mean.Impute5.BEAGLE_Phase.0.95.EUR, NA))
    
    Impute5_info <- apply(Impute5_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute5_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute5_info) <- c("Filter", "Imp")
        Impute5_plot <- geom_line(data = Impute5_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Impute5"), 
                         inherit.aes = FALSE)
        
        Minimac4_inf <- plot_method_vs_indiv("Minimac4", "BEAGLE_Phase", "EUR", plot = FALSE)[[2]]
    Minimac4_info <- Minimac4_inf %>% 
         mutate(Mean.Minimac4.BEAGLE_Phase.0.00.EUR = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.00"), Mean.Minimac4.BEAGLE_Phase.0.00.EUR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.30.EUR = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.30"), Mean.Minimac4.BEAGLE_Phase.0.30.EUR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.50.EUR = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.50"), Mean.Minimac4.BEAGLE_Phase.0.50.EUR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.70.EUR = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.70"), Mean.Minimac4.BEAGLE_Phase.0.70.EUR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.80.EUR = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.80"), Mean.Minimac4.BEAGLE_Phase.0.80.EUR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.90.EUR = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.90"), Mean.Minimac4.BEAGLE_Phase.0.90.EUR, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.95.EUR = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.95"), Mean.Minimac4.BEAGLE_Phase.0.95.EUR, NA))
    
    Minimac4_info <- apply(Minimac4_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Minimac4_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Minimac4_info) <- c("Filter", "Imp")
        Minimac4_plot <- geom_line(data = Minimac4_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Minimac4"), 
                         inherit.aes = FALSE)
          
        pop_plot <- ggplot() + Beagle_plot + Impute2_plot + Impute5_plot + Minimac4_plot + 
               labs(x = "GP Filter", y = "Num of Inversions", 
                    title = "Imputable Inversions with Inversions Filtered",
                    subtitle = paste0("All Methods, ", "BEAGLE_Phase Phasing EUR Population")) +
              scale_x_continuous(breaks = c(0.00, 0.30, 0.50, 0.70, 0.80, 0.90, 0.95), labels = c("0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) +
              scale_color_manual(values = method_colors,
#                                 labels = c("Beagle", "Impute2", "Impute5", "Minimac4"),
                                 name = c()) +
            theme(plot.title = element_text(hjust = 0.5),
                  plot.subtitle = element_text(hjust = 0.3),
                  axis.title = element_text(size = 9),
                  legend.position = "bottom")
        plot_list[[3]] <- ggplotGrob(pop_plot)

        Poli <- EUR_Info[EUR_Info$V2 == "Polymorphic",]$V1
        Beagle_list <- InvNA(Beagle_inf)
        Impute2_list <- InvNA(Impute2_inf)
        Impute5_list <- InvNA(Impute5_inf)
        Minimac4_list <- InvNA(Minimac4_inf)
        
               DF <-  data.frame(
          Method = c("Beagle", "Impute2", "Impute5", "Minimac4"),
          "0.00" = c(Beagle_info$Imp[1],Impute2_info$Imp[1],Impute5_info$Imp[1],Minimac4_info$Imp[1]),
          "0.30" = c(Beagle_info$Imp[2],Impute2_info$Imp[2],Impute5_info$Imp[2],Minimac4_info$Imp[2]),
          "0.50" = c(Beagle_info$Imp[3],Impute2_info$Imp[3],Impute5_info$Imp[3],Minimac4_info$Imp[3]),
          "0.70" = c(Beagle_info$Imp[4],Impute2_info$Imp[4],Impute5_info$Imp[4],Minimac4_info$Imp[4]),
          "0.80" = c(Beagle_info$Imp[5],Impute2_info$Imp[5],Impute5_info$Imp[5],Minimac4_info$Imp[5]),
          "0.90" = c(Beagle_info$Imp[6],Impute2_info$Imp[6],Impute5_info$Imp[6],Minimac4_info$Imp[6]),
          "0.95" = c(Beagle_info$Imp[7],Impute2_info$Imp[7],Impute5_info$Imp[7],Minimac4_info$Imp[7]))
        plot_list[[4]] <- tableGrob(DF, rows = c(), cols = c("Method", "0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95"))         
        
        
            Beagle_inf <- plot_method_vs_indiv("Beagle", "BEAGLE_Phase", "EAS", plot = FALSE)[[2]]
    Beagle_info <- Beagle_inf %>% 
         mutate(Mean.Beagle.BEAGLE_Phase.0.00.EAS = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.00"), Mean.Beagle.BEAGLE_Phase.0.00.EAS, NA),
                 Mean.Beagle.BEAGLE_Phase.0.30.EAS = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.30"), Mean.Beagle.BEAGLE_Phase.0.30.EAS, NA),
                 Mean.Beagle.BEAGLE_Phase.0.50.EAS = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.50"), Mean.Beagle.BEAGLE_Phase.0.50.EAS, NA),
                 Mean.Beagle.BEAGLE_Phase.0.70.EAS = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.70"), Mean.Beagle.BEAGLE_Phase.0.70.EAS, NA),
                 Mean.Beagle.BEAGLE_Phase.0.80.EAS = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.80"), Mean.Beagle.BEAGLE_Phase.0.80.EAS, NA),
                 Mean.Beagle.BEAGLE_Phase.0.90.EAS = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.90"), Mean.Beagle.BEAGLE_Phase.0.90.EAS, NA),
                 Mean.Beagle.BEAGLE_Phase.0.95.EAS = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.95"), Mean.Beagle.BEAGLE_Phase.0.95.EAS, NA))
    Beagle_info <- apply(Beagle_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Beagle_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Beagle_info) <- c("Filter","Imp")
        Beagle_plot <- geom_line(data = Beagle_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Beagle"), 
                         inherit.aes = FALSE)
        
        Impute2_inf <- plot_method_vs_indiv("Impute2", "BEAGLE_Phase", "EAS", plot = FALSE)[[2]]
    Impute2_info <- Impute2_inf %>% 
          mutate(Mean.Impute2.BEAGLE_Phase.0.00.EAS = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.00"), Mean.Impute2.BEAGLE_Phase.0.00.EAS, NA),
                 Mean.Impute2.BEAGLE_Phase.0.30.EAS = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.30"), Mean.Impute2.BEAGLE_Phase.0.30.EAS, NA),
                 Mean.Impute2.BEAGLE_Phase.0.50.EAS = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.50"), Mean.Impute2.BEAGLE_Phase.0.50.EAS, NA),
                 Mean.Impute2.BEAGLE_Phase.0.70.EAS = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.70"), Mean.Impute2.BEAGLE_Phase.0.70.EAS, NA),
                 Mean.Impute2.BEAGLE_Phase.0.80.EAS = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.80"), Mean.Impute2.BEAGLE_Phase.0.80.EAS, NA),
                 Mean.Impute2.BEAGLE_Phase.0.90.EAS = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.90"), Mean.Impute2.BEAGLE_Phase.0.90.EAS, NA),
                 Mean.Impute2.BEAGLE_Phase.0.95.EAS = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.95"), Mean.Impute2.BEAGLE_Phase.0.95.EAS, NA))
    Impute2_info <- apply(Impute2_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute2_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute2_info) <- c("Filter", "Imp")
        Impute2_plot <- geom_line(data = Impute2_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Impute2"), 
                         inherit.aes = FALSE)
        
        Impute5_inf <- plot_method_vs_indiv("Impute5", "BEAGLE_Phase", "EAS", plot = FALSE)[[2]]
    Impute5_info <- Impute5_inf %>% 
          mutate(Mean.Impute5.BEAGLE_Phase.0.00.EAS = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.00"), Mean.Impute5.BEAGLE_Phase.0.00.EAS, NA),
                 Mean.Impute5.BEAGLE_Phase.0.30.EAS = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.30"), Mean.Impute5.BEAGLE_Phase.0.30.EAS, NA),
                 Mean.Impute5.BEAGLE_Phase.0.50.EAS = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.50"), Mean.Impute5.BEAGLE_Phase.0.50.EAS, NA),
                 Mean.Impute5.BEAGLE_Phase.0.70.EAS = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.70"), Mean.Impute5.BEAGLE_Phase.0.70.EAS, NA),
                 Mean.Impute5.BEAGLE_Phase.0.80.EAS = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.80"), Mean.Impute5.BEAGLE_Phase.0.80.EAS, NA),
                 Mean.Impute5.BEAGLE_Phase.0.90.EAS = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.90"), Mean.Impute5.BEAGLE_Phase.0.90.EAS, NA),
                 Mean.Impute5.BEAGLE_Phase.0.95.EAS = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.95"), Mean.Impute5.BEAGLE_Phase.0.95.EAS, NA))
    
    Impute5_info <- apply(Impute5_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute5_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute5_info) <- c("Filter","Imp")
        Impute5_plot <- geom_line(data = Impute5_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Impute5"), 
                         inherit.aes = FALSE)
        
        Minimac4_inf <- plot_method_vs_indiv("Minimac4", "BEAGLE_Phase", "EAS", plot = FALSE)[[2]]
    Minimac4_info <- Minimac4_inf %>% 
          mutate(Mean.Minimac4.BEAGLE_Phase.0.00.EAS = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.00"), Mean.Minimac4.BEAGLE_Phase.0.00.EAS, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.30.EAS = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.30"), Mean.Minimac4.BEAGLE_Phase.0.30.EAS, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.50.EAS = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.50"), Mean.Minimac4.BEAGLE_Phase.0.50.EAS, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.70.EAS = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.70"), Mean.Minimac4.BEAGLE_Phase.0.70.EAS, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.80.EAS = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.80"), Mean.Minimac4.BEAGLE_Phase.0.80.EAS, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.90.EAS = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.90"), Mean.Minimac4.BEAGLE_Phase.0.90.EAS, NA),
                 Mean.Minimac4.BEAGLE_Phase.0.95.EAS = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.95"), Mean.Minimac4.BEAGLE_Phase.0.95.EAS, NA))
    
    Minimac4_info <- apply(Minimac4_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Minimac4_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Minimac4_info) <- c("Filter", "Imp")
        Minimac4_plot <- geom_line(data = Minimac4_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Minimac4"), 
                         inherit.aes = FALSE)
          
        pop_plot <- ggplot() + Beagle_plot + Impute2_plot + Impute5_plot + Minimac4_plot + 
               labs(x = "GP Filter", y = "Num of Inversions", 
                    title = "Imputable inversions with Inversions Filtered",
                    subtitle = paste0("All Methods, ", "BEAGLE_Phase Phasing EAS Population")) +
              scale_x_continuous(breaks = c(0.00, 0.30, 0.50, 0.70, 0.80, 0.90, 0.95), labels = c("0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) +
              scale_color_manual(values = method_colors,
#                                 labels = c("Beagle", "Impute2", "Impute5", "Minimac4"),
                                 name = c()) +
            theme(plot.title = element_text(hjust = 0.5),
                  plot.subtitle = element_text(hjust = 0.3),
                  axis.title = element_text(size = 9),
                  legend.position = "bottom")
        plot_list[[5]] <- ggplotGrob(pop_plot)
        
        Poli <- EAS_Info[EAS_Info$V2 == "Polymorphic",]$V1
        Beagle_list <- InvNA(Beagle_inf)
        Impute2_list <- InvNA(Impute2_inf)
        Impute5_list <- InvNA(Impute5_inf)
        Minimac4_list <- InvNA(Minimac4_inf)
        
               DF <-  data.frame(
          Method = c("Beagle", "Impute2", "Impute5", "Minimac4"),
          "0.00" = c(Beagle_info$Imp[1],Impute2_info$Imp[1],Impute5_info$Imp[1],Minimac4_info$Imp[1]),
          "0.30" = c(Beagle_info$Imp[2],Impute2_info$Imp[2],Impute5_info$Imp[2],Minimac4_info$Imp[2]),
          "0.50" = c(Beagle_info$Imp[3],Impute2_info$Imp[3],Impute5_info$Imp[3],Minimac4_info$Imp[3]),
          "0.70" = c(Beagle_info$Imp[4],Impute2_info$Imp[4],Impute5_info$Imp[4],Minimac4_info$Imp[4]),
          "0.80" = c(Beagle_info$Imp[5],Impute2_info$Imp[5],Impute5_info$Imp[5],Minimac4_info$Imp[5]),
          "0.90" = c(Beagle_info$Imp[6],Impute2_info$Imp[6],Impute5_info$Imp[6],Minimac4_info$Imp[6]),
          "0.95" = c(Beagle_info$Imp[7],Impute2_info$Imp[7],Impute5_info$Imp[7],Minimac4_info$Imp[7]))
        plot_list[[6]] <- tableGrob(DF, rows = c(), cols = c("Method", "0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) 
```

```{r, warning=FALSE}
grid.arrange(plot_list[[1]], plot_list[[2]], ncol = 1, heights = c(2,1))
grid.arrange(plot_list[[3]], plot_list[[4]], ncol = 1, heights = c(2,1))
grid.arrange(plot_list[[5]], plot_list[[6]], ncol = 1, heights = c(2,1))
```

```{r}
    plot_list <- list()
    methods <- c("Beagle", "Impute2", "Impute5", "Minimac4")
    method_colors <- c(Beagle = "#F8766D", Impute2 = "#00BFC4", Impute5 = "#7CAE00", Minimac4 = "#C77CFF")
    
    Beagle_inf <- plot_method_vs_indiv("Beagle", "BEAGLE_Phase", "AFR", plot = FALSE)[[2]]
    Beagle_info <- Beagle_inf
    Beagle_info <- apply(Beagle_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Beagle_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Beagle_info) <- c("Filter", "Imp")
        Beagle_plot <- geom_line(data = Beagle_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Beagle"), 
                         inherit.aes = FALSE)
        
        Impute2_inf <- plot_method_vs_indiv("Impute2", "BEAGLE_Phase", "AFR", plot = FALSE)[[2]]
    Impute2_info <- Impute2_inf 
    Impute2_info <- apply(Impute2_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute2_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute2_info) <- c("Filter", "Imp")
        Impute2_plot <- geom_line(data = Impute2_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Impute2"), 
                         inherit.aes = FALSE)
        
        Impute5_inf <- plot_method_vs_indiv("Impute5", "BEAGLE_Phase", "AFR", plot = FALSE)[[2]]
    Impute5_info <- Impute5_inf 
    Impute5_info <- apply(Impute5_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute5_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute5_info) <- c("Filter","Imp")
        Impute5_plot <- geom_line(data = Impute5_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Impute5"), 
                         inherit.aes = FALSE)
        
        Minimac4_inf <- plot_method_vs_indiv("Minimac4", "BEAGLE_Phase", "AFR", plot = FALSE)[[2]]
    Minimac4_info <- Minimac4_inf 
    Minimac4_info <- apply(Minimac4_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Minimac4_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Minimac4_info) <- c("Filter", "Imp")
        Minimac4_plot <- geom_line(data = Minimac4_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Minimac4"), 
                         inherit.aes = FALSE)
          
        pop_plot <- ggplot() + Beagle_plot + Impute2_plot + Impute5_plot + Minimac4_plot + 
               labs(x = "GP Filter", y = "Num of Inversions", 
                    title = "Imputable Inversions without Inversions Filtered",
                    subtitle = paste0("All Methods, ", "BEAGLE_Phase Phasing AFR Population")) +
              scale_x_continuous(breaks = c(0.00, 0.30, 0.50, 0.70, 0.80, 0.90, 0.95), labels = c("0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) +
              scale_color_manual(values = method_colors,
#                                 labels = c("Beagle", "Impute2", "Impute5", "Minimac4"),
                                 name = c()) +
            theme(plot.title = element_text(hjust = 0.5),
                  plot.subtitle = element_text(hjust = 0.3),
                  axis.title = element_text(size = 9),
                  legend.position = "bottom")
        plot_list[[1]] <- ggplotGrob(pop_plot)
        Poli <- AFR_Info[AFR_Info$V2 == "Polymorphic",]$V1
        Beagle_list <- InvNA(Beagle_inf)
        Impute2_list <- InvNA(Impute2_inf)
        Impute5_list <- InvNA(Impute5_inf)
        Minimac4_list <- InvNA(Minimac4_inf)
        
       DF <-  data.frame(
          Method = c("Beagle", "Impute2", "Impute5", "Minimac4"),
          "0.00" = c(Beagle_info$Imp[1],Impute2_info$Imp[1],Impute5_info$Imp[1],Minimac4_info$Imp[1]),
          "0.30" = c(Beagle_info$Imp[2],Impute2_info$Imp[2],Impute5_info$Imp[2],Minimac4_info$Imp[2]),
          "0.50" = c(Beagle_info$Imp[3],Impute2_info$Imp[3],Impute5_info$Imp[3],Minimac4_info$Imp[3]),
          "0.70" = c(Beagle_info$Imp[4],Impute2_info$Imp[4],Impute5_info$Imp[4],Minimac4_info$Imp[4]),
          "0.80" = c(Beagle_info$Imp[5],Impute2_info$Imp[5],Impute5_info$Imp[5],Minimac4_info$Imp[5]),
          "0.90" = c(Beagle_info$Imp[6],Impute2_info$Imp[6],Impute5_info$Imp[6],Minimac4_info$Imp[6]),
          "0.95" = c(Beagle_info$Imp[7],Impute2_info$Imp[7],Impute5_info$Imp[7],Minimac4_info$Imp[7]))
        plot_list[[2]] <- tableGrob(DF, rows = c(), cols = c("Method", "0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) 
        # DF <-  data.frame(
        #   Method = c("Beagle", "Impute2", "Impute5", "Minimac4"),
        #   "0.00" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.00"))),length(intersect(Poli,check_loss("Impute2",pop,"0.00"))),length(intersect(Poli,check_loss("Impute5",pop,"0.00"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.00")))),
        #   "0.30" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.30"))),length(intersect(Poli,check_loss("Impute2",pop,"0.30"))),length(intersect(Poli,check_loss("Impute5",pop,"0.30"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.30")))),
        #   "0.50" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.50"))),length(intersect(Poli,check_loss("Impute2",pop,"0.50"))),length(intersect(Poli,check_loss("Impute5",pop,"0.50"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.50")))),
        #   "0.70" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.70"))),length(intersect(Poli,check_loss("Impute2",pop,"0.70"))),length(intersect(Poli,check_loss("Impute5",pop,"0.70"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.70")))),
        #   "0.80" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.80"))),length(intersect(Poli,check_loss("Impute2",pop,"0.80"))),length(intersect(Poli,check_loss("Impute5",pop,"0.80"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.80")))),
        #   "0.90" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.90"))),length(intersect(Poli,check_loss("Impute2",pop,"0.90"))),length(intersect(Poli,check_loss("Impute5",pop,"0.90"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.90")))),
        #   "0.95" = c(length(intersect(Poli,check_loss("Beagle",pop,"0.95"))),length(intersect(Poli,check_loss("Impute2",pop,"0.95"))),length(intersect(Poli,check_loss("Impute5",pop,"0.95"))),length(intersect(Poli,check_loss("Minimac4",pop,"0.95"))))
        #   )
        # plot_list[[i+1]] <- tableGrob(DF, rows = c(), cols = c("Method", "0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) 
        # i <- i + 2
            Beagle_inf <- plot_method_vs_indiv("Beagle", "BEAGLE_Phase", "EUR", plot = FALSE)[[2]]
   Beagle_info <- Beagle_inf 
    Beagle_info <- apply(Beagle_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Beagle_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Beagle_info) <- c("Filter","Imp")
        Beagle_plot <- geom_line(data = Beagle_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Beagle"), 
                         inherit.aes = FALSE)
        
        Impute2_inf <- plot_method_vs_indiv("Impute2", "BEAGLE_Phase", "EUR", plot = FALSE)[[2]]
    Impute2_info <- Impute2_inf 
    Impute2_info <- apply(Impute2_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute2_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute2_info) <- c("Filter", "Imp")
        Impute2_plot <- geom_line(data = Impute2_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Impute2"), 
                         inherit.aes = FALSE)
        
        Impute5_inf <- plot_method_vs_indiv("Impute5", "BEAGLE_Phase", "EUR", plot = FALSE)[[2]]
    Impute5_info <- Impute5_inf
    Impute5_info <- apply(Impute5_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute5_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute5_info) <- c("Filter", "Imp")
        Impute5_plot <- geom_line(data = Impute5_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Impute5"), 
                         inherit.aes = FALSE)
        
        Minimac4_inf <- plot_method_vs_indiv("Minimac4", "BEAGLE_Phase", "EUR", plot = FALSE)[[2]]
    Minimac4_info <- Minimac4_inf 
    Minimac4_info <- apply(Minimac4_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Minimac4_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Minimac4_info) <- c("Filter", "Imp")
        Minimac4_plot <- geom_line(data = Minimac4_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Minimac4"), 
                         inherit.aes = FALSE)
          
        pop_plot <- ggplot() + Beagle_plot + Impute2_plot + Impute5_plot + Minimac4_plot + 
               labs(x = "GP Filter", y = "Num of Inversions", 
                    title = "Imputable Inversions without Inversions Filtered",
                    subtitle = paste0("All Methods, ", "BEAGLE_Phase Phasing EUR Population")) +
              scale_x_continuous(breaks = c(0.00, 0.30, 0.50, 0.70, 0.80, 0.90, 0.95), labels = c("0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) +
              scale_color_manual(values = method_colors,
#                                 labels = c("Beagle", "Impute2", "Impute5", "Minimac4"),
                                 name = c()) +
            theme(plot.title = element_text(hjust = 0.5),
                  plot.subtitle = element_text(hjust = 0.3),
                  axis.title = element_text(size = 9),
                  legend.position = "bottom")
        plot_list[[3]] <- ggplotGrob(pop_plot)

        Poli <- EUR_Info[EUR_Info$V2 == "Polymorphic",]$V1
        Beagle_list <- InvNA(Beagle_inf)
        Impute2_list <- InvNA(Impute2_inf)
        Impute5_list <- InvNA(Impute5_inf)
        Minimac4_list <- InvNA(Minimac4_inf)
        
               DF <-  data.frame(
          Method = c("Beagle", "Impute2", "Impute5", "Minimac4"),
          "0.00" = c(Beagle_info$Imp[1],Impute2_info$Imp[1],Impute5_info$Imp[1],Minimac4_info$Imp[1]),
          "0.30" = c(Beagle_info$Imp[2],Impute2_info$Imp[2],Impute5_info$Imp[2],Minimac4_info$Imp[2]),
          "0.50" = c(Beagle_info$Imp[3],Impute2_info$Imp[3],Impute5_info$Imp[3],Minimac4_info$Imp[3]),
          "0.70" = c(Beagle_info$Imp[4],Impute2_info$Imp[4],Impute5_info$Imp[4],Minimac4_info$Imp[4]),
          "0.80" = c(Beagle_info$Imp[5],Impute2_info$Imp[5],Impute5_info$Imp[5],Minimac4_info$Imp[5]),
          "0.90" = c(Beagle_info$Imp[6],Impute2_info$Imp[6],Impute5_info$Imp[6],Minimac4_info$Imp[6]),
          "0.95" = c(Beagle_info$Imp[7],Impute2_info$Imp[7],Impute5_info$Imp[7],Minimac4_info$Imp[7]))
        plot_list[[4]] <- tableGrob(DF, rows = c(), cols = c("Method", "0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95"))         
        
        
            Beagle_inf <- plot_method_vs_indiv("Beagle", "BEAGLE_Phase", "EAS", plot = FALSE)[[2]]
    Beagle_info <- Beagle_inf 
    Beagle_info <- apply(Beagle_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Beagle_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Beagle_info) <- c("Filter","Imp")
        Beagle_plot <- geom_line(data = Beagle_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Beagle"), 
                         inherit.aes = FALSE)
        
        Impute2_inf <- plot_method_vs_indiv("Impute2", "BEAGLE_Phase", "EAS", plot = FALSE)[[2]]
    Impute2_info <- Impute2_inf 
    Impute2_info <- apply(Impute2_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute2_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute2_info) <- c("Filter", "Imp")
        Impute2_plot <- geom_line(data = Impute2_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Impute2"), 
                         inherit.aes = FALSE)
        
        Impute5_inf <- plot_method_vs_indiv("Impute5", "BEAGLE_Phase", "EAS", plot = FALSE)[[2]]
    Impute5_info <- Impute5_inf
    Impute5_info <- apply(Impute5_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Impute5_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Impute5_info) <- c("Filter","Imp")
        Impute5_plot <- geom_line(data = Impute5_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Impute5"), 
                         inherit.aes = FALSE)
        
        Minimac4_inf <- plot_method_vs_indiv("Minimac4", "BEAGLE_Phase", "EAS", plot = FALSE)[[2]]
    Minimac4_info <- Minimac4_inf 
    Minimac4_info <- apply(Minimac4_info[-1], 2, function(x) sum(x >= 0.8, na.rm = TRUE)) %>% as.data.frame() %>%
      rownames_to_column(var = "Filter")
    Minimac4_info$Filter <- c(0.00,0.30,0.50,0.70,0.80,0.90,0.95)
    colnames(Minimac4_info) <- c("Filter", "Imp")
        Minimac4_plot <- geom_line(data = Minimac4_info, 
                         aes(x = Filter, y = Imp, ymin = 0, ymax = 55,  color = "Minimac4"), 
                         inherit.aes = FALSE)
          
        pop_plot <- ggplot() + Beagle_plot + Impute2_plot + Impute5_plot + Minimac4_plot + 
               labs(x = "GP Filter", y = "Num of Inversions", 
                    title = "Imputable inversions without Inversions Filtered",
                    subtitle = paste0("All Methods, ", "BEAGLE_Phase Phasing EAS Population")) +
              scale_x_continuous(breaks = c(0.00, 0.30, 0.50, 0.70, 0.80, 0.90, 0.95), labels = c("0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) +
              scale_color_manual(values = method_colors,
#                                 labels = c("Beagle", "Impute2", "Impute5", "Minimac4"),
                                 name = c()) +
            theme(plot.title = element_text(hjust = 0.5),
                  plot.subtitle = element_text(hjust = 0.3),
                  axis.title = element_text(size = 9),
                  legend.position = "bottom")
        plot_list[[5]] <- ggplotGrob(pop_plot)
        
        Poli <- EAS_Info[EAS_Info$V2 == "Polymorphic",]$V1
        Beagle_list <- InvNA(Beagle_inf)
        Impute2_list <- InvNA(Impute2_inf)
        Impute5_list <- InvNA(Impute5_inf)
        Minimac4_list <- InvNA(Minimac4_inf)
        
               DF <-  data.frame(
          Method = c("Beagle", "Impute2", "Impute5", "Minimac4"),
          "0.00" = c(Beagle_info$Imp[1],Impute2_info$Imp[1],Impute5_info$Imp[1],Minimac4_info$Imp[1]),
          "0.30" = c(Beagle_info$Imp[2],Impute2_info$Imp[2],Impute5_info$Imp[2],Minimac4_info$Imp[2]),
          "0.50" = c(Beagle_info$Imp[3],Impute2_info$Imp[3],Impute5_info$Imp[3],Minimac4_info$Imp[3]),
          "0.70" = c(Beagle_info$Imp[4],Impute2_info$Imp[4],Impute5_info$Imp[4],Minimac4_info$Imp[4]),
          "0.80" = c(Beagle_info$Imp[5],Impute2_info$Imp[5],Impute5_info$Imp[5],Minimac4_info$Imp[5]),
          "0.90" = c(Beagle_info$Imp[6],Impute2_info$Imp[6],Impute5_info$Imp[6],Minimac4_info$Imp[6]),
          "0.95" = c(Beagle_info$Imp[7],Impute2_info$Imp[7],Impute5_info$Imp[7],Minimac4_info$Imp[7]))
        plot_list[[6]] <- tableGrob(DF, rows = c(), cols = c("Method", "0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")) 
```

```{r}
grid.arrange(plot_list[[1]], plot_list[[2]], ncol = 1, heights = c(2,1))
grid.arrange(plot_list[[3]], plot_list[[4]], ncol = 1, heights = c(2,1))
grid.arrange(plot_list[[5]], plot_list[[6]], ncol = 1, heights = c(2,1))
```


```{r}
ifelse(max(c(NA,2), na.rm = TRUE) == -Inf, NA, max(c(NA,2), na.rm = TRUE))
get_bestest("a")

df.indivs <- sel_df(Invs.Indiv.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EUR")
df.indivs[df.indivs$INV == "HsInv0072",]
Invds.Imp <- plot_method_vs_indiv("Beagle", "BEAGLE_Phase", "EUR", plot = FALSE)
Invds.Imp[[1]][Invds.Imp[[1]] == "HsInv0072",]
Invds.Imp[[2]][Invds.Imp[[2]] == "HsInv0072",]

get_bestest("EUR", 0.05)
check_imp("Beagle", "EUR", 0.05)
check_imp("Impute2", "EUR", 0.05)
check_imp("Impute5", "EUR", 0.05)
check_imp("Minimac4", "EUR", 0.05)

check_loss(imp.method = "Impute2", pop = "EUR", filter = "0.90")

df.indivs <- sel_df(Invs.Indiv.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "EUR")

print(length(valid_invs("EUR", MAC_thres = 10)))




tableEUR <- get_bestest("EUR",0)
colnames(tableEUR) <- c("Inversion", "Method/s", "Filter", "R2", "Frequency", "Remaining Individuals (#)", "Remaining Individuals (%)")
tableEUR$Quality <- ifelse(tableEUR$R2>=0.8,"Imputable",ifelse(tableEUR$R2 >=0.6,"Barely Imputable","Not Imputable"))
tableEUR %>% kbl() %>%
  kable_paper(full_width = F, html_font = "Cambria")

tableAFR <- get_bestest("AFR",0)
colnames(tableAFR) <- c("Inversion", "Method/s", "Filter", "R2", "Frequency", "Remaining Individuals (#)", "Remaining Individuals (%)")
tableAFR$Quality <- ifelse(tableAFR$R2>=0.8,"Imputable",ifelse(tableAFR$R2 >=0.6,"Barely Imputable","Not Imputable"))
tableAFR %>% kbl() %>%
  kable_paper(full_width = F, html_font = "Cambria")

tableEAS <- get_bestest("EAS",0)
colnames(tableEAS) <- c("Inversion", "Method/s", "Filter", "R2", "Frequency", "Remaining Individuals (#)", "Remaining Individuals (%)")
tableEAS$Quality <- ifelse(tableEAS$R2>=0.8,"Imputable",ifelse(tableEAS$R2 >=0.6,"Barely Imputable","Not Imputable"))
tableEAS %>% kbl() %>%
  kable_paper(full_width = F, html_font = "Cambria")


sum(tableEUR$Quality != "Not Imputable", na.rm = TRUE)
sum(tableAFR$Quality != "Not Imputable", na.rm = TRUE)
sum(tableEAS$Quality != "Not Imputable", na.rm = TRUE)

sum(tableEUR$Quality == "Imputable", na.rm = TRUE)
sum(tableAFR$Quality == "Imputable", na.rm = TRUE)
sum(tableEAS$Quality == "Imputable", na.rm = TRUE)


```


## Adjust a multiple linear regression model (try to predict imputability from our data)
```{r, message=FALSE, warning=FALSE, fig.width=15}
# Get the data from the 2 best Imputation Methods (Minimac4 and Impute2) and Standard (Beagle) Phasing,
# for the GP filter that works best (0.90) and first AFR population
M4.data.AFR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean.Minimac4.BEAGLE_Phase.0.80.AFR")
colnames(M4.data.AFR) <- c("INV", "R2")
I2.data.AFR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean.Impute2.BEAGLE_Phase.0.80.AFR")
colnames(I2.data.AFR) <- c("INV", "R2")


M4.data.EAS <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean.Minimac4.BEAGLE_Phase.0.80.EAS")
colnames(M4.data.EAS) <- c("INV", "R2")
I2.data.EAS <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean.Impute2.BEAGLE_Phase.0.80.EAS")
colnames(I2.data.EAS) <- c("INV", "R2")


M4.data.EUR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean.Minimac4.BEAGLE_Phase.0.80.EUR")
colnames(M4.data.EUR) <- c("INV", "R2")
I2.data.EUR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean.Impute2.BEAGLE_Phase.0.80.EUR")
colnames(I2.data.EUR) <- c("INV", "R2")


M4.data.AFR.0 <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean.Minimac4.BEAGLE_Phase.0.00.AFR")
colnames(M4.data.AFR.0) <- c("INV", "R2")
M4.data.EAS.0 <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean.Minimac4.BEAGLE_Phase.0.00.EAS")
colnames(M4.data.EAS.0) <- c("INV", "R2")
M4.data.EUR.0 <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean.Minimac4.BEAGLE_Phase.0.00.EUR")
colnames(M4.data.EUR.0) <- c("INV", "R2")


# Create a dataframe with the Inversion Data, the Imputability Data,
# the Inversion Frequency Data (from the studied individuals, not the general population)
# and the number of SNPs per inversion and population
M4.data.AFR <- cbind(Inv.Data[-c(14,15)], AFR_MAF[-1], AFR_SNPs[-1], M4.data.AFR[-1], AFR_Freq[-1], AFR_MAC[-1])
I2.data.AFR <- cbind(Inv.Data[-c(14,15)], AFR_MAF[-1], AFR_SNPs[-1], I2.data.AFR[-1], AFR_Freq[-1], AFR_MAC[-1])
M4.data.EAS <- cbind(Inv.Data[-c(13,15)], EAS_MAF[-1], EAS_SNPs[-1], M4.data.EAS[-1], EAS_Freq[-1], EUR_MAC[-1])
I2.data.EAS <- cbind(Inv.Data[-c(13,15)], EAS_MAF[-1], EAS_SNPs[-1], I2.data.EAS[-1], EAS_Freq[-1], EUR_MAC[-1])
M4.data.EUR <- cbind(Inv.Data[-c(13,14)], EUR_MAF[-1], EUR_SNPs[-1], M4.data.EUR[-1], EUR_Freq[-1], EAS_MAC[-1])
I2.data.EUR <- cbind(Inv.Data[-c(13,14)], EUR_MAF[-1], EUR_SNPs[-1], I2.data.EUR[-1], EUR_Freq[-1], EAS_MAC[-1])

M4.data.AFR.0 <- cbind(Inv.Data[-c(14,15)], AFR_MAF[-1], AFR_SNPs[-1], M4.data.AFR.0[-1], AFR_Freq[-1])
M4.data.EAS.0 <- cbind(Inv.Data[-c(13,15)], EAS_MAF[-1], EAS_SNPs[-1], M4.data.EAS.0[-1], EAS_Freq[-1])
M4.data.EUR.0 <- cbind(Inv.Data[-c(13,14)], EUR_MAF[-1], EUR_SNPs[-1], M4.data.EUR.0[-1], EUR_Freq[-1])


# We can see which groups of variables would seem to be correlated
ggpairs(M4.data.AFR[c(9:16)])
ggpairs(I2.data.AFR[c(9:16)])


# Select only on the inversions which have a NAHR origin
NAHR.Invs <- Inv.Data[Inv.Data$Origin == "NAHR",]$INV
M4.data.AFR <- M4.data.AFR[M4.data.AFR$INV %in% NAHR.Invs,]
I2.data.AFR <- I2.data.AFR[I2.data.AFR$INV %in% NAHR.Invs,]
M4.data.EAS <- M4.data.EAS[M4.data.EAS$INV %in% NAHR.Invs,]
I2.data.EAS <- I2.data.EAS[I2.data.EAS$INV %in% NAHR.Invs,]
M4.data.EUR <- M4.data.EUR[M4.data.EUR$INV %in% NAHR.Invs,]
I2.data.EUR <- I2.data.EUR[I2.data.EUR$INV %in% NAHR.Invs,]

#EUR_Valid <- valid_invs("EUR", freq_thres = 0.05)
#AFR_Valid <- valid_invs("AFR", freq_thres = 0.05)
#EAS_Valid <- valid_invs("EAS", freq_thres = 0.05)


#length(EUR_Valid)
#length(AFR_Valid)
#length(EAS_Valid)

I2Loss_AFR <- check_loss(imp.method = "Impute2", pop = "AFR", filter = "0.80")
I2Loss_EAS <- check_loss(imp.method = "Impute2", pop = "EAS", filter = "0.80")
I2Loss_EUR <- check_loss(imp.method = "Impute2", pop = "EUR", filter = "0.80")

M4Loss_AFR <- check_loss(imp.method = "Minimac4", pop = "AFR", filter = "0.80")
M4Loss_EAS <- check_loss(imp.method = "Minimac4", pop = "EAS", filter = "0.80")
M4Loss_EUR <- check_loss(imp.method = "Minimac4", pop = "EUR", filter = "0.80")



M4.data.AFR <- M4.data.AFR[M4.data.AFR$INV %in% AFR_Valid,]
I2.data.AFR <- I2.data.AFR[I2.data.AFR$INV %in% AFR_Valid,]

M4.data.EAS <- M4.data.EAS[M4.data.EAS$INV %in% EAS_Valid,]
I2.data.EAS <- I2.data.EAS[I2.data.EAS$INV %in% EAS_Valid,]

M4.data.EUR <- M4.data.EUR[M4.data.EUR$INV %in% EUR_Valid,]
I2.data.EUR <- I2.data.EUR[I2.data.EUR$INV %in% EUR_Valid,]

M4.data.AFR <- M4.data.AFR[M4.data.AFR$INV %in% M4Loss_AFR,]
I2.data.AFR <- I2.data.AFR[I2.data.AFR$INV %in% I2Loss_AFR,]

M4.data.EAS <- M4.data.EAS[M4.data.EAS$INV %in% M4Loss_EAS,]
I2.data.EAS <- I2.data.EAS[I2.data.EAS$INV %in% I2Loss_EAS,]

M4.data.EUR <- M4.data.EUR[M4.data.EUR$INV %in% M4Loss_EUR,]
I2.data.EUR <- I2.data.EUR[I2.data.EUR$INV %in% I2Loss_EUR,]



M4.data.AFR.0 <- M4.data.AFR.0[M4.data.AFR.0$INV %in% NAHR.Invs,]
M4.data.EAS.0 <- M4.data.EAS.0[M4.data.EAS.0$INV %in% NAHR.Invs,]
M4.data.EUR.0 <- M4.data.EUR.0[M4.data.EUR.0$INV %in% NAHR.Invs,]



ggpairs(M4.data.AFR[c(9:16)])
ggpairs(I2.data.AFR[c(9:16)])



# Perform the Multiple Linear Regression. Different imputation models yield different results.
# This can mean that their algorithms have different strengths and considerations
# when imputing an inversion
lmInv.M4.AFR <- lm(R2 ~ Rep.Length + Inv.Length + Interior.Length + Ratio + AFR.Num.Samples + MAF + SNPs + Freq + MAC, data = M4.data.AFR)
summary(lmInv.M4.AFR)
lmInv.I2.AFR <- lm(R2 ~ Rep.Length + Inv.Length + Interior.Length + Ratio + AFR.Num.Samples + MAF + SNPs + Freq + MAC, data = I2.data.AFR)
summary(lmInv.I2.AFR)
lmInv.M4.EAS <- lm(R2 ~ Rep.Length + Inv.Length + Interior.Length + Ratio + EAS.Num.Samples + MAF + SNPs + Freq + MAC, data = M4.data.EAS)
summary(lmInv.M4.EAS)
lmInv.I2.EAS <- lm(R2 ~ Rep.Length + Inv.Length + Interior.Length + Ratio + EAS.Num.Samples + MAF + SNPs + Freq + MAC, data = I2.data.EAS)
summary(lmInv.I2.EAS)
lmInv.M4.EUR <- lm(R2 ~ Rep.Length + Inv.Length + Interior.Length + Ratio + EUR.Num.Samples + MAF + SNPs + Freq + MAC, data = M4.data.EUR)
summary(lmInv.M4.EUR)
lmInv.I2.EUR <- lm(R2 ~ Rep.Length + Inv.Length + Interior.Length + Ratio + EUR.Num.Samples + MAF + SNPs + Freq + MAC, data = I2.data.EUR)
summary(lmInv.I2.EUR)

lmInv.M4.AFR.0 <- lm(R2 ~ Rep.Length + Inv.Length + Interior.Length + Ratio + AFR.Num.Samples + MAF + SNPs + Freq, data = M4.data.AFR.0)
summary(lmInv.M4.AFR.0)
lmInv.M4.EAS.0 <- lm(R2 ~ Rep.Length + Inv.Length + Interior.Length + Ratio + EAS.Num.Samples + MAF + SNPs + Freq, data = M4.data.EAS.0)
summary(lmInv.M4.EAS.0)
lmInv.M4.EUR.0 <- lm(R2 ~ Rep.Length + Inv.Length + Interior.Length + Ratio + EUR.Num.Samples + MAF + SNPs + Freq, data = M4.data.EUR.0)
summary(lmInv.M4.EUR.0)

```

### Analyse the MLR models
```{r}
# The first thing to see is the residuals, with a histogram
lmM4.Residuals <- lmInv.M4.AFR$residuals
lmI2.Residuals <- lmInv.I2.AFR$residuals
hist(lmM4.Residuals)
hist(lmI2.Residuals)

# The residuals should be normally distributed, this can be checked with a qqplot
# Some values are not on the line, so the values do not follow a normal distribution
qqnorm(lmM4.Residuals)
qqline(lmM4.Residuals)
qqnorm(lmI2.Residuals)
qqline(lmI2.Residuals)


# Another check is the multicollinearity assumption
Reduced.M4 <- M4.data.AFR[c(9:15)]
Reduced.I2 <- I2.data.AFR[c(9:15)]

# Plot a correlation matrix
CM.M4 = round(cor(Reduced.M4), 2)
CM.I2 = round(cor(Reduced.I2), 2)

ggcorrplot(CM.M4, hc.order = TRUE, type = "lower",
          lab = TRUE)
ggcorrplot(CM.I2, hc.order = TRUE, type = "lower",
          lab = TRUE)
```

### Improve the model
```{r}
Imp.lmInv.M4.AFR <- MASS::stepAIC(lmInv.M4.AFR, direction="both")
Imp.lmInv.I2.AFR <- MASS::stepAIC(lmInv.I2.AFR, direction="both")
Imp.lmInv.M4.EAS <- MASS::stepAIC(lmInv.M4.EAS, direction="both")
Imp.lmInv.I2.EAS <- MASS::stepAIC(lmInv.I2.EAS, direction="both")
Imp.lmInv.M4.EUR <- MASS::stepAIC(lmInv.M4.EUR, direction="both")
Imp.lmInv.I2.EUR <- MASS::stepAIC(lmInv.I2.EUR, direction="both")

Imp.lmInv.M4.AFR.0 <- MASS::stepAIC(lmInv.M4.AFR.0, direction="both")
Imp.lmInv.M4.EAS.0 <- MASS::stepAIC(lmInv.M4.EAS.0, direction="both")
Imp.lmInv.M4.EUR.0 <- MASS::stepAIC(lmInv.M4.EUR.0, direction="both")


summary(Imp.lmInv.M4.AFR)
summary(Imp.lmInv.I2.AFR)
summary(Imp.lmInv.M4.EAS)
summary(Imp.lmInv.I2.EAS)
summary(Imp.lmInv.M4.EUR)
summary(Imp.lmInv.I2.EUR)


summary(Imp.lmInv.M4.AFR.0)
summary(Imp.lmInv.M4.EAS.0)
summary(Imp.lmInv.M4.EUR.0)
```


```{r}
# Eliminate highly correlated variables, perform a second analysis
lmInv.M4.AFR.2 <- lm(R2 ~ Rep.Length + Interior.Length + Ratio + AFR.Num.Samples + Freq, data = M4.data.AFR)
lmInv.I2.AFR.2 <- lm(R2 ~ Rep.Length + Interior.Length + Ratio + AFR.Num.Samples + Freq, data = I2.data.AFR)
summary(lmInv.M4.AFR.2)
summary(lmInv.I2.AFR.2)

lmM4.Residuals.2 <- lmInv.M4.AFR.2$residuals
lmI2.Residuals.2 <- lmInv.I2.AFR.2$residuals
hist(lmM4.Residuals.2)
hist(lmI2.Residuals.2)

# Compare the residuals
qqnorm(lmM4.Residuals)
qqline(lmM4.Residuals)
qqnorm(lmM4.Residuals.2)
qqline(lmM4.Residuals.2)
qqnorm(lmI2.Residuals)
qqline(lmI2.Residuals)
qqnorm(lmI2.Residuals.2)
qqline(lmI2.Residuals.2)


# Another check is the multicollinearity assumption
Reduced.M4.2 <- M4.data.AFR[c(9,11:14)]
Reduced.I2.2 <- I2.data.AFR[c(9,11:14)]

# Plot a correlation matrix
CM.M4.2 = round(cor(Reduced.M4.2), 2)


ggcorrplot(CM.M4.2, hc.order = TRUE, type = "lower",
          lab = TRUE)
```



### Idea, fer un model per veure si influeix el tenir major filtre en la imputabilitat



## Perform the analysis
```{r, warning= FALSE}
# Plot different combinations to analyse them
## All methods on different populations and phasing methods
grid.arrange(grobs = plot_joint_condition("all",0), ncol = 1 )
grid.arrange(grobs = plot_joint_condition("all",0)[5])
aha <- plot_joint_condition("all",0)
grid.arrange(grobs = c(aha[1], aha[2]), ncol = 1, heights = c(2, 1))
grid.arrange(grobs = c(aha[3], aha[4]), ncol = 1, heights = c(2, 1))
grid.arrange(grobs = c(aha[5], aha[6]), ncol = 1, heights = c(2, 1))

## Each method to compare populations
grid.arrange(grobs = plot_joint_condition("population","Beagle"), ncol = 2 )
grid.arrange(grobs = plot_joint_condition("population","Impute2"), ncol = 2 )
grid.arrange(grobs = plot_joint_condition("population","Impute5"), ncol = 2 )
grid.arrange(grobs = plot_joint_condition("population","Minimac4"), ncol = 2 )

## Each method to compare for phasing methods
grid.arrange(grobs = plot_joint_condition("condition","Beagle"), ncol = 2 )
grid.arrange(grobs = plot_joint_condition("condition","Impute2"), ncol = 2 )
grid.arrange(grobs = plot_joint_condition("condition","Impute5"), ncol = 2 )
grid.arrange(grobs = plot_joint_condition("condition","Minimac4"), ncol = 2 )
```
From these, it can be inferred that the methods that work the best are Impute2 and Minimac4, with the former having a higher rise in imputability with an also high loss of individuals, whereas the latter has almost no difference in either loss of individuals or imputability with a stricter GP filter.
The population with best imputability is EUR, whereas the population with the worst is EAS, AFR can be found on a middle ground. 
The different phasing methods seem to work as good, maybe the Shapeit_Phase works better than the BEAGLE for Asian populations but this has to be tested
The filter that seems to be the best is either 0.90 or 0.95 for all methods and populations

```{r}
data <- data.frame(
  x = c(1, 2, 3, 4, 5),
  y = c(3, 7, 8, 5, 6)
)

# Create a plot
p <- ggplot(data, aes(x = x, y = y)) +
  geom_point() +
  ggtitle("Sample Plot")

# Create a table
table_data <- data.frame(
  A = c("Row1", "Row2", "Row3"),
  B = c(1, 2, 3),
  C = c(4, 5, 6)
)
table <- tableGrob()

# Arrange the plot and table
grid.arrange(p, table, ncol = 1, heights = c(2/3, 1/3))
```


### Assess the effects of using a GP filter
```{r}
## Get in with the numbers, check the imputability win, the individuals loss
## and the imputability cost
Beagle.diffs <- get_improvement("Beagle", "BEAGLE_Phase")
Impute2.diffs <- get_improvement("Impute2", "BEAGLE_Phase")
Impute5.diffs <- get_improvement("Impute5", "BEAGLE_Phase")
Minimac4.diffs <- get_improvement("Minimac4", "BEAGLE_Phase")

Imputability.Cost <- c(abs(Beagle.diffs[[2]]/Beagle.diffs[[1]]), 
                       abs(Impute2.diffs[[2]]/Impute2.diffs[[1]]),
                       abs(Impute5.diffs[[2]]/Impute5.diffs[[1]]),
                       abs(Minimac4.diffs[[2]]/Minimac4.diffs[[1]]))

Diffs <- data.frame("Imputation Methods" = c("Beagle", "Impute2", "Impute5", "Minimac4"), "Imputability Win" = c(Beagle.diffs[[1]], Impute2.diffs[[1]], Impute5.diffs[[1]], Minimac4.diffs[[1]]), "Individuals Loss" = c(Beagle.diffs[[2]], Impute2.diffs[[2]], Impute5.diffs[[2]], Minimac4.diffs[[2]]), "Imputability Cost" = Imputability.Cost)
Diffs
```
```{r}
## Individual loss, imputation gain and imputability cost per step for every
## imputation method

I2.Steps <- get_improvement_steps("Impute2", "BEAGLE_Phase")
I2.Steps[grepl("AFR",I2.Steps$Condition),]
colMeans(I2.Steps[grepl("AFR.Cost",I2.Steps$Condition),][-1])

I5.Steps <- get_improvement_steps("Impute5", "BEAGLE_Phase")
I5.Steps[grepl("AFR",I5.Steps$Condition),]
colMeans(I5.Steps[grepl("AFR.Cost",I5.Steps$Condition),][-1])

Minimac4.Steps <- get_improvement_steps("Minimac4", "BEAGLE_Phase")
Minimac4.Steps[grepl("AFR",Minimac4.Steps$Condition),]
colMeans(Minimac4.Steps[grepl("AFR.Cost",Minimac4.Steps$Condition),][-1])

Beagle.Steps <- get_improvement_steps("Beagle", "BEAGLE_Phase")
Beagle.Steps[grepl("AFR",Beagle.Steps$Condition),]
colMeans(Beagle.Steps[grepl("AFR.Cost",Beagle.Steps$Condition),][-1])
```



### See if there is any difference between the 2 phasing methods
```{r}
Best.BEAGLE_Phase <- sel_df(Imputation.Info, condition = "BEAGLE_Phase", filter = "Mean")
Best.BEAGLE_Phase <- melt(Best.BEAGLE_Phase, id.vars = "INV")
Best.BEAGLE_Phase$variable <- rep("BEAGLE_Phase",nrow(Best.BEAGLE_Phase))
Best.Shapeit_Phase <- sel_df(Imputation.Info, condition = "Shapeit_Phase", filter = "Mean")
Best.Shapeit_Phase <- melt(Best.Shapeit_Phase, id.vars = "INV")
Best.Shapeit_Phase$variable <- rep("Shapeit_Phase",nrow(Best.Shapeit_Phase))

Best.BEAGLE_Phase.AFR <- sel_df(Imputation.Info, condition = "BEAGLE_Phase", filter = "Mean", pop = "AFR")
Best.BEAGLE_Phase.AFR <- melt(Best.BEAGLE_Phase.AFR, id.vars = "INV")
Best.BEAGLE_Phase.AFR$variable <- rep("BEAGLE_Phase",nrow(Best.BEAGLE_Phase.AFR))
Best.Shapeit_Phase.AFR <- sel_df(Imputation.Info, condition = "Shapeit_Phase", filter = "Mean", pop = "AFR")
Best.Shapeit_Phase.AFR <- melt(Best.Shapeit_Phase.AFR, id.vars = "INV")
Best.Shapeit_Phase.AFR$variable <- rep("Shapeit_Phase",nrow(Best.Shapeit_Phase.AFR))

Best.BEAGLE_Phase.EUR <- sel_df(Imputation.Info, condition = "BEAGLE_Phase", filter = "Mean", pop = "EUR")
Best.BEAGLE_Phase.EUR <- melt(Best.BEAGLE_Phase.EUR, id.vars = "INV")
Best.BEAGLE_Phase.EUR$variable <- rep("BEAGLE_Phase",nrow(Best.BEAGLE_Phase.EUR))
Best.Shapeit_Phase.EUR <- sel_df(Imputation.Info, condition = "Shapeit_Phase", filter = "Mean", pop = "EUR")
Best.Shapeit_Phase.EUR <- melt(Best.Shapeit_Phase.EUR, id.vars = "INV")
Best.Shapeit_Phase.EUR$variable <- rep("Shapeit_Phase",nrow(Best.Shapeit_Phase.EUR))

Best.BEAGLE_Phase.EAS <- sel_df(Imputation.Info, condition = "BEAGLE_Phase", filter = "Mean", pop = "EAS")
Best.BEAGLE_Phase.EAS <- melt(Best.BEAGLE_Phase.EAS, id.vars = "INV")
Best.BEAGLE_Phase.EAS$variable <- rep("BEAGLE_Phase",nrow(Best.BEAGLE_Phase.EAS))
Best.Shapeit_Phase.EAS <- sel_df(Imputation.Info, condition = "Shapeit_Phase", filter = "Mean", pop = "EAS")
Best.Shapeit_Phase.EAS <- melt(Best.Shapeit_Phase.EAS, id.vars = "INV")
Best.Shapeit_Phase.EAS$variable <- rep("Shapeit_Phase",nrow(Best.Shapeit_Phase.EAS))



wilcox.test(Best.BEAGLE_Phase$value, Best.Shapeit_Phase$value, paired = FALSE)
dunn.test(list(Best.BEAGLE_Phase[complete.cases(Best.BEAGLE_Phase),]$value, Best.Shapeit_Phase[complete.cases(Best.Shapeit_Phase),]$value))

wilcox.test(Best.BEAGLE_Phase.AFR$value, Best.Shapeit_Phase.AFR$value, paired = FALSE)
wilcox.test(Best.BEAGLE_Phase.EUR$value, Best.Shapeit_Phase.EUR$value, paired = FALSE)
wilcox.test(Best.BEAGLE_Phase.EAS$value, Best.Shapeit_Phase.EAS$value, paired = FALSE)

Best <- rbind(Best.BEAGLE_Phase, Best.Shapeit_Phase)
Best.AFR <- rbind(Best.BEAGLE_Phase.AFR, Best.Shapeit_Phase.AFR)
Best.EUR <- rbind(Best.BEAGLE_Phase.EUR, Best.Shapeit_Phase.EUR)
Best.EAS <- rbind(Best.BEAGLE_Phase.EAS, Best.Shapeit_Phase.EAS)

aov(value ~ variable, Best.AFR)
aov(value ~ variable, Best.EUR)
aov(value ~ variable, Best.EAS)

aov(value ~ variable, Best)


?wilcox.test
ggbetweenstats(data = Best,  x = variable, y = value, pairwise.display = "ns", type = "np", results.subtitle = TRUE)
ggbetweenstats(data = Best.AFR,  x = variable, y = value, pairwise.display = "ns", type = "np", results.subtitle = TRUE)
ggbetweenstats(data = Best.EUR,  x = variable, y = value, pairwise.display = "ns", type = "np", results.subtitle = TRUE)
ggbetweenstats(data = Best.EAS,  x = variable, y = value, pairwise.display = "ns", type = "np", results.subtitle = TRUE)

```


### Check the best performing imputation methods

```{r}
## In general filter (using BEAGLE_Phase, the filter being 0.90)
Best.B <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", filter = "Mean.Beagle.BEAGLE_Phase.0.90")
Best.B <- melt(Best.B, id.vars = "INV")
Best.B$variable <- rep("Beagle", 55*3)
Best.I2 <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", filter = "Mean.Impute2.BEAGLE_Phase.0.90")
Best.I2 <- melt(Best.I2, id.vars = "INV")
Best.I2$variable <- rep("Impute2", 55*3)
Best.I5 <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", filter = "Mean.Impute5.BEAGLE_Phase.0.90")
Best.I5 <- melt(Best.I5, id.vars = "INV")
Best.I5$variable <- rep("Impute5", 55*3)
Best.M4 <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", filter = "Mean.Minimac4.BEAGLE_Phase.0.90")
Best.M4 <- melt(Best.M4, id.vars = "INV")
Best.M4$variable <- rep("Minimac4", 55*3)

## Best AFR Imputation Method
Best.B.AFR <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean")
Best.B.AFR <- melt(Best.B.AFR, id.vars = "INV")
Best.B.AFR$variable <- rep("Beagle", 55*7)
Best.I2.AFR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean")
Best.I2.AFR <- melt(Best.I2.AFR, id.vars = "INV")
Best.I2.AFR$variable <- rep("Impute2", 55*7)
Best.I5.AFR <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean")
Best.I5.AFR <- melt(Best.I5.AFR, id.vars = "INV")
Best.I5.AFR$variable <- rep("Impute5", 55*7)
Best.M4.AFR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean")
Best.M4.AFR <- melt(Best.M4.AFR, id.vars = "INV")
Best.M4.AFR$variable <- rep("Minimac4", 55*7)

Best.Imp.AFR <- cbind(Best.B.AFR[c(1,3)],Best.I2.AFR[3],Best.I5.AFR[3],Best.M4.AFR[3])
colnames(Best.Imp.AFR) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp.AFR <- melt(Best.Imp.AFR, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(data = Best.Imp.AFR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison between the different imputing methods for AFR populations") + theme(plot.title = element_text(hjust = 0.5))

## Best EUR Imputation Method
Best.B.EUR <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean")
Best.B.EUR <- melt(Best.B.EUR, id.vars = "INV")
Best.B.EUR$variable <- rep("Beagle", 55*7)
Best.I2.EUR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean")
Best.I2.EUR <- melt(Best.I2.EUR, id.vars = "INV")
Best.I2.EUR$variable <- rep("Impute2", 55*7)
Best.I5.EUR <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean")
Best.I5.EUR <- melt(Best.I5.EUR, id.vars = "INV")
Best.I5.EUR$variable <- rep("Impute5", 55*7)
Best.M4.EUR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean")
Best.M4.EUR <- melt(Best.M4.EUR, id.vars = "INV")
Best.M4.EUR$variable <- rep("Minimac4", 55*7)

Best.Imp.EUR <- cbind(Best.B.EUR[c(1,3)],Best.I2.EUR[3],Best.I5.EUR[3],Best.M4.EUR[3])
colnames(Best.Imp.EUR) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp.EUR <- melt(Best.Imp.EUR, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(data = Best.Imp.EUR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison between the different imputing methods for EUR populations") + theme(plot.title = element_text(hjust = 0.5))


## Best EAS Imputation Method
Best.B.EAS <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean")
Best.B.EAS <- melt(Best.B.EAS, id.vars = "INV")
Best.B.EAS$variable <- rep("Beagle", 55*7)
Best.I2.EAS <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean")
Best.I2.EAS <- melt(Best.I2.EAS, id.vars = "INV")
Best.I2.EAS$variable <- rep("Impute2", 55*7)
Best.I5.EAS <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean")
Best.I5.EAS <- melt(Best.I5.EAS, id.vars = "INV")
Best.I5.EAS$variable <- rep("Impute5", 55*7)
Best.M4.EAS <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean")
Best.M4.EAS <- melt(Best.M4.EAS, id.vars = "INV")
Best.M4.EAS$variable <- rep("Minimac4", 55*7)

Best.Imp.EAS <- cbind(Best.B.EAS[c(1,3)],Best.I2.EAS[3],Best.I5.EAS[3],Best.M4.EAS[3])
colnames(Best.Imp.EAS) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp.EAS <- melt(Best.Imp.EAS, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(data = Best.Imp.EAS,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison between the different imputing methods for EAS populations") + theme(plot.title = element_text(hjust = 0.5))

Best.Imp <- cbind(Best.B[c(1,3)],Best.I2[3],Best.I5[3],Best.M4[3])
colnames(Best.Imp) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp <- melt(Best.Imp, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(data = Best.Imp,  x = Imp.Method, y = R2, pairwise.display = "significant", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison between the different imputing methods") + theme(plot.title = element_text(hjust = 0.5))
```
All methods perform statistically better than Beagle, with the other 3 not being any significantly better than the other.


### Check best method per filter
#### No filter
```{r}
# AFR
Best.B.AFR <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.00")
Best.I2.AFR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.00")
Best.I5.AFR <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.00")
Best.M4.AFR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.00")
Best.sIC.AFR <- sel_df(Imputation.Info, imp_method = "ScoreInvHap", pop = "AFR", filter = "Mean")

Best.Imp.AFR <- cbind(Best.B.AFR, Best.I2.AFR[2], Best.I5.AFR[2], Best.M4.AFR[2], Best.sIC.AFR[2])
colnames(Best.Imp.AFR) <- c("INV","Beagle","Impute2","Impute5","Minimac4", "ScoreInvHap")
Best.Imp.AFR <- melt(Best.Imp.AFR, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(digits = 4L, data = Best.Imp.AFR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in AFR population and no filter", y = expression("Imputability ("~r^2~")")) + theme(plot.title = element_text(hjust = 0.5))
ggbetweenstats(digits = 4L, data = Best.Imp.AFR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "p", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in AFR population and no filter") + theme(plot.title = element_text(hjust = 0.5))

# EUR
Best.B.EUR <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.00")
Best.I2.EUR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.00")
Best.I5.EUR <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.00")
Best.M4.EUR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.00")
Best.sIC.EUR <- sel_df(Imputation.Info, imp_method = "ScoreInvHap", pop = "EUR", filter = "Mean")

Best.Imp.EUR <- cbind(Best.B.EUR,Best.I2.EUR[2],Best.I5.EUR[2],Best.M4.EUR[2],Best.sIC.EUR[2])
colnames(Best.Imp.EUR) <- c("INV","Beagle","Impute2","Impute5","Minimac4","ScoreInvHap")
Best.Imp.EUR <- melt(Best.Imp.EUR, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(digits = 4L, data = Best.Imp.EUR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in EUR population and no filter", y = expression("Imputability ("~r^2~")")) + theme(plot.title = element_text(hjust = 0.5))
ggbetweenstats(digits = 4L, data = Best.Imp.EUR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "p", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in EUR population and no filter") + theme(plot.title = element_text(hjust = 0.5))

# EAS
Best.B.EAS <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.00")
Best.I2.EAS <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.00")
Best.I5.EAS <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.00")
Best.M4.EAS <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.00")
Best.sIC.EAS <- sel_df(Imputation.Info, imp_method = "ScoreInvHap", pop = "EAS", filter = "Mean")

Best.Imp.EAS <- cbind(Best.B.EAS,Best.I2.EAS[2],Best.I5.EAS[2],Best.M4.EAS[2],Best.sIC.EAS[2])
colnames(Best.Imp.EAS) <- c("INV","Beagle","Impute2","Impute5","Minimac4","ScoreInvHap")
Best.Imp.EAS <- melt(Best.Imp.EAS, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(digits = 4L, data = Best.Imp.EAS,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in EAS population and no filter", y = expression("Imputability ("~r^2~")")) + theme(plot.title = element_text(hjust = 0.5))
ggbetweenstats(digits = 4L, data = Best.Imp.EAS,  x = Imp.Method, y = R2, pairwise.display = "s", type = "p", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in EAS population and no filter") + theme(plot.title = element_text(hjust = 0.5))

## General
Best.B <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", filter = "Mean", imputability = "0.00")
Best.B <- melt(Best.B, id.vars = "INV")
Best.B$variable <- rep("Beagle", 55*3)
Best.I2 <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", filter = "Mean", imputability = "0.00")
Best.I2 <- melt(Best.I2, id.vars = "INV")
Best.I2$variable <- rep("Impute2", 55*3)
Best.I5 <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", filter = "Mean", imputability = "0.00")
Best.I5 <- melt(Best.I5, id.vars = "INV")
Best.I5$variable <- rep("Impute5", 55*3)
Best.M4 <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", filter = "Mean", imputability = "0.00")
Best.M4 <- melt(Best.M4, id.vars = "INV")
Best.M4$variable <- rep("Minimac4", 55*3)

Best.Imp <- cbind(Best.B[c(1,3)],Best.I2[3],Best.I5[3],Best.M4[3])
colnames(Best.Imp) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp <- melt(Best.Imp, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(digits = 4L, data = Best.Imp,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in the general population and no filter") + theme(plot.title = element_text(hjust = 0.5))
ggbetweenstats(digits = 4L, data = Best.Imp,  x = Imp.Method, y = R2, pairwise.display = "s", type = "p", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in the general population and no filter") + theme(plot.title = element_text(hjust = 0.5))
```
#### 0.80 Filter

```{r}
Best.B.AFR <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.80")
B.Loss <- check_loss("Beagle","AFR","0.80")
Best.I2.AFR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.80")
I2.Loss <- check_loss("Impute2","AFR","0.80")
Best.I5.AFR <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.80")
I5.Loss <- check_loss("Impute5","AFR","0.80")
Best.M4.AFR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.80")

Best.Imp.AFR <- cbind(Best.B.AFR,Best.I2.AFR[2],Best.I5.AFR[2],Best.M4.AFR[2])
colnames(Best.Imp.AFR) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp.AFR <- melt(Best.Imp.AFR, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(digits = 4L, data = Best.Imp.AFR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in AFR population and 0.80 filter") + theme(plot.title = element_text(hjust = 0.5))
ggbetweenstats(digits = 4L, data = Best.Imp.AFR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "p", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in AFR population and 0.90 filter") + theme(plot.title = element_text(hjust = 0.5))

Best.B.EUR <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.80")
B.Loss <- check_loss("Beagle","EUR","0.80")
Best.I2.EUR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.80")
I2.Loss <- check_loss("Impute2","EUR","0.80")
Best.I5.EUR <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.80")
I5.Loss <- check_loss("Impute5","EUR","0.80")
Best.M4.EUR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.80")

Best.Imp.EUR <- cbind(Best.B.EUR,Best.I2.EUR[2],Best.I5.EUR[2],Best.M4.EUR[2])
colnames(Best.Imp.EUR) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp.EUR <- melt(Best.Imp.EUR, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(digits = 4L, data = Best.Imp.EUR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in EUR population and 0.80 filter") + theme(plot.title = element_text(hjust = 0.5))
ggbetweenstats(digits = 4L, data = Best.Imp.EUR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "p", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in EUR population and 0.90 filter") + theme(plot.title = element_text(hjust = 0.5))

Best.B.EAS <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.80")
B.Loss <- check_loss("Beagle","EAS","0.80")
Best.I2.EAS <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.80")
I2.Loss <- check_loss("Impute2","EAS","0.80")
Best.I5.EAS <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.80")
I5.Loss <- check_loss("Impute5","EAS","0.80")
Best.M4.EAS <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.80")

Best.Imp.EAS <- cbind(Best.B.EAS,Best.I2.EAS[2],Best.I5.EAS[2],Best.M4.EAS[2])
colnames(Best.Imp.EAS) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp.EAS <- melt(Best.Imp.EAS, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(digits = 4L, data = Best.Imp.EAS,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in EAS population and 0.80 filter") + theme(plot.title = element_text(hjust = 0.5))
ggbetweenstats(digits = 4L, data = Best.Imp.EAS,  x = Imp.Method, y = R2, pairwise.display = "s", type = "p", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in EAS population and 0.90 filter") + theme(plot.title = element_text(hjust = 0.5))

Best.B <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", filter = "Mean", imputability = "0.80")
Best.B <- melt(Best.B, id.vars = "INV")
Best.B$variable <- rep("Beagle", 55*3)
Best.I2 <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", filter = "Mean", imputability = "0.80")
Best.I2 <- melt(Best.I2, id.vars = "INV")
Best.I2$variable <- rep("Impute2", 55*3)
Best.I5 <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", filter = "Mean", imputability = "0.80")
Best.I5 <- melt(Best.I5, id.vars = "INV")
Best.I5$variable <- rep("Impute5", 55*3)
Best.M4 <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", filter = "Mean", imputability = "0.80")
Best.M4 <- melt(Best.M4, id.vars = "INV")
Best.M4$variable <- rep("Minimac4", 55*3)

Best.Imp <- cbind(Best.B[c(1,3)],Best.I2[3],Best.I5[3],Best.M4[3])
colnames(Best.Imp) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp <- melt(Best.Imp, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(digits = 4L, data = Best.Imp,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in the general population and 0.80 filter") + theme(plot.title = element_text(hjust = 0.5))
ggbetweenstats(digits = 4L, data = Best.Imp,  x = Imp.Method, y = R2, pairwise.display = "s", type = "p", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in the general population and 0.80 filter") + theme(plot.title = element_text(hjust = 0.5))
```




#### 0.90 Filter
```{r}
# AFR
Best.B.AFR <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.90")
Best.I2.AFR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.90")
Best.I5.AFR <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.90")
Best.M4.AFR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.90")

Best.Imp.AFR <- cbind(Best.B.AFR,Best.I2.AFR[2],Best.I5.AFR[2],Best.M4.AFR[2])
colnames(Best.Imp.AFR) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp.AFR <- melt(Best.Imp.AFR, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(digits = 4L, data = Best.Imp.AFR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in AFR population and 0.90 filter") + theme(plot.title = element_text(hjust = 0.5))
ggbetweenstats(digits = 4L, data = Best.Imp.AFR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "p", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in AFR population and 0.90 filter") + theme(plot.title = element_text(hjust = 0.5))

# EUR
Best.B.EUR <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.90")
Best.I2.EUR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.90")
Best.I5.EUR <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.90")
Best.M4.EUR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.90")

Best.Imp.EUR <- cbind(Best.B.EUR,Best.I2.EUR[2],Best.I5.EUR[2],Best.M4.EUR[2])
colnames(Best.Imp.EUR) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp.EUR <- melt(Best.Imp.EUR, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(digits = 4L, data = Best.Imp.EUR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in EUR population and 0.90 filter") + theme(plot.title = element_text(hjust = 0.5))
ggbetweenstats(digits = 4L, data = Best.Imp.EUR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "p", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in EUR population and 0.90 filter") + theme(plot.title = element_text(hjust = 0.5))

# EAS
Best.B.EAS <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.90")
Best.I2.EAS <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.90")
Best.I5.EAS <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.90")
Best.M4.EAS <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.90")

Best.Imp.EAS <- cbind(Best.B.EAS,Best.I2.EAS[2],Best.I5.EAS[2],Best.M4.EAS[2])
colnames(Best.Imp.EAS) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp.EAS <- melt(Best.Imp.EAS, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(digits = 4L, data = Best.Imp.EAS,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in EAS population and 0.90 filter") + theme(plot.title = element_text(hjust = 0.5))
ggbetweenstats(digits = 4L, data = Best.Imp.EAS,  x = Imp.Method, y = R2, pairwise.display = "s", type = "p", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in EAS population and 0.90 filter") + theme(plot.title = element_text(hjust = 0.5))

## General
Best.B <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", filter = "Mean", imputability = "0.90")
Best.B <- melt(Best.B, id.vars = "INV")
Best.B$variable <- rep("Beagle", 55*3)
Best.I2 <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", filter = "Mean", imputability = "0.90")
Best.I2 <- melt(Best.I2, id.vars = "INV")
Best.I2$variable <- rep("Impute2", 55*3)
Best.I5 <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", filter = "Mean", imputability = "0.90")
Best.I5 <- melt(Best.I5, id.vars = "INV")
Best.I5$variable <- rep("Impute5", 55*3)
Best.M4 <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", filter = "Mean", imputability = "0.90")
Best.M4 <- melt(Best.M4, id.vars = "INV")
Best.M4$variable <- rep("Minimac4", 55*3)

Best.Imp <- cbind(Best.B[c(1,3)],Best.I2[3],Best.I5[3],Best.M4[3])
colnames(Best.Imp) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp <- melt(Best.Imp, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(digits = 4L, data = Best.Imp,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in the general population and 0.90 filter") + theme(plot.title = element_text(hjust = 0.5))
ggbetweenstats(digits = 4L, data = Best.Imp,  x = Imp.Method, y = R2, pairwise.display = "s", type = "p", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in the general population and 0.90 filter") + theme(plot.title = element_text(hjust = 0.5))
```

#### 0.95 Filter

```{r}
# AFR
Best.B.AFR <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.95")
Best.I2.AFR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.95")
Best.I5.AFR <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.95")
Best.M4.AFR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.95")

Best.Imp.AFR <- cbind(Best.B.AFR,Best.I2.AFR[2],Best.I5.AFR[2],Best.M4.AFR[2])
colnames(Best.Imp.AFR) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp.AFR <- melt(Best.Imp.AFR, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(digits = 4L, data = Best.Imp.AFR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in AFR population and 0.95 filter") + theme(plot.title = element_text(hjust = 0.5))
ggbetweenstats(digits = 4L, data = Best.Imp.AFR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "p", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in AFR population and 0.95 filter") + theme(plot.title = element_text(hjust = 0.5))

# EUR
Best.B.EUR <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.95")
Best.I2.EUR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.95")
Best.I5.EUR <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.95")
Best.M4.EUR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.95")

Best.Imp.EUR <- cbind(Best.B.EUR,Best.I2.EUR[2],Best.I5.EUR[2],Best.M4.EUR[2])
colnames(Best.Imp.EUR) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp.EUR <- melt(Best.Imp.EUR, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(digits = 4L, data = Best.Imp.EUR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in EUR population and 0.95 filter") + theme(plot.title = element_text(hjust = 0.5))
ggbetweenstats(digits = 4L, data = Best.Imp.EUR,  x = Imp.Method, y = R2, pairwise.display = "s", type = "p", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in EUR population and 0.95 filter") + theme(plot.title = element_text(hjust = 0.5))

# EAS
Best.B.EAS <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.95")
Best.I2.EAS <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.95")
Best.I5.EAS <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.95")
Best.M4.EAS <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.95")

Best.Imp.EAS <- cbind(Best.B.EAS,Best.I2.EAS[2],Best.I5.EAS[2],Best.M4.EAS[2])
colnames(Best.Imp.EAS) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp.EAS <- melt(Best.Imp.EAS, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(digits = 4L, data = Best.Imp.EAS,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in EAS population and 0.95 filter") + theme(plot.title = element_text(hjust = 0.5))
ggbetweenstats(digits = 4L, data = Best.Imp.EAS,  x = Imp.Method, y = R2, pairwise.display = "s", type = "p", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in EAS population and 0.95 filter") + theme(plot.title = element_text(hjust = 0.5))

## General
Best.B <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", filter = "Mean", imputability = "0.95")
Best.B <- melt(Best.B, id.vars = "INV")
Best.B$variable <- rep("Beagle", 55*3)
Best.I2 <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", filter = "Mean", imputability = "0.95")
Best.I2 <- melt(Best.I2, id.vars = "INV")
Best.I2$variable <- rep("Impute2", 55*3)
Best.I5 <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", filter = "Mean", imputability = "0.95")
Best.I5 <- melt(Best.I5, id.vars = "INV")
Best.I5$variable <- rep("Impute5", 55*3)
Best.M4 <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", filter = "Mean", imputability = "0.95")
Best.M4 <- melt(Best.M4, id.vars = "INV")
Best.M4$variable <- rep("Minimac4", 55*3)

Best.Imp <- cbind(Best.B[c(1,3)],Best.I2[3],Best.I5[3],Best.M4[3])
colnames(Best.Imp) <- c("INV","Beagle","Impute2","Impute5","Minimac4")
Best.Imp <- melt(Best.Imp, id.vars = "INV", variable.name = "Imp.Method", value.name = "R2")
ggbetweenstats(digits = 4L, data = Best.Imp,  x = Imp.Method, y = R2, pairwise.display = "s", type = "np", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in the general population and no filter") + theme(plot.title = element_text(hjust = 0.5))
ggbetweenstats(digits = 4L, data = Best.Imp,  x = Imp.Method, y = R2, pairwise.display = "s", type = "p", results.subtitle = FALSE) + labs(x = "Imputation Method", title = "Pairwise comparison for imputing methods in the general population and no filter") + theme(plot.title = element_text(hjust = 0.5))
```


###  This can also be seen with the Wilcoxon Test and tested with ANOVA
```{r}
## For the chosen GP filter
Best.Imp <- Best.Imp[!is.na(Best.Imp$R2),]
wilcox.test(Best.Imp[Best.Imp$Imp.Method == "Beagle",]$R2,Best.Imp[Best.Imp$Imp.Method == "Impute5",]$R2)
wilcox.test(Best.Imp[Best.Imp$Imp.Method == "Beagle",]$R2,Best.Imp[Best.Imp$Imp.Method == "Minimac4",]$R2)
wilcox.test(Best.Imp[Best.Imp$Imp.Method == "Beagle",]$R2,Best.Imp[Best.Imp$Imp.Method == "Impute2",]$R2)
wilcox.test(Best.Imp[Best.Imp$Imp.Method == "Impute2",]$R2,Best.Imp[Best.Imp$Imp.Method == "Impute5",]$R2)
wilcox.test(Best.Imp[Best.Imp$Imp.Method == "Minimac4",]$R2,Best.Imp[Best.Imp$Imp.Method == "Impute5",]$R2)
wilcox.test(Best.Imp[Best.Imp$Imp.Method == "Impute2",]$R2,Best.Imp[Best.Imp$Imp.Method == "Minimac4",]$R2)

## For AFR
Best.Imp.AFR <- Best.Imp.AFR[!is.na(Best.Imp$R2),]
wilcox.test(Best.Imp.AFR[Best.Imp.AFR$Imp.Method == "Beagle",]$R2,Best.Imp.AFR[Best.Imp.AFR$Imp.Method == "Impute5",]$R2)
wilcox.test(Best.Imp.AFR[Best.Imp.AFR$Imp.Method == "Beagle",]$R2,Best.Imp.AFR[Best.Imp.AFR$Imp.Method == "Minimac4",]$R2)
wilcox.test(Best.Imp.AFR[Best.Imp.AFR$Imp.Method == "Beagle",]$R2,Best.Imp.AFR[Best.Imp.AFR$Imp.Method == "Impute2",]$R2)
wilcox.test(Best.Imp.AFR[Best.Imp.AFR$Imp.Method == "Impute2",]$R2,Best.Imp.AFR[Best.Imp.AFR$Imp.Method == "Impute5",]$R2)
wilcox.test(Best.Imp.AFR[Best.Imp.AFR$Imp.Method == "Minimac4",]$R2,Best.Imp.AFR[Best.Imp.AFR$Imp.Method == "Impute5",]$R2)
wilcox.test(Best.Imp.AFR[Best.Imp.AFR$Imp.Method == "Impute2",]$R2,Best.Imp.AFR[Best.Imp.AFR$Imp.Method == "Minimac4",]$R2)
summary(aov(R2 ~ Imp.Method, Best.Imp.AFR))


## For EUR
Best.Imp.EUR <- Best.Imp.EUR[!is.na(Best.Imp$R2),]
wilcox.test(Best.Imp.EUR[Best.Imp.EUR$Imp.Method == "Beagle",]$R2,Best.Imp.EUR[Best.Imp.EUR$Imp.Method == "Impute5",]$R2)
wilcox.test(Best.Imp.EUR[Best.Imp.EUR$Imp.Method == "Beagle",]$R2,Best.Imp.EUR[Best.Imp.EUR$Imp.Method == "Minimac4",]$R2)
wilcox.test(Best.Imp.EUR[Best.Imp.EUR$Imp.Method == "Beagle",]$R2,Best.Imp.EUR[Best.Imp.EUR$Imp.Method == "Impute2",]$R2)
wilcox.test(Best.Imp.EUR[Best.Imp.EUR$Imp.Method == "Impute2",]$R2,Best.Imp.EUR[Best.Imp.EUR$Imp.Method == "Impute5",]$R2)
wilcox.test(Best.Imp.EUR[Best.Imp.EUR$Imp.Method == "Minimac4",]$R2,Best.Imp.EUR[Best.Imp.EUR$Imp.Method == "Impute5",]$R2)
wilcox.test(Best.Imp.EUR[Best.Imp.EUR$Imp.Method == "Impute2",]$R2,Best.Imp.EUR[Best.Imp.EUR$Imp.Method == "Minimac4",]$R2)
summary(aov(R2 ~ Imp.Method, Best.Imp.EUR))


## For EAS
Best.Imp.EAS <- Best.Imp.EAS[!is.na(Best.Imp$R2),]
wilcox.test(Best.Imp.EAS[Best.Imp.EAS$Imp.Method == "Beagle",]$R2,Best.Imp.EAS[Best.Imp.EAS$Imp.Method == "Impute5",]$R2)
wilcox.test(Best.Imp.EAS[Best.Imp.EAS$Imp.Method == "Beagle",]$R2,Best.Imp.EAS[Best.Imp.EAS$Imp.Method == "Minimac4",]$R2)
wilcox.test(Best.Imp.EAS[Best.Imp.EAS$Imp.Method == "Beagle",]$R2,Best.Imp.EAS[Best.Imp.EAS$Imp.Method == "Impute2",]$R2)
wilcox.test(Best.Imp.EAS[Best.Imp.EAS$Imp.Method == "Impute2",]$R2,Best.Imp.EAS[Best.Imp.EAS$Imp.Method == "Impute5",]$R2)
wilcox.test(Best.Imp.EAS[Best.Imp.EAS$Imp.Method == "Minimac4",]$R2,Best.Imp.EAS[Best.Imp.EAS$Imp.Method == "Impute5",]$R2)
wilcox.test(Best.Imp.EAS[Best.Imp.EAS$Imp.Method == "Impute2",]$R2,Best.Imp.EAS[Best.Imp.EAS$Imp.Method == "Minimac4",]$R2)
summary(aov(R2 ~ Imp.Method, Best.Imp.EAS))
```


### Now to see which population is imputed the best

```{r}
Best.B.Pop <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", filter = "Mean.Beagle.BEAGLE_Phase.0.90")
colnames(Best.B.Pop) <- c("INV", "AFR", "EAS", "EUR")
Best.B.Pop <- melt(Best.B.Pop, id.vars = "INV")

Best.I2.Pop <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", filter = "Mean.Impute2.BEAGLE_Phase.0.90")
colnames(Best.I2.Pop) <- c("INV", "AFR", "EAS", "EUR")
Best.I2.Pop <- melt(Best.I2.Pop, id.vars = "INV")

Best.I5.Pop <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", filter = "Mean.Impute5.BEAGLE_Phase.0.90")
colnames(Best.I5.Pop) <- c("INV", "AFR", "EAS", "EUR")
Best.I5.Pop <- melt(Best.I5.Pop, id.vars = "INV")

Best.M4.Pop <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", filter = "Mean.Minimac4.BEAGLE_Phase.0.90")
colnames(Best.M4.Pop) <- c("INV", "AFR", "EAS", "EUR")
Best.M4.Pop <- melt(Best.M4.Pop, id.vars = "INV")
Best.M4.Pop

Best.Pop <- rbind(Best.B.Pop,Best.I2.Pop,Best.I5.Pop,Best.M4.Pop)
colnames(Best.Pop) <- c("INV", "Pop", "R2")
summary(aov(R2 ~ Pop, Best.Pop))

wilcox.test(Best.Pop[Best.Pop$Pop == "AFR",]$R2,Best.Pop[Best.Pop$Pop == "EUR",]$R2, alternative = "less")
wilcox.test(Best.Pop[Best.Pop$Pop == "AFR",]$R2,Best.Pop[Best.Pop$Pop == "EAS",]$R2, alternative = "greater")
wilcox.test(Best.Pop[Best.Pop$Pop == "EUR",]$R2,Best.Pop[Best.Pop$Pop == "EAS",]$R2, alternative = "greater")
```




### Compare the 2 best methods
```{r}
# Low filters

M4.0.AFR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", filter = "Mean.Minimac4.BEAGLE_Phase.0.00.AFR")
I2.0.AFR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", filter = "Mean.Impute2.BEAGLE_Phase.0.00.AFR")

M4.0.EUR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", filter = "Mean.Minimac4.BEAGLE_Phase.0.00.EUR")
I2.0.EUR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", filter = "Mean.Impute2.BEAGLE_Phase.0.00.EUR")

M4.0.EAS <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", filter = "Mean.Minimac4.BEAGLE_Phase.0.00.EAS")
I2.0.EAS <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", filter = "Mean.Impute2.BEAGLE_Phase.0.00.EAS")


# High filters

## 0.80
M4.0.80.AFR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", filter = "Mean.Minimac4.BEAGLE_Phase.0.80.AFR")
I2.0.80.AFR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", filter = "Mean.Impute2.BEAGLE_Phase.0.80.AFR")

M4.0.80.EUR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", filter = "Mean.Minimac4.BEAGLE_Phase.0.80.EUR")
I2.0.80.EUR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", filter = "Mean.Impute2.BEAGLE_Phase.0.80.EUR")

M4.0.80.EAS <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", filter = "Mean.Minimac4.BEAGLE_Phase.0.80.EAS")
I2.0.80.EAS <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", filter = "Mean.Impute2.BEAGLE_Phase.0.80.EAS")

## 0.90
M4.0.90.AFR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", filter = "Mean.Minimac4.BEAGLE_Phase.0.90.AFR")
I2.0.90.AFR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", filter = "Mean.Impute2.BEAGLE_Phase.0.90.AFR")

M4.0.90.EUR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", filter = "Mean.Minimac4.BEAGLE_Phase.0.90.EUR")
I2.0.90.EUR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", filter = "Mean.Impute2.BEAGLE_Phase.0.90.EUR")

M4.0.90.EAS <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", filter = "Mean.Minimac4.BEAGLE_Phase.0.90.EAS")
I2.0.90.EAS <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", filter = "Mean.Impute2.BEAGLE_Phase.0.90.EAS")



# Perform Wilcoxon test

Methods.Best.0.AFR <- cbind(M4.0.AFR, I2.0.AFR[2])
Methods.Best.0.AFR <- merge(Methods.Best.0.AFR, AFR_MAF, by = "INV")
#Methods.Best <- Methods.Best[Methods.Best$MAF <= 0.2 & Methods.Best$MAF > 0,]
wilcox.test(Methods.Best.0.AFR$Mean.Minimac4.BEAGLE_Phase.0.00.AFR, Methods.Best.0.AFR$Mean.Impute2.BEAGLE_Phase.0.00.AFR, paired = TRUE)

Methods.Best.0.EUR <- cbind(M4.0.EUR, I2.0.EUR[2])
Methods.Best.0.EUR <- merge(Methods.Best.0.EUR, EUR_MAF, by = "INV")
#Methods.Best <- Methods.Best[Methods.Best$MAF <= 0.2 & Methods.Best$MAF > 0,]
wilcox.test(Methods.Best.0.EUR$Mean.Minimac4.BEAGLE_Phase.0.00.EUR, Methods.Best.0.EUR$Mean.Impute2.BEAGLE_Phase.0.00.EUR, paired = TRUE)

Methods.Best.0.EAS <- cbind(M4.0.EAS, I2.0.EAS[2])
Methods.Best.0.EAS <- merge(Methods.Best.0.EAS, EAS_MAF, by = "INV")
#Methods.Best <- Methods.Best[Methods.Best$MAF <= 0.2 & Methods.Best$MAF > 0,]
wilcox.test(Methods.Best.0.EAS$Mean.Minimac4.BEAGLE_Phase.0.00.EAS, Methods.Best.0.EAS$Mean.Impute2.BEAGLE_Phase.0.00.EAS, paired = TRUE)


Methods.Best.0.90.AFR <- cbind(M4.0.90.AFR, I2.0.90.AFR[2])
Methods.Best.0.90.AFR <- merge(Methods.Best.0.90.AFR, AFR_MAF, by = "INV")
#Methods.Best <- Methods.Best[Methods.Best$MAF <= 0.2 & Methods.Best$MAF > 0,]
wilcox.test(Methods.Best.0.90.AFR$Mean.Minimac4.BEAGLE_Phase.0.90.AFR, Methods.Best.0.90.AFR$Mean.Impute2.BEAGLE_Phase.0.90.AFR, paired = TRUE)

Methods.Best.0.90.EUR <- cbind(M4.0.90.EUR, I2.0.90.EUR[2])
Methods.Best.0.90.EUR <- merge(Methods.Best.0.90.EUR, EUR_MAF, by = "INV")
#Methods.Best <- Methods.Best[Methods.Best$MAF <= 0.2 & Methods.Best$MAF > 0,]
wilcox.test(Methods.Best.0.90.EUR$Mean.Minimac4.BEAGLE_Phase.0.90.EUR, Methods.Best.0.90.EUR$Mean.Impute2.BEAGLE_Phase.0.90.EUR, paired = TRUE)

Methods.Best.0.90.EAS <- cbind(M4.0.90.EAS, I2.0.90.EAS[2])
Methods.Best.0.90.EAS <- merge(Methods.Best.0.90.EAS, EAS_MAF, by = "INV")
#Methods.Best <- Methods.Best[Methods.Best$MAF <= 0.2 & Methods.Best$MAF > 0,]
wilcox.test(Methods.Best.0.90.EAS$Mean.Minimac4.BEAGLE_Phase.0.90.EAS, Methods.Best.0.90.EAS$Mean.Impute2.BEAGLE_Phase.0.90.EAS, paired = TRUE)


Methods.Best.0.80.AFR <- cbind(M4.0.80.AFR, I2.0.80.AFR[2])
Methods.Best.0.80.AFR <- merge(Methods.Best.0.80.AFR, AFR_MAF, by = "INV")
#Methods.Best <- Methods.Best[Methods.Best$MAF <= 0.2 & Methods.Best$MAF > 0,]
wilcox.test(Methods.Best.0.80.AFR$Mean.Minimac4.BEAGLE_Phase.0.80.AFR, Methods.Best.0.80.AFR$Mean.Impute2.BEAGLE_Phase.0.80.AFR, paired = TRUE)

Methods.Best.0.80.EUR <- cbind(M4.0.80.EUR, I2.0.80.EUR[2])
Methods.Best.0.80.EUR <- merge(Methods.Best.0.80.EUR, EUR_MAF, by = "INV")
#Methods.Best <- Methods.Best[Methods.Best$MAF <= 0.2 & Methods.Best$MAF > 0,]
wilcox.test(Methods.Best.0.80.EUR$Mean.Minimac4.BEAGLE_Phase.0.80.EUR, Methods.Best.0.80.EUR$Mean.Impute2.BEAGLE_Phase.0.80.EUR, paired = TRUE)

Methods.Best.0.80.EAS <- cbind(M4.0.80.EAS, I2.0.80.EAS[2])
Methods.Best.0.80.EAS <- merge(Methods.Best.0.80.EAS, EAS_MAF, by = "INV")
#Methods.Best <- Methods.Best[Methods.Best$MAF <= 0.2 & Methods.Best$MAF > 0,]
wilcox.test(Methods.Best.0.80.EAS$Mean.Minimac4.BEAGLE_Phase.0.80.EAS, Methods.Best.0.80.EAS$Mean.Impute2.BEAGLE_Phase.0.80.EAS, paired = TRUE)


# Check for low frequency inversions
## No filter
Methods.Best.low.0.AFR <- Methods.Best.0.AFR[Methods.Best.0.AFR$MAF <= 0.2 & Methods.Best.0.AFR$MAF > 0,]
wilcox.test(Methods.Best.low.0.AFR$Mean.Minimac4.BEAGLE_Phase.0.00.AFR, Methods.Best.low.0.AFR$Mean.Impute2.BEAGLE_Phase.0.00.AFR, paired = TRUE)
Methods.Best.low.0.EUR <- Methods.Best.0.EUR[Methods.Best.0.EUR$MAF <= 0.2 & Methods.Best.0.EUR$MAF > 0,]
wilcox.test(Methods.Best.low.0.EUR$Mean.Minimac4.BEAGLE_Phase.0.00.EUR, Methods.Best.low.0.EUR$Mean.Impute2.BEAGLE_Phase.0.00.EUR, paired = TRUE)
Methods.Best.low.0.EAS <- Methods.Best.0.EAS[Methods.Best.0.EAS$MAF <= 0.2 & Methods.Best.0.EAS$MAF > 0,]
wilcox.test(Methods.Best.low.0.EAS$Mean.Minimac4.BEAGLE_Phase.0.00.EAS, Methods.Best.low.0.EAS$Mean.Impute2.BEAGLE_Phase.0.00.EAS, paired = TRUE)

## 0.90
Methods.Best.low.0.90.AFR <- Methods.Best.0.90.AFR[Methods.Best.0.90.AFR$MAF <= 0.2 & Methods.Best.0.90.AFR$MAF > 0,]
wilcox.test(Methods.Best.low.0.90.AFR$Mean.Minimac4.BEAGLE_Phase.0.90.AFR, Methods.Best.low.0.90.AFR$Mean.Impute2.BEAGLE_Phase.0.90.AFR, paired = TRUE)
Methods.Best.low.0.90.EUR <- Methods.Best.0.90.EUR[Methods.Best.0.90.EUR$MAF <= 0.2 & Methods.Best.0.90.EUR$MAF > 0,]
wilcox.test(Methods.Best.low.0.90.EUR$Mean.Minimac4.BEAGLE_Phase.0.90.EUR, Methods.Best.low.0.90.EUR$Mean.Impute2.BEAGLE_Phase.0.90.EUR, paired = TRUE)
Methods.Best.low.0.90.EAS <- Methods.Best.0.90.EAS[Methods.Best.0.90.EAS$MAF <= 0.2 & Methods.Best.0.90.EAS$MAF > 0,]
wilcox.test(Methods.Best.low.0.90.EAS$Mean.Minimac4.BEAGLE_Phase.0.90.EAS, Methods.Best.low.0.90.EAS$Mean.Impute2.BEAGLE_Phase.0.90.EAS, paired = TRUE)

## 0.95
Methods.Best.low.0.80.AFR <- Methods.Best.0.80.AFR[Methods.Best.0.80.AFR$MAF <= 0.2 & Methods.Best.0.80.AFR$MAF > 0,]
wilcox.test(Methods.Best.low.0.80.AFR$Mean.Minimac4.BEAGLE_Phase.0.80.AFR, Methods.Best.low.0.80.AFR$Mean.Impute2.BEAGLE_Phase.0.80.AFR, paired = TRUE)
Methods.Best.low.0.80.EUR <- Methods.Best.0.80.EUR[Methods.Best.0.80.EUR$MAF <= 0.2 & Methods.Best.0.80.EUR$MAF > 0,]
wilcox.test(Methods.Best.low.0.80.EUR$Mean.Minimac4.BEAGLE_Phase.0.80.EUR, Methods.Best.low.0.80.EUR$Mean.Impute2.BEAGLE_Phase.0.80.EUR, paired = TRUE)
Methods.Best.low.0.80.EAS <- Methods.Best.0.80.EAS[Methods.Best.0.80.EAS$MAF <= 0.2 & Methods.Best.0.80.EAS$MAF > 0,]
wilcox.test(Methods.Best.low.0.80.EAS$Mean.Minimac4.BEAGLE_Phase.0.80.EAS, Methods.Best.low.0.80.EAS$Mean.Impute2.BEAGLE_Phase.0.80.EAS, paired = TRUE)
```

## Plot to compare

```{r, warning= FALSE}
Methods.Best.0.80.AFR.plot <- Methods.Best.0.80.AFR[-4] %>% merge(AFR_Freq, by = "INV")
Methods.Best.0.80.EUR.plot <- Methods.Best.0.80.EUR[-4] %>% merge(EUR_Freq, by = "INV")
Methods.Best.0.80.EAS.plot <- Methods.Best.0.80.EAS[-4] %>% merge(EAS_Freq, by = "INV")

pivot_longer(Methods.Best.0.80.AFR.plot, cols = c(-Freq, -INV), names_to = c("Imp.Method", "Pop"), names_pattern = "(.*)(AFR)")
?pivot_longer
Methods.Best.0.80.AFR.plot
Methods.Best.0.80.plot <- rbind(pivot_longer(Methods.Best.0.80.AFR.plot, cols = c(-Freq, -INV), names_to = c("Imp.Method", "Pop"), names_pattern = "(.*)(AFR)"),pivot_longer(Methods.Best.0.80.EUR.plot, cols = c(-Freq, -INV), names_to = c("Imp.Method", "Pop"), names_pattern = "(.*)(EUR)"),pivot_longer(Methods.Best.0.80.EAS.plot, cols = c(-Freq, -INV), names_to = c("Imp.Method", "Pop"), names_pattern = "(.*)(EAS)"))

Methods.Best.0.80.plot

ggplot() + geom_point(data = Methods.Best.0.80.plot, mapping = aes(x = Freq, y = value, color = Pop, shape = Imp.Method)) + 
  scale_color_manual(breaks = c("AFR", "EUR", "EAS"),
    values = c("#F8766D","#619CFF","#00BA38"))
?geom_point
ggplot() + geom_point(data = Methods.Best.0.80.AFR.plot, mapping = aes(x = Freq, y = Mean.Minimac4.BEAGLE_Phase.0.80.AFR, color = "#F8766D")) + geom_point(data = Methods.Best.0.80.AFR.plot, mapping = aes(x = Freq, y = Mean.Impute2.BEAGLE_Phase.0.80.AFR, color = "#00BFC4")) + 
  scale_color_discrete(name = "Imputation Method", labels = c("Minimac4", "Impute2")) + 
  labs(y = expression("Average"~r^2), x = "Inversion Frequency", title = "Inversion Imputability vs Inversion Frequency", subtitle = "For AFR using a 0.80 GP fiter")
```



## Heatmap Plot
```{r, warning=FALSE}
Inv.Data.plot.pops.plot <- Inv.Data.IndvsPerPop
Inv.Data.Plot.EUR <- Inv.Data.plot.pops.plot[c(1,4)]
Inv.Data.Plot.AFR <- Inv.Data.plot.pops.plot[c(1,2)]
Inv.Data.Plot.EAS <- Inv.Data.plot.pops.plot[c(1,3)]
Inv.Data.Plot.EAS <- Inv.Data.Plot.EAS[order(Inv.Data.Plot.EAS$EAS.Num.Samples, decreasing = TRUE),]
Inv.Data.Plot.EUR <- Inv.Data.Plot.EUR[order(Inv.Data.Plot.EUR$EUR.Num.Samples, decreasing = TRUE),]
Inv.Data.Plot.AFR <- Inv.Data.Plot.AFR[order(Inv.Data.Plot.AFR$AFR.Num.Samples, decreasing = TRUE),]
Inv.Data.Plot.EAS$EAS.Num.Samples <- as.character(Inv.Data.Plot.EAS$EAS.Num.Samples)
Inv.Data.Plot.EUR$EUR.Num.Samples <- as.character(Inv.Data.Plot.EUR$EUR.Num.Samples)
Inv.Data.Plot.AFR$AFR.Num.Samples <- as.character(Inv.Data.Plot.AFR$AFR.Num.Samples)




BEAGLE.BEAGLE_Phase.Invs.EUR <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean")
Impute2.BEAGLE_Phase.Invs.EUR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean")
Impute5.BEAGLE_Phase.Invs.EUR <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean")
Minimac4.BEAGLE_Phase.Invs.EUR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean")
ScoreInvHap.Invs.EUR <- sel_df(Imputation.Info, imp_method = "ScoreInvHap", pop = "EUR", filter = "Mean")

BEAGLE.BEAGLE_Phase.Invs.EUR <- BEAGLE.BEAGLE_Phase.Invs.EUR[match(Inv.Data.Plot.EUR$INV, BEAGLE.BEAGLE_Phase.Invs.EUR$INV),]
rownames(BEAGLE.BEAGLE_Phase.Invs.EUR) <- c()
BEAGLE.BEAGLE_Phase.Invs.EUR <- column_to_rownames(BEAGLE.BEAGLE_Phase.Invs.EUR, var = "INV")
colnames(BEAGLE.BEAGLE_Phase.Invs.EUR) <- c("0.00", "0.30","0.50", "0.70", "0.80", "0.90", "0.95")
BEAGLE.BEAGLE_Phase.Invs.EUR <- BEAGLE.BEAGLE_Phase.Invs.EUR %>% mutate_at(
  vars(`0.00`,`0.30`,`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
BEAGLE.BEAGLE_Phase.Invs.EUR <- roundAll(BEAGLE.BEAGLE_Phase.Invs.EUR, 2)

Impute2.BEAGLE_Phase.Invs.EUR <- Impute2.BEAGLE_Phase.Invs.EUR[match(Inv.Data.Plot.EUR$INV, Impute2.BEAGLE_Phase.Invs.EUR$INV),]
rownames(Impute2.BEAGLE_Phase.Invs.EUR) <- c()
Impute2.BEAGLE_Phase.Invs.EUR <- column_to_rownames(Impute2.BEAGLE_Phase.Invs.EUR, var = "INV")
colnames(Impute2.BEAGLE_Phase.Invs.EUR) <- c("0.00", "0.30","0.50", "0.70", "0.80", "0.90", "0.95")
Impute2.BEAGLE_Phase.Invs.EUR <- Impute2.BEAGLE_Phase.Invs.EUR %>% mutate_at(
  vars(`0.00`,`0.30`,`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Impute2.BEAGLE_Phase.Invs.EUR <- roundAll(Impute2.BEAGLE_Phase.Invs.EUR, 2)


Impute5.BEAGLE_Phase.Invs.EUR <- Impute5.BEAGLE_Phase.Invs.EUR[match(Inv.Data.Plot.EUR$INV, Impute5.BEAGLE_Phase.Invs.EUR$INV),]
rownames(Impute5.BEAGLE_Phase.Invs.EUR) <- c()
Impute5.BEAGLE_Phase.Invs.EUR <- column_to_rownames(Impute5.BEAGLE_Phase.Invs.EUR, var = "INV")
colnames(Impute5.BEAGLE_Phase.Invs.EUR) <- c("0.00", "0.30","0.50", "0.70", "0.80", "0.90", "0.95")
Impute5.BEAGLE_Phase.Invs.EUR <- Impute5.BEAGLE_Phase.Invs.EUR %>% mutate_at(
  vars(`0.00`,`0.30`,`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Impute5.BEAGLE_Phase.Invs.EUR <- roundAll(Impute5.BEAGLE_Phase.Invs.EUR, 2)


Minimac4.BEAGLE_Phase.Invs.EUR <- Minimac4.BEAGLE_Phase.Invs.EUR[match(Inv.Data.Plot.EUR$INV, Minimac4.BEAGLE_Phase.Invs.EUR$INV),]
rownames(Minimac4.BEAGLE_Phase.Invs.EUR) <- c()
Minimac4.BEAGLE_Phase.Invs.EUR <- column_to_rownames(Minimac4.BEAGLE_Phase.Invs.EUR, var = "INV")
colnames(Minimac4.BEAGLE_Phase.Invs.EUR) <- c("0.00", "0.30","0.50", "0.70", "0.80", "0.90", "0.95")
Minimac4.BEAGLE_Phase.Invs.EUR <- Minimac4.BEAGLE_Phase.Invs.EUR %>% mutate_at(
  vars(`0.00`,`0.30`,`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Minimac4.BEAGLE_Phase.Invs.EUR <- roundAll(Minimac4.BEAGLE_Phase.Invs.EUR, 2)


ScoreInvHap.Invs.EUR <- ScoreInvHap.Invs.EUR[match(Inv.Data.Plot.EUR$INV, ScoreInvHap.Invs.EUR$INV),]
rownames(ScoreInvHap.Invs.EUR) <- c()
ScoreInvHap.Invs.EUR <- column_to_rownames(ScoreInvHap.Invs.EUR, var = "INV")
colnames(ScoreInvHap.Invs.EUR) <- c("R2")
ScoreInvHap.Invs.EUR <- roundAll(ScoreInvHap.Invs.EUR, 2)
ScoreInvHap.Invs.EUR <- ScoreInvHap.Invs.EUR %>% mutate_at(
  vars(`R2`), funs(as.character)
)


cols <- c(rep("white", 51), colorRampPalette(c("white", "#FFC0C0"),bias = 10)(25),colorRampPalette(c("#FFC0C0", "red"),bias = 10)(25))
png("../Results_Stats/IA_EUR.png", height = 4134, width = 5000)
par(mar = c(20,50,10,1), bg = "#F6F9FF")
#par(mfrow = c(1,4))
layout( matrix(c(rep(1,38), rep(2,30), rep(3,30), rep(4,30), rep(5, 23), rep(6, 23)), nrow = 1))
plot(as.matrix(BEAGLE.BEAGLE_Phase.Invs.EUR[,c(3,6,7)]), xaxt = "n", axis.col = NULL, yaxt = "n",
     axis.row = list(side = 2, las = 1, cex.axis = 7, line = 8, tick = F), ylab = "", xlab = "", col = cols,
     breaks = round(c(0, seq(100)/100), 2), main = "BEAGLE", digits = 4, text.cell = list(cex=5.4), 
     na.col = "gray", key = NULL, cex.main = 8)
axis(1, line = 5, tick = F, cex.axis = 6, labels = Filters[c(1,4,5)], at = seq(3))
#axis(2, line = 10, tick = F, cex.axis = 7, labels(rownames(BeMtxEUR)), at = seq(length(rownames(BeMtxEUR))))

par(mar = c(20,15,10,1))
plot(as.matrix(Impute2.BEAGLE_Phase.Invs.EUR[,c(3,6,7)]), axis.col = NULL,
     axis.row = NULL, ylab = "", xlab = "", col = cols,
     breaks = round(c(0, seq(100)/100), 2), main = "IMPUTE2", digits = 4, text.cell = list(cex=5.4), 
     na.col = "gray", key = NULL, cex.lab = 10, cex.main = 8)
axis(1, line = 5, tick = F, cex.axis = 6, labels = Filters[c(1,4,5)], at = seq(3))

plot(as.matrix(Impute5.BEAGLE_Phase.Invs.EUR[,c(3,6,7)]), axis.col = NULL,
     axis.row = NULL, ylab = "", xlab = "", col = cols,
     breaks = round(c(0, seq(100)/100), 2), main = "IMPUTE5", digits = 4, text.cell = list(cex=5.4), 
     na.col = "gray", key = NULL, cex.main = 8)
axis(1, line = 5, tick = F, cex.axis = 6, labels = Filters[c(1,4,5)], at = seq(3))
title(xlab = "Filter", line = 15, cex.lab = 8)

plot(as.matrix(Minimac4.BEAGLE_Phase.Invs.EUR[,c(3,6,7)]), axis.col = NULL,
     axis.row = NULL, ylab = "", xlab = "", col = cols,
     breaks = round(c(0, seq(100)/100), 2), main = "Minimac4", digits = 4, text.cell = list(cex=5.4),
     na.col = "gray", key = NULL, cex.main = 8)
axis(1, line = 5, tick = F, cex.axis = 6, labels = Filters[c(1,4,5)], at = seq(3))

par(mar = c(20,15,10,15))
plot(as.matrix(ScoreInvHap.Invs.EUR[,1]), axis.col = NULL,
     axis.row = NULL, ylab = "", xlab = "", col = cols,
     breaks = round(c(0, seq(100)/100), 2), main = "scoreInvHap", digits = 4, text.cell = list(cex=5.4), 
     na.col = "gray", key = NULL, cex.main = 8)

plot(as.matrix(Inv.Data.Plot.EUR[,2]), axis.col = NULL,
     axis.row = NULL, ylab = "", xlab = "", col = colorRampPalette(c("orange", "yellow", "green"))(200),
     breaks = seq(200), main = "Num of Individuals", digits = 4, text.cell = list(cex=5.4), 
     na.col = "gray", key = NULL, cex.main = 8)
dev.off()
```

### AFR

```{r, warning=FALSE}
BEAGLE.BEAGLE_Phase.Invs.AFR <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean")
Impute2.BEAGLE_Phase.Invs.AFR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean")
Impute5.BEAGLE_Phase.Invs.AFR <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean")
Minimac4.BEAGLE_Phase.Invs.AFR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean")
ScoreInvHap.Invs.AFR <- sel_df(Imputation.Info, imp_method = "ScoreInvHap", pop = "AFR", filter = "Mean")

BEAGLE.BEAGLE_Phase.Invs.AFR <- BEAGLE.BEAGLE_Phase.Invs.AFR[match(Inv.Data.Plot.AFR$INV, BEAGLE.BEAGLE_Phase.Invs.AFR$INV),]
rownames(BEAGLE.BEAGLE_Phase.Invs.AFR) <- c()
BEAGLE.BEAGLE_Phase.Invs.AFR <- column_to_rownames(BEAGLE.BEAGLE_Phase.Invs.AFR, var = "INV")
colnames(BEAGLE.BEAGLE_Phase.Invs.AFR) <- c("0.00", "0.30","0.50", "0.70", "0.80", "0.90", "0.95")
BEAGLE.BEAGLE_Phase.Invs.AFR <- BEAGLE.BEAGLE_Phase.Invs.AFR %>% mutate_at(
  vars(`0.00`,`0.30`,`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
BEAGLE.BEAGLE_Phase.Invs.AFR <- roundAll(BEAGLE.BEAGLE_Phase.Invs.AFR, 2)

Impute2.BEAGLE_Phase.Invs.AFR <- Impute2.BEAGLE_Phase.Invs.AFR[match(Inv.Data.Plot.AFR$INV, Impute2.BEAGLE_Phase.Invs.AFR$INV),]
rownames(Impute2.BEAGLE_Phase.Invs.AFR) <- c()
Impute2.BEAGLE_Phase.Invs.AFR <- column_to_rownames(Impute2.BEAGLE_Phase.Invs.AFR, var = "INV")
colnames(Impute2.BEAGLE_Phase.Invs.AFR) <- c("0.00", "0.30","0.50", "0.70", "0.80", "0.90", "0.95")
Impute2.BEAGLE_Phase.Invs.AFR <- Impute2.BEAGLE_Phase.Invs.AFR %>% mutate_at(
  vars(`0.00`,`0.30`,`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Impute2.BEAGLE_Phase.Invs.AFR <- roundAll(Impute2.BEAGLE_Phase.Invs.AFR, 2)


Impute5.BEAGLE_Phase.Invs.AFR <- Impute5.BEAGLE_Phase.Invs.AFR[match(Inv.Data.Plot.AFR$INV, Impute5.BEAGLE_Phase.Invs.AFR$INV),]
rownames(Impute5.BEAGLE_Phase.Invs.AFR) <- c()
Impute5.BEAGLE_Phase.Invs.AFR <- column_to_rownames(Impute5.BEAGLE_Phase.Invs.AFR, var = "INV")
colnames(Impute5.BEAGLE_Phase.Invs.AFR) <- c("0.00", "0.30","0.50", "0.70", "0.80", "0.90", "0.95")
Impute5.BEAGLE_Phase.Invs.AFR <- Impute5.BEAGLE_Phase.Invs.AFR %>% mutate_at(
  vars(`0.00`,`0.30`,`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Impute5.BEAGLE_Phase.Invs.AFR <- roundAll(Impute5.BEAGLE_Phase.Invs.AFR, 2)


Minimac4.BEAGLE_Phase.Invs.AFR <- Minimac4.BEAGLE_Phase.Invs.AFR[match(Inv.Data.Plot.AFR$INV, Minimac4.BEAGLE_Phase.Invs.AFR$INV),]
rownames(Minimac4.BEAGLE_Phase.Invs.AFR) <- c()
Minimac4.BEAGLE_Phase.Invs.AFR <- column_to_rownames(Minimac4.BEAGLE_Phase.Invs.AFR, var = "INV")
colnames(Minimac4.BEAGLE_Phase.Invs.AFR) <- c("0.00", "0.30","0.50", "0.70", "0.80", "0.90", "0.95")
Minimac4.BEAGLE_Phase.Invs.AFR <- Minimac4.BEAGLE_Phase.Invs.AFR %>% mutate_at(
  vars(`0.00`,`0.30`,`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Minimac4.BEAGLE_Phase.Invs.AFR <- roundAll(Minimac4.BEAGLE_Phase.Invs.AFR, 2)

ScoreInvHap.Invs.AFR <- ScoreInvHap.Invs.AFR[match(Inv.Data.Plot.AFR$INV, ScoreInvHap.Invs.AFR$INV),]
rownames(ScoreInvHap.Invs.AFR) <- c()
ScoreInvHap.Invs.AFR <- column_to_rownames(ScoreInvHap.Invs.AFR, var = "INV")
colnames(ScoreInvHap.Invs.AFR) <- c("R2")
ScoreInvHap.Invs.AFR <- roundAll(ScoreInvHap.Invs.AFR, 2)
ScoreInvHap.Invs.AFR <- ScoreInvHap.Invs.AFR %>% mutate_at(
  vars(`R2`), funs(as.character)
)

Filters = c("0.50", "0.70", "0.80", "0.90", "0.95")

cols <- c(rep("white", 51), colorRampPalette(c("white", "#FFC0C0"),bias = 10)(25),colorRampPalette(c("#FFC0C0", "red"),bias = 10)(25))
png("../Results_Stats/IA_AFR.png", height = 4134, width = 5000)
par(mar = c(20,50,10,1), bg = "#F6F9FF")
#par(mfrow = c(1,4))

layout( matrix(c(rep(1,38), rep(2,30), rep(3,30), rep(4,30), rep(5, 23), rep(6, 23)), nrow = 1))
plot(as.matrix(BEAGLE.BEAGLE_Phase.Invs.AFR[,c(3,6,7)]), xaxt = "n", axis.col = NULL, yaxt = "n",
     axis.row = list(side = 2, las = 1, cex.axis = 7, line = 8, tick = F), ylab = "", xlab = "", col = cols,
     breaks = round(c(0, seq(100)/100), 2), main = "BEAGLE", digits = 4, text.cell = list(cex=5.4), 
     na.col = "gray", key = NULL, cex.main = 8)
axis(1, line = 5, tick = F, cex.axis = 6, labels = Filters[c(1,4,5)], at = seq(3))
#axis(2, line = 10, tick = F, cex.axis = 7, labels(rownames(BeMtxAFR)), at = seq(length(rownames(BeMtxAFR))))

par(mar = c(20,15,10,1))
plot(as.matrix(Impute2.BEAGLE_Phase.Invs.AFR[,c(3,6,7)]), axis.col = NULL,
     axis.row = NULL, ylab = "", xlab = "", col = cols,
     breaks = round(c(0, seq(100)/100), 2), main = "IMPUTE2", digits = 4, text.cell = list(cex=5.4), 
     na.col = "gray", key = NULL, cex.lab = 10, cex.main = 8)
axis(1, line = 5, tick = F, cex.axis = 6, labels = Filters[c(1,4,5)], at = seq(3))

plot(as.matrix(Impute5.BEAGLE_Phase.Invs.AFR[,c(3,6,7)]), axis.col = NULL,
     axis.row = NULL, ylab = "", xlab = "", col = cols,
     breaks = round(c(0, seq(100)/100), 2), main = "IMPUTE5", digits = 4, text.cell = list(cex=5.4), 
     na.col = "gray", key = NULL, cex.main = 8)
axis(1, line = 5, tick = F, cex.axis = 6, labels = Filters[c(1,4,5)], at = seq(3))
title(xlab = "Filter", line = 15, cex.lab = 8)

plot(as.matrix(Minimac4.BEAGLE_Phase.Invs.AFR[,c(3,6,7)]), axis.col = NULL,
     axis.row = NULL, ylab = "", xlab = "", col = cols,
     breaks = round(c(0, seq(100)/100), 2), main = "Minimac4", digits = 4, text.cell = list(cex=5.4),
     na.col = "gray", key = NULL, cex.main = 8)
axis(1, line = 5, tick = F, cex.axis = 6, labels = Filters[c(1,4,5)], at = seq(3))

par(mar = c(20,15,10,15))
plot(as.matrix(ScoreInvHap.Invs.AFR[,1]), axis.col = NULL,
     axis.row = NULL, ylab = "", xlab = "", col = cols,
     breaks = round(c(0, seq(100)/100), 2), main = "scoreInvHap", digits = 4, text.cell = list(cex=5.4), 
     na.col = "gray", key = NULL, cex.main = 8)

plot(as.matrix(Inv.Data.Plot.AFR[,2]), axis.col = NULL,
     axis.row = NULL, ylab = "", xlab = "", col = colorRampPalette(c("orange", "yellow", "green"))(200),
     breaks = seq(200), main = "Num of Individuals", digits = 4, text.cell = list(cex=5.4), 
     na.col = "gray", key = NULL, cex.main = 8)
dev.off()
```


### EAS
```{r, warning=FALSE}
BEAGLE.BEAGLE_Phase.Invs.EAS <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean")
Impute2.BEAGLE_Phase.Invs.EAS <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean")
Impute5.BEAGLE_Phase.Invs.EAS <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean")
Minimac4.BEAGLE_Phase.Invs.EAS <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean")
ScoreInvHap.Invs.EAS <- sel_df(Imputation.Info, imp_method = "ScoreInvHap", pop = "EAS", filter = "Mean")

BEAGLE.BEAGLE_Phase.Invs.EAS <- BEAGLE.BEAGLE_Phase.Invs.EAS[match(Inv.Data.Plot.EAS$INV, BEAGLE.BEAGLE_Phase.Invs.EAS$INV),]
rownames(BEAGLE.BEAGLE_Phase.Invs.EAS) <- c()
BEAGLE.BEAGLE_Phase.Invs.EAS <- column_to_rownames(BEAGLE.BEAGLE_Phase.Invs.EAS, var = "INV")
colnames(BEAGLE.BEAGLE_Phase.Invs.EAS) <- c("0.00", "0.30","0.50", "0.70", "0.80", "0.90", "0.95")
BEAGLE.BEAGLE_Phase.Invs.EAS <- BEAGLE.BEAGLE_Phase.Invs.EAS %>% mutate_at(
  vars(`0.00`,`0.30`,`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
BEAGLE.BEAGLE_Phase.Invs.EAS <- roundAll(BEAGLE.BEAGLE_Phase.Invs.EAS, 2)

Impute2.BEAGLE_Phase.Invs.EAS <- Impute2.BEAGLE_Phase.Invs.EAS[match(Inv.Data.Plot.EAS$INV, Impute2.BEAGLE_Phase.Invs.EAS$INV),]
rownames(Impute2.BEAGLE_Phase.Invs.EAS) <- c()
Impute2.BEAGLE_Phase.Invs.EAS <- column_to_rownames(Impute2.BEAGLE_Phase.Invs.EAS, var = "INV")
colnames(Impute2.BEAGLE_Phase.Invs.EAS) <- c("0.00", "0.30","0.50", "0.70", "0.80", "0.90", "0.95")
Impute2.BEAGLE_Phase.Invs.EAS <- Impute2.BEAGLE_Phase.Invs.EAS %>% mutate_at(
  vars(`0.00`,`0.30`,`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Impute2.BEAGLE_Phase.Invs.EAS <- roundAll(Impute2.BEAGLE_Phase.Invs.EAS, 2)


Impute5.BEAGLE_Phase.Invs.EAS <- Impute5.BEAGLE_Phase.Invs.EAS[match(Inv.Data.Plot.EAS$INV, Impute5.BEAGLE_Phase.Invs.EAS$INV),]
rownames(Impute5.BEAGLE_Phase.Invs.EAS) <- c()
Impute5.BEAGLE_Phase.Invs.EAS <- column_to_rownames(Impute5.BEAGLE_Phase.Invs.EAS, var = "INV")
colnames(Impute5.BEAGLE_Phase.Invs.EAS) <- c("0.00", "0.30","0.50", "0.70", "0.80", "0.90", "0.95")
Impute5.BEAGLE_Phase.Invs.EAS <- Impute5.BEAGLE_Phase.Invs.EAS %>% mutate_at(
  vars(`0.00`,`0.30`,`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Impute5.BEAGLE_Phase.Invs.EAS <- roundAll(Impute5.BEAGLE_Phase.Invs.EAS, 2)


Minimac4.BEAGLE_Phase.Invs.EAS <- Minimac4.BEAGLE_Phase.Invs.EAS[match(Inv.Data.Plot.EAS$INV, Minimac4.BEAGLE_Phase.Invs.EAS$INV),]
rownames(Minimac4.BEAGLE_Phase.Invs.EAS) <- c()
Minimac4.BEAGLE_Phase.Invs.EAS <- column_to_rownames(Minimac4.BEAGLE_Phase.Invs.EAS, var = "INV")
colnames(Minimac4.BEAGLE_Phase.Invs.EAS) <- c("0.00", "0.30","0.50", "0.70", "0.80", "0.90", "0.95")
Minimac4.BEAGLE_Phase.Invs.EAS <- Minimac4.BEAGLE_Phase.Invs.EAS %>% mutate_at(
  vars(`0.00`,`0.30`,`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Minimac4.BEAGLE_Phase.Invs.EAS <- roundAll(Minimac4.BEAGLE_Phase.Invs.EAS, 2)


ScoreInvHap.Invs.EAS <- ScoreInvHap.Invs.EAS[match(Inv.Data.Plot.EAS$INV, ScoreInvHap.Invs.EAS$INV),]
rownames(ScoreInvHap.Invs.EAS) <- c()
ScoreInvHap.Invs.EAS <- column_to_rownames(ScoreInvHap.Invs.EAS, var = "INV")
colnames(ScoreInvHap.Invs.EAS) <- c("R2")
ScoreInvHap.Invs.EAS <- roundAll(ScoreInvHap.Invs.EAS, 2)
ScoreInvHap.Invs.EAS <- ScoreInvHap.Invs.EAS %>% mutate_at(
  vars(`R2`), funs(as.character)
)

Filters = c("0.50", "0.70", "0.80", "0.90", "0.95")

cols <- c(rep("white", 51), colorRampPalette(c("white", "#FFC0C0"),bias = 10)(25),colorRampPalette(c("#FFC0C0", "red"),bias = 10)(25))

png("../Results_Stats/IA_EAS.png", height = 4134, width = 5000)
par(mar = c(20,50,10,1), bg = "#F6F9FF")
#par(mfrow = c(1,4))

layout( matrix(c(rep(1,38), rep(2,30), rep(3,30), rep(4,30), rep(5, 23), rep(6, 23)), nrow = 1))
plot(as.matrix(BEAGLE.BEAGLE_Phase.Invs.EAS[,c(3,6,7)]), xaxt = "n", axis.col = NULL, yaxt = "n",
     axis.row = list(side = 2, las = 1, cex.axis = 7, line = 8, tick = F), ylab = "", xlab = "", col = cols,
     breaks = round(c(0, seq(100)/100), 2), main = "BEAGLE", digits = 4, text.cell = list(cex=5.4), 
     na.col = "gray", key = NULL, cex.main = 8)
axis(1, line = 5, tick = F, cex.axis = 6, labels = Filters[c(1,4,5)], at = seq(3))
#axis(2, line = 10, tick = F, cex.axis = 7, labels(rownames(BeMtxEAS)), at = seq(length(rownames(BeMtxEAS))))

par(mar = c(20,15,10,1))
plot(as.matrix(Impute2.BEAGLE_Phase.Invs.EAS[,c(3,6,7)]), axis.col = NULL,
     axis.row = NULL, ylab = "", xlab = "", col = cols,
     breaks = round(c(0, seq(100)/100), 2), main = "IMPUTE2", digits = 4, text.cell = list(cex=5.4), 
     na.col = "gray", key = NULL, cex.lab = 10, cex.main = 8)
axis(1, line = 5, tick = F, cex.axis = 6, labels = Filters[c(1,4,5)], at = seq(3))

plot(as.matrix(Impute5.BEAGLE_Phase.Invs.EAS[,c(3,6,7)]), axis.col = NULL,
     axis.row = NULL, ylab = "", xlab = "", col = cols,
     breaks = round(c(0, seq(100)/100), 2), main = "IMPUTE5", digits = 4, text.cell = list(cex=5.4), 
     na.col = "gray", key = NULL, cex.main = 8)
axis(1, line = 5, tick = F, cex.axis = 6, labels = Filters[c(1,4,5)], at = seq(3))
title(xlab = "Filter", line = 15, cex.lab = 8)

plot(as.matrix(Minimac4.BEAGLE_Phase.Invs.EAS[,c(3,6,7)]), axis.col = NULL,
     axis.row = NULL, ylab = "", xlab = "", col = cols,
     breaks = round(c(0, seq(100)/100), 2), main = "Minimac4", digits = 4, text.cell = list(cex=5.4),
     na.col = "gray", key = NULL, cex.main = 8)
axis(1, line = 5, tick = F, cex.axis = 6, labels = Filters[c(1,4,5)], at = seq(3))

par(mar = c(20,15,10,15))
plot(as.matrix(ScoreInvHap.Invs.EAS[,1]), axis.col = NULL,
     axis.row = NULL, ylab = "", xlab = "", col = cols,
     breaks = round(c(0, seq(100)/100), 2), main = "scoreInvHap", digits = 4, text.cell = list(cex=5.4), 
     na.col = "gray", key = NULL, cex.main = 8)

plot(as.matrix(Inv.Data.Plot.EAS[,2]), axis.col = NULL,
     axis.row = NULL, ylab = "", xlab = "", col = colorRampPalette(c("orange", "yellow", "green"))(200),
     breaks = seq(200), main = "Num of Individuals", digits = 4, text.cell = list(cex=5.4), 
     na.col = "gray", key = NULL, cex.main = 8)
dev.off()
```


### Upset plot

### ALL

```{r}
BEAGLE.BEAGLE_Phase.Imp.AFR <- BEAGLE.BEAGLE_Phase.Invs.AFR[BEAGLE.BEAGLE_Phase.Invs.AFR$`0.95` >= 0.8,]
BEAGLE.BEAGLE_Phase.Imp.AFR <- rownames(BEAGLE.BEAGLE_Phase.Imp.AFR[!is.na(BEAGLE.BEAGLE_Phase.Imp.AFR$`0.95`),])
BEAGLE.BEAGLE_Phase.Imp.AFR

Impute2.BEAGLE_Phase.Imp.AFR <- Impute2.BEAGLE_Phase.Invs.AFR[Impute2.BEAGLE_Phase.Invs.AFR$`0.95` >= 0.8,]
Impute2.BEAGLE_Phase.Imp.AFR <- rownames(Impute2.BEAGLE_Phase.Imp.AFR[!is.na(Impute2.BEAGLE_Phase.Imp.AFR$`0.95`),])
Impute2.BEAGLE_Phase.Imp.AFR

Impute5.BEAGLE_Phase.Imp.AFR <- Impute5.BEAGLE_Phase.Invs.AFR[Impute5.BEAGLE_Phase.Invs.AFR$`0.95` >= 0.8,]
Impute5.BEAGLE_Phase.Imp.AFR <- rownames(Impute5.BEAGLE_Phase.Imp.AFR[!is.na(Impute5.BEAGLE_Phase.Imp.AFR$`0.95`),])
Impute5.BEAGLE_Phase.Imp.AFR

Minimac4.BEAGLE_Phase.Imp.AFR <- Minimac4.BEAGLE_Phase.Invs.AFR[Minimac4.BEAGLE_Phase.Invs.AFR$`0.95` >= 0.8,]
Minimac4.BEAGLE_Phase.Imp.AFR <- rownames(Minimac4.BEAGLE_Phase.Imp.AFR[!is.na(Minimac4.BEAGLE_Phase.Imp.AFR$`0.95`),])

ScoreInvHap.Invs.AFR$Inv <- rownames(ScoreInvHap.Invs.AFR)
ScoreInvHap.Imp.AFR <- ScoreInvHap.Invs.AFR[!is.na(ScoreInvHap.Invs.AFR$R2),]
ScoreInvHap.Imp.AFR <- rownames(ScoreInvHap.Imp.AFR[ScoreInvHap.Imp.AFR$R2 >= 0.8,])
ScoreInvHap.Imp.AFR



BEAGLE.BEAGLE_Phase.Imp.EUR <- BEAGLE.BEAGLE_Phase.Invs.EUR[BEAGLE.BEAGLE_Phase.Invs.EUR$`0.90` >= 0.8,]
BEAGLE.BEAGLE_Phase.Imp.EUR <- rownames(BEAGLE.BEAGLE_Phase.Imp.EUR[!is.na(BEAGLE.BEAGLE_Phase.Imp.EUR$`0.90`),])
BEAGLE.BEAGLE_Phase.Imp.EUR

Impute2.BEAGLE_Phase.Imp.EUR <- Impute2.BEAGLE_Phase.Invs.EUR[Impute2.BEAGLE_Phase.Invs.EUR$`0.90` >= 0.8,]
Impute2.BEAGLE_Phase.Imp.EUR <- rownames(Impute2.BEAGLE_Phase.Imp.EUR[!is.na(Impute2.BEAGLE_Phase.Imp.EUR$`0.90`),])
Impute2.BEAGLE_Phase.Imp.EUR

Impute5.BEAGLE_Phase.Imp.EUR <- Impute5.BEAGLE_Phase.Invs.EUR[Impute5.BEAGLE_Phase.Invs.EUR$`0.90` >= 0.8,]
Impute5.BEAGLE_Phase.Imp.EUR <- rownames(Impute5.BEAGLE_Phase.Imp.EUR[!is.na(Impute5.BEAGLE_Phase.Imp.EUR$`0.90`),])
Impute5.BEAGLE_Phase.Imp.EUR

Minimac4.BEAGLE_Phase.Imp.EUR <- Minimac4.BEAGLE_Phase.Invs.EUR[Minimac4.BEAGLE_Phase.Invs.EUR$`0.90` >= 0.8,]
Minimac4.BEAGLE_Phase.Imp.EUR <- rownames(Minimac4.BEAGLE_Phase.Imp.EUR[!is.na(Minimac4.BEAGLE_Phase.Imp.EUR$`0.90`),])
Minimac4.BEAGLE_Phase.Imp.EUR

ScoreInvHap.Invs.EUR$Inv <- rownames(ScoreInvHap.Invs.EUR)
ScoreInvHap.Imp.EUR <- ScoreInvHap.Invs.EUR[!is.na(ScoreInvHap.Invs.EUR$R2),]
ScoreInvHap.Imp.EUR <- rownames(ScoreInvHap.Imp.EUR[ScoreInvHap.Imp.EUR$R2 >= 0.8,])
ScoreInvHap.Imp.EUR



BEAGLE.BEAGLE_Phase.Imp.EAS <- BEAGLE.BEAGLE_Phase.Invs.EAS[BEAGLE.BEAGLE_Phase.Invs.EAS$`0.95` >= 0.8,]
BEAGLE.BEAGLE_Phase.Imp.EAS <- rownames(BEAGLE.BEAGLE_Phase.Imp.EAS[!is.na(BEAGLE.BEAGLE_Phase.Imp.EAS$`0.95`),])
BEAGLE.BEAGLE_Phase.Imp.EAS

Impute2.BEAGLE_Phase.Imp.EAS <- Impute2.BEAGLE_Phase.Invs.EAS[Impute2.BEAGLE_Phase.Invs.EAS$`0.95` >= 0.8,]
Impute2.BEAGLE_Phase.Imp.EAS <- rownames(Impute2.BEAGLE_Phase.Imp.EAS[!is.na(Impute2.BEAGLE_Phase.Imp.EAS$`0.95`),])
Impute2.BEAGLE_Phase.Imp.EAS

Impute5.BEAGLE_Phase.Imp.EAS <- Impute5.BEAGLE_Phase.Invs.EAS[Impute5.BEAGLE_Phase.Invs.EAS$`0.95` >= 0.8,]
Impute5.BEAGLE_Phase.Imp.EAS <- rownames(Impute5.BEAGLE_Phase.Imp.EAS[!is.na(Impute5.BEAGLE_Phase.Imp.EAS$`0.95`),])
Impute5.BEAGLE_Phase.Imp.EAS

Minimac4.BEAGLE_Phase.Imp.EAS <- Minimac4.BEAGLE_Phase.Invs.EAS[Minimac4.BEAGLE_Phase.Invs.EAS$`0.95` >= 0.8,]
Minimac4.BEAGLE_Phase.Imp.EAS <- rownames(Minimac4.BEAGLE_Phase.Imp.EAS[!is.na(Minimac4.BEAGLE_Phase.Imp.EAS$`0.95`),])
Minimac4.BEAGLE_Phase.Imp.EAS

ScoreInvHap.Invs.EAS$Inv <- rownames(ScoreInvHap.Invs.EAS)
ScoreInvHap.Imp.EAS <- ScoreInvHap.Invs.EAS[!is.na(ScoreInvHap.Invs.EAS$R2),]
ScoreInvHap.Imp.EAS <- rownames(ScoreInvHap.Imp.EAS[ScoreInvHap.Imp.EAS$R2 >= 0.8,])




rsIHA <- AFR_Info$V1[AFR_Info$V2 == "Polymorphic"]
rsIHE <- EUR_Info$V1[EUR_Info$V2 == "Polymorphic"]
rsIHS <- EAS_Info$V1[EAS_Info$V2 == "Polymorphic"]



Beagle.Invs.EUR.Filt <- BEAGLE.BEAGLE_Phase.Invs.EUR %>% rownames_to_column(var = "INV") %>%
          mutate(`0.00` = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.00"), `0.00`, NA),
                 `0.30` = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.30"), `0.30`, NA),
                 `0.50` = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.50"), `0.50`, NA),
                 `0.70` = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.70"), `0.70`, NA),
                 `0.80` = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.80"), `0.80`, NA),
                 `0.90` = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.90"), `0.90`, NA),
                 `0.95` = ifelse(INV %in%  check_loss("Beagle", "EUR", filter = "0.95"), `0.95`, NA)) %>%
  column_to_rownames(var = "INV")
Impute2.Invs.EUR.Filt <- Impute2.BEAGLE_Phase.Invs.EUR %>% rownames_to_column(var = "INV") %>%
          mutate(`0.00` = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.00"), `0.00`, NA),
                 `0.30` = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.30"), `0.30`, NA),
                 `0.50` = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.50"), `0.50`, NA),
                 `0.70` = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.70"), `0.70`, NA),
                 `0.80` = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.80"), `0.80`, NA),
                 `0.90` = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.90"), `0.90`, NA),
                 `0.95` = ifelse(INV %in%  check_loss("Impute2", "EUR", filter = "0.95"), `0.95`, NA)) %>%
  column_to_rownames(var = "INV")
Impute5.Invs.EUR.Filt <- Impute5.BEAGLE_Phase.Invs.EUR %>% rownames_to_column(var = "INV") %>%
          mutate(`0.00` = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.00"), `0.00`, NA),
                 `0.30` = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.30"), `0.30`, NA),
                 `0.50` = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.50"), `0.50`, NA),
                 `0.70` = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.70"), `0.70`, NA),
                 `0.80` = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.80"), `0.80`, NA),
                 `0.90` = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.90"), `0.90`, NA),
                 `0.95` = ifelse(INV %in%  check_loss("Impute5", "EUR", filter = "0.95"), `0.95`, NA)) %>%
  column_to_rownames(var = "INV")
Minimac4.Invs.EUR.Filt <- Minimac4.BEAGLE_Phase.Invs.EUR %>% rownames_to_column(var = "INV") %>%
          mutate(`0.00` = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.00"), `0.00`, NA),
                 `0.30` = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.30"), `0.30`, NA),
                 `0.50` = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.50"), `0.50`, NA),
                 `0.70` = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.70"), `0.70`, NA),
                 `0.80` = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.80"), `0.80`, NA),
                 `0.90` = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.90"), `0.90`, NA),
                 `0.95` = ifelse(INV %in%  check_loss("Minimac4", "EUR", filter = "0.95"), `0.95`, NA)) %>%
  column_to_rownames(var = "INV")


Beagle.Invs.AFR.Filt <- BEAGLE.BEAGLE_Phase.Invs.AFR %>% rownames_to_column(var = "INV") %>%
          mutate(`0.00` = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.00"), `0.00`, NA),
                 `0.30` = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.30"), `0.30`, NA),
                 `0.50` = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.50"), `0.50`, NA),
                 `0.70` = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.70"), `0.70`, NA),
                 `0.80` = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.80"), `0.80`, NA),
                 `0.90` = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.90"), `0.90`, NA),
                 `0.95` = ifelse(INV %in%  check_loss("Beagle", "AFR", filter = "0.95"), `0.95`, NA)) %>%
  column_to_rownames(var = "INV")
Impute2.Invs.AFR.Filt <- Impute2.BEAGLE_Phase.Invs.AFR %>% rownames_to_column(var = "INV") %>%
          mutate(`0.00` = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.00"), `0.00`, NA),
                 `0.30` = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.30"), `0.30`, NA),
                 `0.50` = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.50"), `0.50`, NA),
                 `0.70` = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.70"), `0.70`, NA),
                 `0.80` = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.80"), `0.80`, NA),
                 `0.90` = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.90"), `0.90`, NA),
                 `0.95` = ifelse(INV %in%  check_loss("Impute2", "AFR", filter = "0.95"), `0.95`, NA)) %>%
  column_to_rownames(var = "INV")
Impute5.Invs.AFR.Filt <- Impute5.BEAGLE_Phase.Invs.AFR %>% rownames_to_column(var = "INV") %>%
          mutate(`0.00` = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.00"), `0.00`, NA),
                 `0.30` = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.30"), `0.30`, NA),
                 `0.50` = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.50"), `0.50`, NA),
                 `0.70` = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.70"), `0.70`, NA),
                 `0.80` = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.80"), `0.80`, NA),
                 `0.90` = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.90"), `0.90`, NA),
                 `0.95` = ifelse(INV %in%  check_loss("Impute5", "AFR", filter = "0.95"), `0.95`, NA)) %>%
  column_to_rownames(var = "INV")
Minimac4.Invs.AFR.Filt <- Minimac4.BEAGLE_Phase.Invs.AFR %>% rownames_to_column(var = "INV") %>%
          mutate(`0.00` = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.00"), `0.00`, NA),
                 `0.30` = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.30"), `0.30`, NA),
                 `0.50` = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.50"), `0.50`, NA),
                 `0.70` = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.70"), `0.70`, NA),
                 `0.80` = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.80"), `0.80`, NA),
                 `0.90` = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.90"), `0.90`, NA),
                 `0.95` = ifelse(INV %in%  check_loss("Minimac4", "AFR", filter = "0.95"), `0.95`, NA)) %>%
  column_to_rownames(var = "INV")


Beagle.Invs.EAS.Filt <- BEAGLE.BEAGLE_Phase.Invs.EAS %>% rownames_to_column(var = "INV") %>%
          mutate(`0.00` = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.00"), `0.00`, NA),
                 `0.30` = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.30"), `0.30`, NA),
                 `0.50` = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.50"), `0.50`, NA),
                 `0.70` = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.70"), `0.70`, NA),
                 `0.80` = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.80"), `0.80`, NA),
                 `0.90` = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.90"), `0.90`, NA),
                 `0.95` = ifelse(INV %in%  check_loss("Beagle", "EAS", filter = "0.95"), `0.95`, NA)) %>%
  column_to_rownames(var = "INV")
Impute2.Invs.EAS.Filt <- Impute2.BEAGLE_Phase.Invs.EAS %>% rownames_to_column(var = "INV") %>%
          mutate(`0.00` = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.00"), `0.00`, NA),
                 `0.30` = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.30"), `0.30`, NA),
                 `0.50` = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.50"), `0.50`, NA),
                 `0.70` = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.70"), `0.70`, NA),
                 `0.80` = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.80"), `0.80`, NA),
                 `0.90` = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.90"), `0.90`, NA),
                 `0.95` = ifelse(INV %in%  check_loss("Impute2", "EAS", filter = "0.95"), `0.95`, NA)) %>%
  column_to_rownames(var = "INV")
Impute5.Invs.EAS.Filt <- Impute5.BEAGLE_Phase.Invs.EAS %>% rownames_to_column(var = "INV") %>%
          mutate(`0.00` = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.00"), `0.00`, NA),
                 `0.30` = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.30"), `0.30`, NA),
                 `0.50` = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.50"), `0.50`, NA),
                 `0.70` = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.70"), `0.70`, NA),
                 `0.80` = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.80"), `0.80`, NA),
                 `0.90` = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.90"), `0.90`, NA),
                 `0.95` = ifelse(INV %in%  check_loss("Impute5", "EAS", filter = "0.95"), `0.95`, NA)) %>%
  column_to_rownames(var = "INV")
Minimac4.Invs.EAS.Filt <- Minimac4.BEAGLE_Phase.Invs.EAS %>% rownames_to_column(var = "INV") %>%
          mutate(`0.00` = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.00"), `0.00`, NA),
                 `0.30` = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.30"), `0.30`, NA),
                 `0.50` = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.50"), `0.50`, NA),
                 `0.70` = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.70"), `0.70`, NA),
                 `0.80` = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.80"), `0.80`, NA),
                 `0.90` = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.90"), `0.90`, NA),
                 `0.95` = ifelse(INV %in%  check_loss("Minimac4", "EAS", filter = "0.95"), `0.95`, NA)) %>%
  column_to_rownames(var = "INV")
```

## EUR Filt
```{r}
set_size = function(w, h, factor=1.5) {
  s = 1 * factor
  options(
    repr.plot.width=w * s,
    repr.plot.height=h * s,
    repr.plot.res=100 / factor,
    jupyter.plot_mimetypes='image/png',
    jupyter.plot_scale=1
  )
}

UpEUR <- as.data.frame(rsIHE)
colnames(UpEUR) <- c("Inv")
rownames(UpEUR) <- UpEUR$Inv

UpEUR$BEAGLE <- sapply(UpEUR$Inv, function(x){
  if(!is.na(Beagle.Invs.EUR.Filt[x,"0.80"])){
    if(Beagle.Invs.EUR.Filt[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpEUR$IMPUTE2 <- sapply(UpEUR$Inv, function(x){
  if(!is.na(Impute2.Invs.EUR.Filt[x,"0.80"])){
    if(Impute2.Invs.EUR.Filt[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpEUR$IMPUTE5 <- sapply(UpEUR$Inv, function(x){
  if(!is.na(Impute5.Invs.EUR.Filt[x,"0.80"])){
    if(Impute5.Invs.EUR.Filt[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})



UpEUR$Minimac4 <- sapply(UpEUR$Inv, function(x){
  if(!is.na(Minimac4.Invs.EUR.Filt[x,"0.80"])){
    if(Minimac4.Invs.EUR.Filt[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})


UpEUR$scoreInvHap <- sapply(UpEUR$Inv, function(x){
  if(!is.na(ScoreInvHap.Invs.EUR[x,"R2"])){
    if(ScoreInvHap.Invs.EUR[x,"R2"] >= 0.8){
      1
    } else {0}
  } else {0}
})

softs = colnames(UpEUR)[2:length(colnames(UpEUR))]

png("../Results_Stats/UpSet_EURFilt.png", height =3000, width = 6000)
set_size(5, 3)
(upset(UpEUR, softs, name = "Software", sort_intersections=FALSE,
      base_annotations = list(
        'Intersection size' = intersection_size(mapping=aes(fill='bars_color'),
                                                text_colors=c(
                                                  on_background='black', on_bar='black'),
                                                text = list(size = 40)
                                                ) + 
          scale_fill_manual(values=c('bars_color'='#ff8b8baa'), guide='none') +
          ylab(substitute(paste("Imputable inversions (",italic("r\u00B2"),"  0.8)"))) +
          theme(axis.text = element_text(size = 120, color = "black"))
        ),
      matrix = intersection_matrix(geom = geom_point(size = 30),
                                   outline_color = list(active = "#4e8bff", inactive = "#4eb7ff")),
      #stripes = c("#F6F9FF", "#F6F9FF"),
      width_ratio = 0.2,
      set_sizes = (upset_set_size(geom = geom_bar(color = "#ff8b8baa", fill = "#ff8b8baa"))) +
        geom_text(aes(label=..count..), hjust=-0.4, stat='count', size = 40, color = "black") +
        ylim(45,0),
      intersections = list(c("Minimac4", "IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("Minimac4", "IMPUTE5", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5"),
                           c("Minimac4", "IMPUTE2"),
                           "IMPUTE2",
                           "IMPUTE5",
                           "scoreInvHap",
                           'Outside of known sets'),
      sort_sets = F,
      stripes = upset_stripes(geom = geom_blank()),
      themes = upset_modify_themes(
        list(
          'intersections_matrix' = theme(axis.text=element_text(size=130, color = "black")),
          'overall_sizes'=theme(#axis.text.x=element_text(angle=90),
            axis.title = element_text(size = 120))
        )
      )
                                   
      ) & 
    theme(plot.background=element_rect(fill='#F6F9FF', color = '#F6F9FF'),
          # text = element_text(size = 50),
          # axis.text = element_text(size = 60, color = "black"),
          axis.title = element_text(size = 120, color = "black"),
          line = element_line(colour = NULL))
  )

dev.off()


```


## EAS Filt
```{r}
set_size = function(w, h, factor=1.5) {
  s = 1 * factor
  options(
    repr.plot.width=w * s,
    repr.plot.height=h * s,
    repr.plot.res=100 / factor,
    jupyter.plot_mimetypes='image/png',
    jupyter.plot_scale=1
  )
}

UpEAS <- as.data.frame(rsIHE)
colnames(UpEAS) <- c("Inv")
rownames(UpEAS) <- UpEAS$Inv

UpEAS$BEAGLE <- sapply(UpEAS$Inv, function(x){
  if(!is.na(Beagle.Invs.EAS.Filt[x,"0.80"])){
    if(Beagle.Invs.EAS.Filt[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpEAS$IMPUTE2 <- sapply(UpEAS$Inv, function(x){
  if(!is.na(Impute2.Invs.EAS.Filt[x,"0.80"])){
    if(Impute2.Invs.EAS.Filt[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpEAS$IMPUTE5 <- sapply(UpEAS$Inv, function(x){
  if(!is.na(Impute5.Invs.EAS.Filt[x,"0.80"])){
    if(Impute5.Invs.EAS.Filt[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})



UpEAS$Minimac4 <- sapply(UpEAS$Inv, function(x){
  if(!is.na(Minimac4.Invs.EAS.Filt[x,"0.80"])){
    if(Minimac4.Invs.EAS.Filt[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})


UpEAS$scoreInvHap <- sapply(UpEAS$Inv, function(x){
  if(!is.na(ScoreInvHap.Invs.EAS[x,"R2"])){
    if(ScoreInvHap.Invs.EAS[x,"R2"] >= 0.8){
      1
    } else {0}
  } else {0}
})

softs = colnames(UpEAS)[2:length(colnames(UpEAS))]

png("../Results_Stats/UpSet_EASFilt.png", height =3000, width = 6000)
set_size(5, 3)
(upset(UpEAS, softs, name = "Software", sort_intersections=FALSE,
      base_annotations = list(
        'Intersection size' = intersection_size(mapping=aes(fill='bars_color'),
                                                text_colors=c(
                                                  on_background='black', on_bar='black'),
                                                text = list(size = 40)
                                                ) + 
          scale_fill_manual(values=c('bars_color'='#ff8b8baa'), guide='none') +
          ylab(substitute(paste("Imputable inversions (",italic("r\u00B2"),"  0.8)"))) +
          theme(axis.text = element_text(size = 120, color = "black"))
        ),
      matrix = intersection_matrix(geom = geom_point(size = 30),
                                   outline_color = list(active = "#4e8bff", inactive = "#4eb7ff")),
      #stripes = c("#F6F9FF", "#F6F9FF"),
      width_ratio = 0.2,
      set_sizes = (upset_set_size(geom = geom_bar(color = "#ff8b8baa", fill = "#ff8b8baa"))) +
        geom_text(aes(label=..count..), hjust=-0.4, stat='count', size = 40, color = "black") +
        ylim(45,0),
      intersections = list(c("Minimac4", "IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("Minimac4", "IMPUTE5", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5"),
                           c("Minimac4", "IMPUTE2"),
                           "IMPUTE2",
                           "IMPUTE5",
                           "scoreInvHap",
                           'Outside of known sets'),
      sort_sets = F,
      stripes = upset_stripes(geom = geom_blank()),
      themes = upset_modify_themes(
        list(
          'intersections_matrix' = theme(axis.text=element_text(size=130, color = "black")),
          'overall_sizes'=theme(#axis.text.x=element_text(angle=90),
            axis.title = element_text(size = 120))
        )
      )
                                   
      ) & 
    theme(plot.background=element_rect(fill='#F6F9FF', color = '#F6F9FF'),
          # text = element_text(size = 50),
          # axis.text = element_text(size = 60, color = "black"),
          axis.title = element_text(size = 120, color = "black"),
          line = element_line(colour = NULL))
  )

dev.off()


```

## AFR Filt
```{r}
set_size = function(w, h, factor=1.5) {
  s = 1 * factor
  options(
    repr.plot.width=w * s,
    repr.plot.height=h * s,
    repr.plot.res=100 / factor,
    jupyter.plot_mimetypes='image/png',
    jupyter.plot_scale=1
  )
}

UpAFR <- as.data.frame(rsIHE)
colnames(UpAFR) <- c("Inv")
rownames(UpAFR) <- UpAFR$Inv

UpAFR$BEAGLE <- sapply(UpAFR$Inv, function(x){
  if(!is.na(Beagle.Invs.AFR.Filt[x,"0.80"])){
    if(Beagle.Invs.AFR.Filt[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpAFR$IMPUTE2 <- sapply(UpAFR$Inv, function(x){
  if(!is.na(Impute2.Invs.AFR.Filt[x,"0.80"])){
    if(Impute2.Invs.AFR.Filt[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpAFR$IMPUTE5 <- sapply(UpAFR$Inv, function(x){
  if(!is.na(Impute5.Invs.AFR.Filt[x,"0.80"])){
    if(Impute5.Invs.AFR.Filt[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})



UpAFR$Minimac4 <- sapply(UpAFR$Inv, function(x){
  if(!is.na(Minimac4.Invs.AFR.Filt[x,"0.80"])){
    if(Minimac4.Invs.AFR.Filt[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})


UpAFR$scoreInvHap <- sapply(UpAFR$Inv, function(x){
  if(!is.na(ScoreInvHap.Invs.AFR[x,"R2"])){
    if(ScoreInvHap.Invs.AFR[x,"R2"] >= 0.8){
      1
    } else {0}
  } else {0}
})

softs = colnames(UpAFR)[2:length(colnames(UpAFR))]

png("../Results_Stats/UpSet_AFRFilt.png", height =3000, width = 6000)
set_size(5, 3)
(upset(UpAFR, softs, name = "Software", sort_intersections=FALSE,
      base_annotations = list(
        'Intersection size' = intersection_size(mapping=aes(fill='bars_color'),
                                                text_colors=c(
                                                  on_background='black', on_bar='black'),
                                                text = list(size = 40)
                                                ) + 
          scale_fill_manual(values=c('bars_color'='#ff8b8baa'), guide='none') +
          ylab(substitute(paste("Imputable inversions (",italic("r\u00B2"),"  0.8)"))) +
          theme(axis.text = element_text(size = 120, color = "black"))
        ),
      matrix = intersection_matrix(geom = geom_point(size = 30),
                                   outline_color = list(active = "#4e8bff", inactive = "#4eb7ff")),
      #stripes = c("#F6F9FF", "#F6F9FF"),
      width_ratio = 0.2,
      set_sizes = (upset_set_size(geom = geom_bar(color = "#ff8b8baa", fill = "#ff8b8baa"))) +
        geom_text(aes(label=..count..), hjust=-0.4, stat='count', size = 40, color = "black") +
        ylim(45,0),
      intersections = list(c("Minimac4", "IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("Minimac4", "IMPUTE5", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5"),
                           c("Minimac4", "IMPUTE2"),
                           "IMPUTE2",
                           "IMPUTE5",
                           "scoreInvHap",
                           'Outside of known sets'),
      sort_sets = F,
      stripes = upset_stripes(geom = geom_blank()),
      themes = upset_modify_themes(
        list(
          'intersections_matrix' = theme(axis.text=element_text(size=130, color = "black")),
          'overall_sizes'=theme(#axis.text.x=element_text(angle=90),
            axis.title = element_text(size = 120))
        )
      )
                                   
      ) & 
    theme(plot.background=element_rect(fill='#F6F9FF', color = '#F6F9FF'),
          # text = element_text(size = 50),
          # axis.text = element_text(size = 60, color = "black"),
          axis.title = element_text(size = 120, color = "black"),
          line = element_line(colour = NULL))
  )

dev.off()


```

## Now, plot upset plot

## EUR
```{r}
set_size = function(w, h, factor=1.5) {
  s = 1 * factor
  options(
    repr.plot.width=w * s,
    repr.plot.height=h * s,
    repr.plot.res=100 / factor,
    jupyter.plot_mimetypes='image/png',
    jupyter.plot_scale=1
  )
}

UpEUR <- as.data.frame(rsIHE)
colnames(UpEUR) <- c("Inv")
rownames(UpEUR) <- UpEUR$Inv

UpEUR$BEAGLE <- sapply(UpEUR$Inv, function(x){
  if(!is.na(BEAGLE.BEAGLE_Phase.Invs.EUR[x,"0.80"])){
    if(BEAGLE.BEAGLE_Phase.Invs.EUR[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpEUR$IMPUTE2 <- sapply(UpEUR$Inv, function(x){
  if(!is.na(Impute2.BEAGLE_Phase.Invs.EUR[x,"0.80"])){
    if(Impute2.BEAGLE_Phase.Invs.EUR[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpEUR$IMPUTE5 <- sapply(UpEUR$Inv, function(x){
  if(!is.na(Impute5.BEAGLE_Phase.Invs.EUR[x,"0.80"])){
    if(Impute5.BEAGLE_Phase.Invs.EUR[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})



UpEUR$Minimac4 <- sapply(UpEUR$Inv, function(x){
  if(!is.na(Minimac4.BEAGLE_Phase.Invs.EUR[x,"0.80"])){
    if(Minimac4.BEAGLE_Phase.Invs.EUR[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})


UpEUR$scoreInvHap <- sapply(UpEUR$Inv, function(x){
  if(!is.na(ScoreInvHap.Invs.EUR[x,"R2"])){
    if(ScoreInvHap.Invs.EUR[x,"R2"] >= 0.8){
      1
    } else {0}
  } else {0}
})

softs = colnames(UpEUR)[2:length(colnames(UpEUR))]

png("../Results_Stats/UpSet_EUR.0.80.W.png", height =3000, width = 6000)
set_size(5, 3)
(upset(UpEUR, softs, name = "Software", sort_intersections=FALSE,
      base_annotations = list(
        'Intersection size' = intersection_size(mapping=aes(fill='bars_color'),
                                                text_colors=c(
                                                  on_background='black', on_bar='black'),
                                                text = list(size = 40)
                                                ) + 
          scale_fill_manual(values=c('bars_color'='#ff8b8b'), guide='none') +
          ylab(substitute(paste("Imputable inversions (",italic("r\u00B2"),"  0.8)"))) +
          theme(axis.text = element_text(size = 120, color = "black"))
        ),
      matrix = intersection_matrix(geom = geom_point(size = 30),
                                   outline_color = list(active = "#4e8bff", inactive = "#4eb7ff")),
      #stripes = c("#F6F9FF", "#F6F9FF"),
      width_ratio = 0.2,
      set_sizes = (upset_set_size(geom = geom_bar(color = "#ff8b8b", fill = "#ff8b8b"))) +
        geom_text(aes(label=..count..), hjust=-0.4, stat='count', size = 40, color = "black") +
        ylim(45,0),
      intersections = list(c("Minimac4", "IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("Minimac4", "IMPUTE5", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5"),
                           c("scoreInvHap", "Minimac4", "BEAGLE"),
                           c("Minimac4", "IMPUTE2"),
                           "IMPUTE2",
                           "IMPUTE5",
                           'Outside of known sets'),
      sort_sets = F,
      stripes = upset_stripes(geom = geom_blank()),
      themes = upset_modify_themes(
        list(
          'intersections_matrix' = theme(axis.text=element_text(size=130, color = "black")),
          'overall_sizes'=theme(#axis.text.x=element_text(angle=90),
            axis.title = element_text(size = 120))
        )
      )
                                   
      ) & 
    theme(plot.background=element_rect(fill='#FFFFFF', color = '#FFFFFF'),
          # text = element_text(size = 50),
          # axis.text = element_text(size = 60, color = "black"),
          axis.title = element_text(size = 120, color = "black"),
          line = element_line(colour = NULL))
  )

dev.off()


```

### AFR
```{r}
BEAGLE.BEAGLE_Phase.Invs.AFR
set_size = function(w, h, factor=1.5) {
  s = 1 * factor
  options(
    repr.plot.width=w * s,
    repr.plot.height=h * s,
    repr.plot.res=100 / factor,
    jupyter.plot_mimetypes='image/png',
    jupyter.plot_scale=1
  )
}

UpAFR <- as.data.frame(rsIHA)
colnames(UpAFR) <- c("Inv")
rownames(UpAFR) <- UpAFR$Inv

UpAFR$BEAGLE <- sapply(UpAFR$Inv, function(x){
  if(!is.na(BEAGLE.BEAGLE_Phase.Invs.AFR[x,"0.80"])){
    if(BEAGLE.BEAGLE_Phase.Invs.AFR[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpAFR$IMPUTE2 <- sapply(UpAFR$Inv, function(x){
  if(!is.na(Impute2.BEAGLE_Phase.Invs.AFR[x,"0.80"])){
    if(Impute2.BEAGLE_Phase.Invs.AFR[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpAFR$IMPUTE5 <- sapply(UpAFR$Inv, function(x){
  if(!is.na(Impute5.BEAGLE_Phase.Invs.AFR[x,"0.80"])){
    if(Impute5.BEAGLE_Phase.Invs.AFR[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})



UpAFR$Minimac4 <- sapply(UpAFR$Inv, function(x){
  if(!is.na(Minimac4.BEAGLE_Phase.Invs.AFR[x,"0.80"])){
    if(Minimac4.BEAGLE_Phase.Invs.AFR[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})


UpAFR$scoreInvHap <- sapply(UpAFR$Inv, function(x){
  if(!is.na(ScoreInvHap.Invs.AFR[x,"R2"])){
    if(ScoreInvHap.Invs.AFR[x,"R2"] >= 0.8){
      1
    } else {0}
  } else {0}
})

softs = colnames(UpAFR)[2:length(colnames(UpAFR))]

png("../Results_Stats/UpSet2_AFR.0.80.W.png", height =3000, width = 6000)
set_size(5, 3)
(upset(UpAFR, softs, name = "Software", sort_intersections=FALSE,
      base_annotations = list(
        'Intersection size' = intersection_size(mapping=aes(fill='bars_color'),
                                                text_colors=c(
                                                  on_background='black', on_bar='black'),
                                                text = list(size = 40)
                                                ) + 
          scale_fill_manual(values=c('bars_color'='#4e8bff'), guide='none') +
          scale_y_continuous(breaks = c(0,5,10), labels = c(0,5,10)) +
          ylab(substitute(paste("Imputable inversions (",italic("r\u00B2"),"  0.8)"))) +
          theme(axis.text = element_text(size = 120, color = "black"))
        ),
      matrix = intersection_matrix(geom = geom_point(size = 30),
                                   outline_color = list(active = "#4e8bff", inactive = "#4eb7ff")),
      #stripes = c("#F6F9FF", "#F6F9FF"),
      width_ratio = 0.2,
      set_sizes = (upset_set_size(geom = geom_bar(color = "#4e8bff", fill = "#4e8bff"))) +
        geom_text(aes(label=..count..), hjust=-0.4, stat='count', size = 40, color = "black") +
        ylim(45,0),
      intersections = list(c("Minimac4", "IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("Minimac4", "IMPUTE5", "IMPUTE2"),
                           "scoreInvHap",
                           c("IMPUTE5", "IMPUTE2", "BEAGLE", "Minimac4","scoreInvHap"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("Minimac4", "IMPUTE2", "BEAGLE"),
                           "IMPUTE2",
                           c("scoreInvHap", "Minimac4", "IMPUTE2", "BEAGLE"),
                           c("scoreInvHap", "IMPUTE2", "BEAGLE"),
                           c("scoreInvHap", "IMPUTE2"),
                           c("Minimac4", "IMPUTE5"),
                           c("Minimac4", "IMPUTE2"),
                           "Minimac4",
                           "IMPUTE5",
                           'Outside of known sets'),
      sort_sets = F,
      stripes = upset_stripes(geom = geom_blank()),
      themes = upset_modify_themes(
        list(
          'intersections_matrix' = theme(axis.text=element_text(size=130, color = "black")),
          'overall_sizes'=theme(#axis.text.x=element_text(angle=90),
            axis.title = element_text(size = 120))
        )
      )
                                   
      ) & 
    theme(plot.background=element_rect(fill='#FFFFFF', color = '#FFFFFF'),
          # text = element_text(size = 50),
          # axis.text = element_text(size = 60, color = "black"),
          axis.title = element_text(size = 120, color = "black"),
          line = element_line(colour = NULL))
  )

dev.off()
```

### EAS
```{r}
set_size = function(w, h, factor=1.5) {
  s = 1 * factor
  options(
    repr.plot.width=w * s,
    repr.plot.height=h * s,
    repr.plot.res=100 / factor,
    jupyter.plot_mimetypes='image/png',
    jupyter.plot_scale=1
  )
}

UpEAS <- as.data.frame(rsIHS)
colnames(UpEAS) <- c("Inv")
rownames(UpEAS) <- UpEAS$Inv

UpEAS$BEAGLE <- sapply(UpEAS$Inv, function(x){
  if(!is.na(BEAGLE.BEAGLE_Phase.Invs.EAS[x,"0.80"])){
    if(BEAGLE.BEAGLE_Phase.Invs.EAS[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpEAS$IMPUTE2 <- sapply(UpEAS$Inv, function(x){
  if(!is.na(Impute2.BEAGLE_Phase.Invs.EAS[x,"0.80"])){
    if(Impute2.BEAGLE_Phase.Invs.EAS[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpEAS$IMPUTE5 <- sapply(UpEAS$Inv, function(x){
  if(!is.na(Impute5.BEAGLE_Phase.Invs.EAS[x,"0.80"])){
    if(Impute5.BEAGLE_Phase.Invs.EAS[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpEAS$Minimac4 <- sapply(UpEAS$Inv, function(x){
  if(!is.na(Minimac4.BEAGLE_Phase.Invs.EAS[x,"0.80"])){
    if(Minimac4.BEAGLE_Phase.Invs.EAS[x,"0.80"] >= 0.8){
      1
    } else {0}
  } else {0}
})


UpEAS$scoreInvHap <- sapply(UpEAS$Inv, function(x){
  if(!is.na(ScoreInvHap.Invs.EAS[x,"R2"])){
    if(ScoreInvHap.Invs.EAS[x,"R2"] >= 0.8){
      1
    } else {0}
  } else {0}
})

softs = colnames(UpEAS)[2:length(colnames(UpEAS))]

png("../Results_Stats/UpSet2_EAS.0.80.W.png", height =3000, width = 6000)
set_size(5, 3)
(upset(UpEAS, softs, name = "Software", sort_intersections=FALSE,
      base_annotations = list(
        'Intersection size' = intersection_size(mapping=aes(fill='bars_color'),
                                                text_colors=c(
                                                  on_background='black', on_bar='black'),
                                                text = list(size = 40)
                                                ) + 
          scale_fill_manual(values=c('bars_color'='#00BA38'), guide='none') +
          ylab(substitute(paste("Imputable inversions (",italic("r\u00B2"),"  0.8)"))) +
          theme(axis.text = element_text(size = 120, color = "black"))
        ),
      matrix = intersection_matrix(geom = geom_point(size = 30),
                                   outline_color = list(active = "#4e8bff", inactive = "#4eb7ff")),
      #stripes = c("#F6F9FF", "#F6F9FF"),
      width_ratio = 0.2,
      set_sizes = (upset_set_size(geom = geom_bar(color = "#00BA38", fill = "#00BA38"))) +
        geom_text(aes(label=..count..), hjust=-0.4, stat='count', size = 40, color = "black") +
        ylim(45,0),
      intersections = list(c("Minimac4", "IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("IMPUTE5", "IMPUTE2", "BEAGLE", "Minimac4","scoreInvHap"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("Minimac4", "IMPUTE5"),
                           "IMPUTE2",
                           "BEAGLE",
                           "scoreInvHap",
                           'Outside of known sets'),
      sort_sets = F,
      stripes = upset_stripes(geom = geom_blank()),
      themes = upset_modify_themes(
        list(
          'intersections_matrix' = theme(axis.text=element_text(size=130, color = "black")),
          'overall_sizes'=theme(#axis.text.x=element_text(angle=90),
            axis.title = element_text(size = 120))
        )
      )
                                   
      ) & 
    theme(plot.background=element_rect(fill='#FFFFFF', color = '#FFFFFF'),
          # text = element_text(size = 50),
          # axis.text = element_text(size = 60, color = "black"),
          axis.title = element_text(size = 120, color = "black"),
          line = element_line(colour = NULL))
  )

dev.off()
```

### Raincloud plot

```{r}
### Violin plots

VioEUR <- as.data.frame(matrix(nrow = 0, ncol = 2))
VioAFR <- as.data.frame(matrix(nrow = 0, ncol = 2))
VioEAS <- as.data.frame(matrix(nrow = 0, ncol = 2))

## EUR

VioEUR <- rbind(VioEUR, matrix(c(BEAGLE.BEAGLE_Phase.Invs.EUR[!is.na(BEAGLE.BEAGLE_Phase.Invs.EUR$`0.80`),"0.80"],
              rep("BEAGLE", length(BEAGLE.BEAGLE_Phase.Invs.EUR[!is.na(BEAGLE.BEAGLE_Phase.Invs.EUR$`0.80`),"0.80"]))),ncol = 2))

VioEUR <- rbind(VioEUR, matrix(c(Impute2.BEAGLE_Phase.Invs.EUR[!is.na(Impute2.BEAGLE_Phase.Invs.EUR$`0.80`),"0.80"],
                                 rep("IMPUTE2", length(Impute2.BEAGLE_Phase.Invs.EUR[!is.na(Impute2.BEAGLE_Phase.Invs.EUR$`0.80`),"0.80"]))),
                               ncol = 2))

VioEUR <- rbind(VioEUR, matrix(c(Impute5.BEAGLE_Phase.Invs.EUR[!is.na(Impute5.BEAGLE_Phase.Invs.EUR$`0.80`),"0.80"],
                                 rep("IMPUTE5", length(Impute5.BEAGLE_Phase.Invs.EUR[!is.na(Impute5.BEAGLE_Phase.Invs.EUR$`0.80`),"0.80"]))),
                               ncol = 2))

VioEUR <- rbind(VioEUR, matrix(c(Minimac4.BEAGLE_Phase.Invs.EUR[!is.na(Minimac4.BEAGLE_Phase.Invs.EUR$`0.80`),"0.80"],
                                 rep("Minimac4", length(Minimac4.BEAGLE_Phase.Invs.EUR[!is.na(Minimac4.BEAGLE_Phase.Invs.EUR$`0.80`),"0.80"]))),
                               ncol = 2))


VioEUR <- rbind(VioEUR, matrix(c(ScoreInvHap.Invs.EUR[!is.na(ScoreInvHap.Invs.EUR$R2),"R2"],
                                 rep("scoreInvHap", length(ScoreInvHap.Invs.EUR[!is.na(ScoreInvHap.Invs.EUR$R2),"R2"]))),
                               ncol = 2))

VioEUR$Pop <- rep("EUR", dim(VioEUR)[1])


## AFR

VioAFR <- rbind(VioAFR, matrix(c(BEAGLE.BEAGLE_Phase.Invs.AFR[!is.na(BEAGLE.BEAGLE_Phase.Invs.AFR$`0.80`),"0.80"],
              rep("BEAGLE", length(BEAGLE.BEAGLE_Phase.Invs.AFR[!is.na(BEAGLE.BEAGLE_Phase.Invs.AFR$`0.80`),"0.80"]))),ncol = 2))

VioAFR <- rbind(VioAFR, matrix(c(Impute2.BEAGLE_Phase.Invs.AFR[!is.na(Impute2.BEAGLE_Phase.Invs.AFR$`0.80`),"0.80"],
                                 rep("IMPUTE2", length(Impute2.BEAGLE_Phase.Invs.AFR[!is.na(Impute2.BEAGLE_Phase.Invs.AFR$`0.80`),"0.80"]))),
                               ncol = 2))

VioAFR <- rbind(VioAFR, matrix(c(Impute5.BEAGLE_Phase.Invs.AFR[!is.na(Impute5.BEAGLE_Phase.Invs.AFR$`0.80`),"0.80"],
                                 rep("IMPUTE5", length(Impute5.BEAGLE_Phase.Invs.AFR[!is.na(Impute5.BEAGLE_Phase.Invs.AFR$`0.80`),"0.80"]))),
                               ncol = 2))

VioAFR <- rbind(VioAFR, matrix(c(Minimac4.BEAGLE_Phase.Invs.AFR[!is.na(Minimac4.BEAGLE_Phase.Invs.AFR$`0.80`),"0.80"],
                                 rep("Minimac4", length(Minimac4.BEAGLE_Phase.Invs.AFR[!is.na(Minimac4.BEAGLE_Phase.Invs.AFR$`0.80`),"0.80"]))),
                               ncol = 2))


VioAFR <- rbind(VioAFR, matrix(c(ScoreInvHap.Invs.AFR[!is.na(ScoreInvHap.Invs.AFR$R2),"R2"],
                                 rep("scoreInvHap", length(ScoreInvHap.Invs.AFR[!is.na(ScoreInvHap.Invs.AFR$R2),"R2"]))),
                               ncol = 2))

VioAFR$Pop <- rep("AFR", dim(VioAFR)[1])

## EAS

VioEAS <- rbind(VioEAS, matrix(c(BEAGLE.BEAGLE_Phase.Invs.EAS[!is.na(BEAGLE.BEAGLE_Phase.Invs.EAS$`0.80`),"0.80"],
              rep("BEAGLE", length(BEAGLE.BEAGLE_Phase.Invs.EAS[!is.na(BEAGLE.BEAGLE_Phase.Invs.EAS$`0.80`),"0.80"]))),ncol = 2))

VioEAS <- rbind(VioEAS, matrix(c(Impute2.BEAGLE_Phase.Invs.EAS[!is.na(Impute2.BEAGLE_Phase.Invs.EAS$`0.80`),"0.80"],
                                 rep("IMPUTE2", length(Impute2.BEAGLE_Phase.Invs.EAS[!is.na(Impute2.BEAGLE_Phase.Invs.EAS$`0.80`),"0.80"]))),
                               ncol = 2))

VioEAS <- rbind(VioEAS, matrix(c(Impute5.BEAGLE_Phase.Invs.EAS[!is.na(Impute5.BEAGLE_Phase.Invs.EAS$`0.80`),"0.80"],
                                 rep("IMPUTE5", length(Impute5.BEAGLE_Phase.Invs.EAS[!is.na(Impute5.BEAGLE_Phase.Invs.EAS$`0.80`),"0.80"]))),
                               ncol = 2))

VioEAS <- rbind(VioEAS, matrix(c(Minimac4.BEAGLE_Phase.Invs.EAS[!is.na(Minimac4.BEAGLE_Phase.Invs.EAS$`0.80`),"0.80"],
                                 rep("Minimac4", length(Minimac4.BEAGLE_Phase.Invs.EAS[!is.na(Minimac4.BEAGLE_Phase.Invs.EAS$`0.80`),"0.80"]))),
                               ncol = 2))


VioEAS <- rbind(VioEAS, matrix(c(ScoreInvHap.Invs.EAS[!is.na(ScoreInvHap.Invs.EAS$R2),"R2"],
                                 rep("scoreInvHap", length(ScoreInvHap.Invs.EAS[!is.na(ScoreInvHap.Invs.EAS$R2),"R2"]))),
                               ncol = 2))

VioEAS$Pop <- rep("EAS", dim(VioEAS)[1])


JVio <- rbind(VioEUR, VioAFR, VioEAS)
colnames(JVio) <- c("R2", "Soft", "Pop")
JVio$R2 <- as.numeric(JVio$R2)
JVio$Soft <- as.factor(JVio$Soft)

## Plot
```
```{r}
png("../Results_Stats/RainPlotH.0.80.png", height =3200, width = 1300)
ggplot(JVio, aes(x = "", y = R2, fill = Pop)) +
  introdataviz::geom_flat_violin(trim=FALSE, alpha = 0.55, position = position_nudge(x = .1+.05)) +
  geom_point(aes(colour = Pop), size = 8, alpha = .5, show.legend = FALSE, 
             position = position_jitter(width = 0.1, height = 0)) +
  geom_boxplot(width = .1, alpha = 0.4, show.legend = FALSE, outlier.shape = NA,
               position = position_nudge(x = -.1*2)) +
  stat_summary(fun.data = mean_cl_normal, mapping = aes(color = Pop), show.legend = FALSE,
               position = position_nudge(x = .1 * 3), size = 1.8) +
  scale_x_discrete(name = "", expand = c(.1*3, 0, 0, 0.7)) +
  scale_y_continuous(name = substitute(paste(italic("r\u00B2"))), breaks = seq(0, 1, 0.1), 
                     limits = c(0, 1)) +
  coord_flip() +
  facet_wrap(~factor(Soft, levels = c("BEAGLE", "IMPUTE2", "IMPUTE5", "Minimac4", "scoreInvHap"),
                     labels = c("BEAGLE", "IMPUTE2", "IMPUTE5", "Minimac4", "scoreInvHap")), nrow = 5) +
  #scale_fill_brewer(palette = "Dark2", name = "Population") +
  #scale_colour_brewer(palette = "Dark2") +
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(), legend.position = c(0.15, 0.78),
        legend.background = element_rect(fill = "#FFFFFF", color = "#FFFFFF"),
        legend.title = element_text("Population", size = 40),
        legend.text = element_text(size = 40), legend.key.size = unit(2.3, "cm"),
        strip.text = element_text(size=75), plot.background = element_rect(fill = "#FFFFFF", color = "#FFFFFF"),
        panel.grid.major = element_line(size = 0.4, linetype = 'solid', colour = "white"),
        panel.grid.minor = element_blank(), axis.text=element_text(size=40, color="black"),
        axis.title = element_text(size = 60)) +
        scale_fill_viridis_d(name = "Population") + 
        scale_color_viridis_d() +
#  scale_color_manual(values=c("#F8766D","#00BA38", "#619CFF")) +
#  scale_fill_manual(values=c("#F8766D","#00BA38", "#619CFF")) +
  labs(fill = "Population")
dev.off()
```

```{r}
Minimac4.violin.EUR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean")
colnames(Minimac4.violin.EUR) <- c("INV", "0.00", "0.30", "0.50", "0.70", "0.80", "0.90", "0.95")
Minimac4.violin.AFR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean")
colnames(Minimac4.violin.AFR) <- c("INV","0.00", "0.30","0.50", "0.70", "0.80", "0.90", "0.95")
Minimac4.violin.EAS <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean")
colnames(Minimac4.violin.EAS) <- c("INV","0.00", "0.30","0.50", "0.70", "0.80", "0.90", "0.95")
```

```{r}
Minimac4.violin.joint <- cbind(Minimac4.violin.EUR[c(1,7)],Minimac4.violin.AFR[7],Minimac4.violin.EAS[7])
colnames(Minimac4.violin.joint) <- c("INV","EUR","AFR","EAS")
Minimac4.violin.joint <- melt(Minimac4.violin.joint, id.vars = "INV")


Minimac4.violin.joint.low <- Minimac4.violin.joint[Minimac4.violin.joint$INV %in% GroupedInv.Data.IndvsPerPop[GroupedInv.Data.IndvsPerPop$Group == "Low",]$INV,]


Minimac4.violin.joint.medium <- Minimac4.violin.joint[Minimac4.violin.joint$INV %in% GroupedInv.Data.IndvsPerPop[GroupedInv.Data.IndvsPerPop$Group == "Medium",]$INV,]


Minimac4.violin.joint.high <- Minimac4.violin.joint[Minimac4.violin.joint$INV %in% GroupedInv.Data.IndvsPerPop[GroupedInv.Data.IndvsPerPop$Group == "High",]$INV,]
```

```{r}
ggbetweenstats(Minimac4.violin.joint, x = variable, y = value, pairwise.display = "all", type = "np")
```
```{r}
ggwithinstats(Minimac4.violin.joint.low, x = variable, y = value, pairwise.display = "all", type = "np")
```

```{r}
ggwithinstats(Minimac4.violin.joint.medium, x = variable, y = value, pairwise.display = "all", type = "np")
```

```{r}
ggwithinstats(Minimac4.violin.joint.high, x = variable, y = value, type = "np", pairwise.display = "all")
```

```{r}
Inv.Groups <- GroupedInv.Data.IndvsPerPop %>% distinct(INV, Group)

Minimac4.violin.AFR.full <- merge(Minimac4.violin.AFR[c(1,7)], Inv.Groups, by = "INV")
Minimac4.violin.EUR.full <- merge(Minimac4.violin.EUR[c(1,7)], Inv.Groups, by = "INV")
Minimac4.violin.EAS.full <- merge(Minimac4.violin.EAS[c(1,7)], Inv.Groups, by = "INV")
```

```{r}
Violin.EUR.full <- sel_df(Imputation.Info, condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean", imputability = "0.90")
Violin.EUR.full <- melt(Violin.EUR.full, id.vars = "INV")
Violin.EUR.full <- merge(Violin.EUR.full, Inv.Groups, by = "INV")
ggbetweenstats(data = Violin.EUR.full, x = Group, y = value, type = "np", pairwise.display = "all")

Violin.AFR.full <- sel_df(Imputation.Info, condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean", imputability = "0.90")
Violin.AFR.full <- melt(Violin.AFR.full, id.vars = "INV")
Violin.AFR.full <- merge(Violin.AFR.full, Inv.Groups, by = "INV")
ggbetweenstats(data = Violin.AFR.full, x = Group, y = value, type = "np", pairwise.display = "all", results.subtitle = FALSE) +
  labs(title = "Inversion imputability distribution per inversion group", subtitle = "All methods considered, AFR superpopulation", y = expression("Imputability ("~r^2~")"), x = "Inversion Group") + 
  theme()

Violin.EAS.full <- sel_df(Imputation.Info, condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean", imputability = "0.90")
Violin.EAS.full <- melt(Violin.EAS.full, id.vars = "INV")
Violin.EAS.full <- merge(Violin.EAS.full, Inv.Groups, by = "INV")
ggbetweenstats(data = Violin.EAS.full, x = Group, y = value, type = "np", pairwise.display = "all")
```



```{r}
ggbetweenstats(data = Minimac4.violin.AFR.full, x = Group, y = `0.90`, type = "np", pairwise.display = "all")
ggbetweenstats(data = Minimac4.violin.EUR.full, x = Group, y = `0.90`, type = "np", pairwise.display = "all")
ggbetweenstats(data = Minimac4.violin.EAS.full, x = Group, y = `0.90`, type = "np", pairwise.display = "all")
```



```{r}
ggbetweenstats(data = Minimac4.violin.AFR.full, x = Group, y = `0.90`, type = "p", pairwise.display = "all")
ggbetweenstats(data = Minimac4.violin.EUR.full, x = Group, y = `0.90`, type = "p", pairwise.display = "all")
ggbetweenstats(data = Minimac4.violin.EAS.full, x = Group, y = `0.90`, type = "p", pairwise.display = "all")
```

```{r}
Impute2.violin.EUR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean")
colnames(Impute2.violin.EUR) <- c("INV","0.00","0.30","0.50", "0.70", "0.80", "0.90", "0.95")
Impute2.violin.AFR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean")
colnames(Impute2.violin.AFR) <- c("INV","0.00","0.30","0.50", "0.70", "0.80", "0.90", "0.95")
Impute2.violin.EAS <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean")
colnames(Impute2.violin.EAS) <- c("INV","0.00","0.30","0.50", "0.70", "0.80", "0.90", "0.95")
Impute2.violin.joint <- cbind(Impute2.violin.EUR[c(1,7)],Impute2.violin.AFR[7],Impute2.violin.EAS[7])
colnames(Impute2.violin.joint) <- c("INV","EUR","AFR","EAS")
Impute2.violin.joint <- melt(Impute2.violin.joint, id.vars = "INV")



Impute2.violin.joint.low <- Impute2.violin.joint[Impute2.violin.joint$INV %in% GroupedInv.Data.IndvsPerPop[GroupedInv.Data.IndvsPerPop$Group == "Low",]$INV,]
Impute2.violin.joint.low
Impute2.violin.joint.low; GroupedInv.Data.IndvsPerPop[GroupedInv.Data.IndvsPerPop$Group == "Low",]


Impute2.violin.joint.medium <- Impute2.violin.joint[Impute2.violin.joint$INV %in% GroupedInv.Data.IndvsPerPop[GroupedInv.Data.IndvsPerPop$Group == "Medium",]$INV,]
Impute2.violin.joint.medium
Impute2.violin.joint.medium; GroupedInv.Data.IndvsPerPop[GroupedInv.Data.IndvsPerPop$Group == "Medium",]


Impute2.violin.joint.high <- Impute2.violin.joint[Impute2.violin.joint$INV %in% GroupedInv.Data.IndvsPerPop[GroupedInv.Data.IndvsPerPop$Group == "High",]$INV,]
Impute2.violin.joint.high
Impute2.violin.joint.high; GroupedInv.Data.IndvsPerPop[GroupedInv.Data.IndvsPerPop$Group == "High",]
```


```{r}
ggwithinstats(Impute2.violin.joint, x = variable, y = value, pairwise.display = "all", type = "np")
```
```{r}
ggwithinstats(Impute2.violin.joint.low, x = variable, y = value, pairwise.display = "all", type = "np")
```
```{r}
ggwithinstats(Impute2.violin.joint.medium, x = variable, y = value, pairwise.display = "all", type = "np")
```

```{r}
ggwithinstats(Impute2.violin.joint.high, x = variable, y = value, type = "np", pairwise.display = "all")
```

```{r}
Impute2.violin.AFR.full <- merge(Impute2.violin.AFR[c(1,7)], Inv.Groups, by = "INV")
Impute2.violin.EUR.full <- merge(Impute2.violin.EUR[c(1,7)], Inv.Groups, by = "INV")
Impute2.violin.EAS.full <- merge(Impute2.violin.EAS[c(1,7)], Inv.Groups, by = "INV")
```
```{r}
ggbetweenstats(data = Impute2.violin.AFR.full, x = Group, y = `0.90`, type = "np", pairwise.display = "all")
ggbetweenstats(data = Impute2.violin.EUR.full, x = Group, y = `0.90`, type = "np", pairwise.display = "all")
ggbetweenstats(data = Impute2.violin.EAS.full, x = Group, y = `0.90`, type = "np", pairwise.display = "all")
```



```{r}
ggbetweenstats(data = Impute2.violin.AFR.full, x = Group, y = `0.90`, type = "p", pairwise.display = "all")
ggbetweenstats(data = Impute2.violin.EUR.full, x = Group, y = `0.90`, type = "p", pairwise.display = "all")
ggbetweenstats(data = Impute2.violin.EAS.full, x = Group, y = `0.90`, type = "p", pairwise.display = "all")
```


## Check best method for each inversion

## AFR
```{r, warning=FALSE}
I2.A <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean.Impute2.BEAGLE_Phase.0.80.AFR")
I5.A <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean.Impute5.BEAGLE_Phase.0.80.AFR")
B.A <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean.Beagle.BEAGLE_Phase.0.80.AFR")
M4.A <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "AFR", filter = "Mean.Minimac4.BEAGLE_Phase.0.80.AFR")
sIH.A <- sel_df(Imputation.Info, imp_method = "ScoreInvHap",pop = "AFR", filter = "Mean")


Total.A <- cbind(B.A, I2.A[2], I5.A[2], M4.A[2], sIH.A[2])
colnames(Total.A) <- c("INV", "Beagle", "Impute2", "Impute5", "Minimac4", "ScoreInvHap")

Total.A.Plot <- Total.A %>% rowwise() %>% mutate(Max = max(c_across(c("Beagle", "Impute2", "Impute5", "Minimac4", "ScoreInvHap")),na.rm = TRUE))
Total.A.Plot <- Total.A.Plot %>% arrange(desc(Max))
Total.A.Plot$INV <- factor(Total.A.Plot$INV, levels = Total.A.Plot$INV)
Total.A.Plot <- Total.A.Plot  %>% pivot_longer(cols = c("Beagle", "Impute2", "Impute5", "Minimac4", "ScoreInvHap"), names_to = "Impute.Method", values_to = "R2")
Total.A.Plot <- Total.A.Plot %>% 
  mutate(is_max = R2 == Max)
Total.A.Plot$is_max <- as.factor(Total.A.Plot$is_max)


Total.A <- melt(Total.A, id.vars = "INV")
max_vals <- Total.A %>% group_by(INV,) %>% dplyr::summarise(max = max(value, na.rm = TRUE)) %>% ungroup()
Total.A <- Total.A %>%
  left_join(max_vals, by = c("INV")) %>%
  mutate(is_max = value == max)
Total.A$INV <- as.factor(Total.A$INV)
Total.A$is_max <- as.factor(Total.A$is_max)
order <- c("Beagle", "Impute2", "Impute5", "Minimac4", "ScoreInvHap")
Total.A <- Total.A %>% mutate(variable = factor(variable, levels = order))



priority_order <- c("Minimac4", "Impute2", "Impute5", "ScoreInvHap", "Beagle")
get_best_method <- function(data) {
  data %>%
    mutate(method_rank = match(Impute.Method, priority_order)) %>%
    filter(is_max) %>%
    arrange(method_rank) %>%
    slice(1) %>%
    select(Impute.Method, is_max)
}
# Total.A.Plot$is_max <- as.logical(Total.A.Plot$is_max)
get_best_methods <- function(data) {
  # Filter rows with max = TRUE
  max_true <- filter(data, is_max == TRUE)
  # Determine the best method among the filtered rows
  sorted_methods <- max_true %>%
    arrange(match(Impute.Method, priority_order))
  best_methods <- sorted_methods$Impute.Method
  return(best_methods)
}

best_methods.A <- Total.A.Plot %>%
  group_by(INV) %>%
  summarise(best_methodss = list(get_best_methods(cur_data())))

best_methods.A <- best_methods.A %>%
  mutate(best = sapply(best_methods.A$best_methodss, function(x) x[1]),
         second_best = sapply(best_methods.A$best_methodss, function(x) ifelse(length(x) >= 2, x[2], NA)),
         third_best = sapply(best_methods.A$best_methodss, function(x) ifelse(length(x) >= 3, x[3], NA)),
         fourth_best = sapply(best_methods.A$best_methodss, function(x) ifelse(length(x) >= 4, x[4], NA)),
         fifth_best = sapply(best_methods.A$best_methodss, function(x) ifelse(length(x) >= 5, x[5], NA)))

# best_methods.A <- best_methods.A %>%
#   group_by(inversion_name) %>%
#   mutate(second_best = ifelse(length(best_methods.A) >= 2, best_methods.A[2], NA),
#          third_best = ifelse(length(best_methods.A) >= 3, best_methods.A[3], NA)) %>%
#   slice(1) %>%
#   select(inversion_name, best_methods.A, second_best, third_best)

## View the result
print(best_methods.A)

## Get the number of best performances per Inversion Method
sum(sapply(best_methods.A[-c(1,2)], function(col) sum(col == "Beagle", na.rm = TRUE)))
sum(sapply(best_methods.A[-c(1,2)], function(col) sum(col == "Impute2", na.rm = TRUE)))
sum(sapply(best_methods.A[-c(1,2)], function(col) sum(col == "Impute5", na.rm = TRUE)))
sum(sapply(best_methods.A[-c(1,2)], function(col) sum(col == "Minimac4", na.rm = TRUE)))
sum(sapply(best_methods.A[-c(1,2)], function(col) sum(col == "ScoreInvHap", na.rm = TRUE)))
```

```{r, fig.height=15, warning=FALSE}
line.data <- data.frame(yintercept = c(0.80), Lines = c("Imputability threshold (>0.80)"))
p <- ggplot(data = Total.A, 
            aes(x = INV, y = value, fill = variable, 
                color = is_max, 
                group = variable,
                size = is_max)) + 
  geom_bar(stat = "identity", position = position_dodge2(width = 0.9, padding = 0.2)) + 
  geom_hline(aes(yintercept = yintercept, linetype = Lines, color = "gray30"), line.data) +
  scale_fill_brewer(palette = "Set3", name = "Imputation Method") +
  scale_color_manual(values = c('TRUE' = 'black', 'FALSE' = NA), name = c(), labels = c("Best Method"), breaks = c("TRUE")) +
  scale_size_manual(values = c('TRUE' = 1, 'FALSE' = 0)) +
  scale_linetype_manual(values = c("Imputability threshold (>0.80)" = "dashed"), name = c()) +
  facet_wrap(~ INV, ncol = 5, scales = "free_x") +
  labs(y = expression("Imputability"~r^2), title = "Imputation Method Comparison per Inversion in AFR Population") + 
  theme_minimal() +
  theme(
    strip.background = element_rect(fill = "lightblue"),
    strip.text = element_text(color = "darkblue", face = "bold", size = 12),
    strip.text.x.bottom = element_blank(),
    panel.grid.major = element_line(size = 0.5, linetype = 'solid', color = "grey80"),
    panel.grid.minor = element_line(size = 0.25, linetype = 'solid', color = "grey90"),
    axis.title.x = element_blank(),
    axis.text.x = element_blank(),
    plot.title = element_text(face = "bold", size = 30, hjust = .5),
    axis.title.y = element_text(size = 15),
    legend.text = element_text(size = 13),
    legend.title = element_text(size = 15)
  )
p + guides(size = FALSE, color = guide_legend(override.aes = list(fill = NA)))
#ggsave(filename = "Bars_AFR.png", path = "../Results_Stats/", units = "px", width = 7000, height = 4500, bg = "#FFFFFF")
p + guides(size = FALSE, color = guide_legend(override.aes = list(fill = NA))) + theme(legend.position = "top")
```

```{r, fig.height=8, warning=FALSE, fig.width=35}
line.data <- data.frame(yintercept = c(0.80), Lines = c("Imputability threshold (>0.80)"))
ggplot(data = Total.A.Plot, 
            aes(x = INV, y = R2, fill = Impute.Method, 
                color = Impute.Method, 
                size = is_max,
                shape = is_max)) + 
  geom_jitter(width = 0.2, height = 0) + 
  geom_hline(aes(yintercept = yintercept, linetype = Lines, color = "gray30"), line.data) +
  scale_shape_manual(values = c("TRUE" = 17, "FALSE" = 1), name = c(), breaks = c("TRUE"), labels = c("Best Method")) +
  scale_linetype_manual(values = c("Imputability threshold (>0.80)" = "dashed"), name = c()) +
  scale_color_manual(values = c("Beagle" = "#00BF7D", "Impute2" = "#A3A500", "Impute5" = "#E76BF3", "Minimac4" = "#F8766D", "ScoreInvHap" = "#80A1E3", "gray30" = "gray30"), name = "Imputation Method", breaks = c("Beagle", "Impute2", "Impute5", "Minimac4", "ScoreInvHap")) +
  scale_size_manual(values = c('TRUE' = 4, 'FALSE' = 3)) +
  labs(y = expression("Imputability"~r^2), title = "Imputation Method Comparison per Inversion in AFR Population") + 
  guides(size = FALSE, fill = FALSE) +
  theme_classic() +
  theme(
    plot.title = element_text(face = "bold", size = 30, hjust = .5, margin = margin(10,0,20,0)),
    strip.background = element_rect(fill = "lightblue"),
    strip.text = element_text(color = "darkblue", face = "bold"),
    panel.grid.major = element_line(size = 0.5, linetype = 'solid', color = "grey80"),
    panel.grid.minor = element_line(size = 0.25, linetype = 'solid', color = "grey90"),
    axis.title.x = element_blank(),
    axis.title.y = element_text(size = 18),
    legend.text = element_text(size = 13),
    legend.title = element_text(size = 15),
    axis.text.x = element_text(size = 13, angle = 30, hjust = 1, vjust = 0.9),
    axis.text.y = element_text(size = 13),
    legend.position = "top")
#ggsave(filename = "Dots_AFR.png", path = "../Results_Stats/", units = "px", width = 7000, height = 4500, bg = "#FFFFFF")
```

## EUR
```{r, warning=FALSE}
I2.E <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean.Impute2.BEAGLE_Phase.0.80.EUR")
I5.E <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean.Impute5.BEAGLE_Phase.0.80.EUR")
B.E <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean.Beagle.BEAGLE_Phase.0.80.EUR")
M4.E <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EUR", filter = "Mean.Minimac4.BEAGLE_Phase.0.80.EUR")
sIH.E <- sel_df(Imputation.Info, imp_method = "ScoreInvHap",pop = "EUR", filter = "Mean")


Total.E <- cbind(B.E, I2.E[2], I5.E[2], M4.E[2], sIH.E[2])
colnames(Total.E) <- c("INV", "Beagle", "Impute2", "Impute5", "Minimac4", "ScoreInvHap")

Total.E.Plot <- Total.E %>% rowwise() %>% mutate(Max = max(c_across(c("Beagle", "Impute2", "Impute5", "Minimac4", "ScoreInvHap")),na.rm = TRUE))
Total.E.Plot <- Total.E.Plot %>% arrange(desc(Max))
Total.E.Plot$INV <- factor(Total.E.Plot$INV, levels = Total.E.Plot$INV)
Total.E.Plot <- Total.E.Plot  %>% pivot_longer(cols = c("Beagle", "Impute2", "Impute5", "Minimac4", "ScoreInvHap"), names_to = "Impute.Method", values_to = "R2")
Total.E.Plot <- Total.E.Plot %>% 
  mutate(is_max = R2 == Max)
Total.E.Plot$is_max <- as.factor(Total.E.Plot$is_max)


Total.E <- melt(Total.E, id.vars = "INV")
max_vals <- Total.E %>% group_by(INV,) %>% dplyr::summarise(max = max(value, na.rm = TRUE)) %>% ungroup()
Total.E <- Total.E %>%
  left_join(max_vals, by = c("INV")) %>%
  mutate(is_max = value == max)
Total.E$INV <- as.factor(Total.E$INV)
Total.E$is_max <- as.factor(Total.E$is_max)
order <- c("Beagle", "Impute2", "Impute5", "Minimac4", "ScoreInvHap")
Total.E <- Total.E %>% mutate(variable = factor(variable, levels = order))


priority_order <- c("Minimac4", "Impute2", "Impute5", "ScoreInvHap", "Beagle")

# Total.A.Plot$is_max <- as.logical(Total.A.Plot$is_max)
get_best_methods <- function(data) {
  # Filter rows with max = TRUE
  max_true <- filter(data, is_max == TRUE)
  # Determine the best method among the filtered rows
  sorted_methods <- max_true %>%
    arrange(match(Impute.Method, priority_order))
  best_methods <- sorted_methods$Impute.Method
  return(best_methods)
}

best_methods.E <- Total.E.Plot %>%
  group_by(INV) %>%
  summarise(best_methodss = list(get_best_methods(cur_data())))

best_methods.E <- best_methods.E %>%
  mutate(best = sapply(best_methods.E$best_methodss, function(x) x[1]),
         second_best = sapply(best_methods.E$best_methodss, function(x) ifelse(length(x) >= 2, x[2], NA)),
         third_best = sapply(best_methods.E$best_methodss, function(x) ifelse(length(x) >= 3, x[3], NA)),
         fourth_best = sapply(best_methods.E$best_methodss, function(x) ifelse(length(x) >= 4, x[4], NA)),
         fifth_best = sapply(best_methods.E$best_methodss, function(x) ifelse(length(x) >= 5, x[5], NA)))

# best_methods.E <- best_methods.E %>%
#   group_by(inversion_name) %>%
#   mutate(second_best = ifelse(length(best_methods.E) >= 2, best_methods.E[2], NA),
#          third_best = ifelse(length(best_methods.E) >= 3, best_methods.E[3], NA)) %>%
#   slice(1) %>%
#   select(inversion_name, best_methods.E, second_best, third_best)

## View the result
print(best_methods.E)

## Get the number of best performances per Inversion Method

sum(sapply(best_methods.E[-c(1,2)], function(col) sum(col == "Beagle", na.rm = TRUE)))
sum(sapply(best_methods.E[-c(1,2)], function(col) sum(col == "Impute2", na.rm = TRUE)))
sum(sapply(best_methods.E[-c(1,2)], function(col) sum(col == "Impute5", na.rm = TRUE)))
sum(sapply(best_methods.E[-c(1,2)], function(col) sum(col == "Minimac4", na.rm = TRUE)))
sum(sapply(best_methods.E[-c(1,2)], function(col) sum(col == "ScoreInvHap", na.rm = TRUE)))

```

```{r, fig.height=15, warning=FALSE}
line.data <- data.frame(yintercept = c(0.80), Lines = c("Imputability threshold (>0.80)"))
p <- ggplot(data = Total.E, 
            aes(x = INV, y = value, fill = variable, 
                color = is_max, 
                group = variable,
                size = is_max)) + 
  geom_bar(stat = "identity", position = position_dodge2(width = 0.9, padding = 0.2)) + 
  geom_hline(aes(yintercept = yintercept, linetype = Lines, color = "gray30"), line.data) +
  scale_fill_brewer(palette = "Set3", name = "Imputation Method") +
  scale_color_manual(values = c('TRUE' = 'black', 'FALSE' = NA), name = c(), labels = c("Best Method"), breaks = c("TRUE")) +
  scale_size_manual(values = c('TRUE' = 1, 'FALSE' = 0)) +
  scale_linetype_manual(values = c("Imputability threshold (>0.80)" = "dashed"), name = c()) +
  facet_wrap(~ INV, ncol = 5, scales = "free_x") +
  labs(y = expression("Imputability"~r^2), title = "Imputation Method Comparison per Inversion in EUR Population") + 
  theme_minimal() +
  theme(
    strip.background = element_rect(fill = "lightblue"),
    strip.text = element_text(color = "darkblue", face = "bold", size = 12),
    strip.text.x.bottom = element_blank(),
    panel.grid.major = element_line(size = 0.5, linetype = 'solid', color = "grey80"),
    panel.grid.minor = element_line(size = 0.25, linetype = 'solid', color = "grey90"),
    axis.title.x = element_blank(),
    axis.text.x = element_blank(),
    plot.title = element_text(face = "bold", size = 30, hjust = .5),
    axis.title.y = element_text(size = 15),
    legend.text = element_text(size = 13),
    legend.title = element_text(size = 15)
  )
p + guides(size = FALSE, color = guide_legend(override.aes = list(fill = NA)))
#ggsave(filename = "Bars_EUR.png", path = "../Results_Stats/", units = "px", width = 7000, height = 4500, bg = "#FFFFFF")
p + guides(size = FALSE, color = guide_legend(override.aes = list(fill = NA))) + theme(legend.position = "top")
```

```{r,fig.height=8, warning=FALSE, fig.width=35}
line.data <- data.frame(yintercept = c(0.80), Lines = c("Imputability threshold (>0.80)"))
ggplot(data = Total.E.Plot, 
            aes(x = INV, y = R2, fill = Impute.Method, 
                color = Impute.Method, 
                size = is_max,
                shape = is_max)) + 
  geom_jitter(width = 0.2, height = 0) + 
  geom_hline(aes(yintercept = yintercept, linetype = Lines, color = "gray30"), line.data) +
  scale_shape_manual(values = c("TRUE" = 17, "FALSE" = 1), name = c(), breaks = c("TRUE"), labels = c("Best Method")) +
  scale_linetype_manual(values = c("Imputability threshold (>0.80)" = "dashed"), name = c()) +
  scale_color_manual(values = c("Beagle" = "#00BF7D", "Impute2" = "#A3A500", "Impute5" = "#E76BF3", "Minimac4" = "#F8766D", "ScoreInvHap" = "#80A1E3", "gray30" = "gray30"), name = "Imputation Method", breaks = c("Beagle", "Impute2", "Impute5", "Minimac4", "ScoreInvHap")) +
  scale_size_manual(values = c('TRUE' = 4, 'FALSE' = 3)) +
  labs(y = expression("Imputability"~r^2), title = "Imputation Method Comparison per Inversion in EUR Population") + 
  guides(size = FALSE, fill = FALSE) +
  theme_classic() +
  theme(
    plot.title = element_text(face = "bold", size = 30, hjust = .5, margin = margin(10,0,20,0)),
    strip.background = element_rect(fill = "lightblue"),
    strip.text = element_text(color = "darkblue", face = "bold"),
    panel.grid.major = element_line(size = 0.5, linetype = 'solid', color = "grey80"),
    panel.grid.minor = element_line(size = 0.25, linetype = 'solid', color = "grey90"),
    axis.title.x = element_blank(),
    axis.title.y = element_text(size = 18),
    legend.text = element_text(size = 13),
    legend.title = element_text(size = 15),
    axis.text.x = element_text(size = 13, angle = 30, hjust = 1, vjust = 0.9),
    axis.text.y = element_text(size = 13),
    legend.position = "top")
#ggsave(filename = "Dots_EUR.png", path = "../Results_Stats/", units = "px", width = 7000, height = 4500, bg = "#FFFFFF")
```

## EAS
```{r, warning=FALSE}
I2.S <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean.Impute2.BEAGLE_Phase.0.80.EAS")
I5.S <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean.Impute5.BEAGLE_Phase.0.80.EAS")
B.S <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean.Beagle.BEAGLE_Phase.0.80.EAS")
M4.S <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "BEAGLE_Phase", pop = "EAS", filter = "Mean.Minimac4.BEAGLE_Phase.0.80.EAS")
sIH.S <- sel_df(Imputation.Info, imp_method = "ScoreInvHap",pop = "EAS", filter = "Mean")


Total.S <- cbind(B.S, I2.S[2], I5.S[2], M4.S[2], sIH.S[2])
colnames(Total.S) <- c("INV", "Beagle", "Impute2", "Impute5", "Minimac4", "ScoreInvHap")

Total.S.Plot <- Total.S %>% rowwise() %>% mutate(Max = max(c_across(c("Beagle", "Impute2", "Impute5", "Minimac4", "ScoreInvHap")),na.rm = TRUE))
Total.S.Plot <- Total.S.Plot %>% arrange(desc(Max))
Total.S.Plot$INV <- factor(Total.S.Plot$INV, levels = Total.S.Plot$INV)
Total.S.Plot <- Total.S.Plot  %>% pivot_longer(cols = c("Beagle", "Impute2", "Impute5", "Minimac4", "ScoreInvHap"), names_to = "Impute.Method", values_to = "R2")
Total.S.Plot <- Total.S.Plot %>% 
  mutate(is_max = R2 == Max)
Total.S.Plot$is_max <- as.factor(Total.S.Plot$is_max)

Total.S <- melt(Total.S, id.vars = "INV")
max_vals <- Total.S %>% group_by(INV,) %>% dplyr::summarise(max = max(value, na.rm = TRUE)) %>% ungroup()
Total.S <- Total.S %>%
  left_join(max_vals, by = c("INV")) %>%
  mutate(is_max = value == max)
Total.S$INV <- as.factor(Total.S$INV)
Total.S$is_max <- as.factor(Total.S$is_max)
order <- c("Beagle", "Impute2", "Impute5", "Minimac4", "ScoreInvHap")
Total.S <- Total.S %>% mutate(variable = factor(variable, levels = order))


priority_order <- c("Minimac4", "Impute2", "Impute5", "ScoreInvHap", "Beagle")

# Total.A.Plot$is_max <- as.logical(Total.A.Plot$is_max)
get_best_methods <- function(data) {
  # Filter rows with max = TRUE
  max_true <- filter(data, is_max == TRUE)
  # Determine the best method among the filtered rows
  sorted_methods <- max_true %>%
    arrange(match(Impute.Method, priority_order))
  best_methods <- sorted_methods$Impute.Method
  return(best_methods)
}

best_methods.S <- Total.S.Plot %>%
  group_by(INV) %>%
  summarise(best_methodss = list(get_best_methods(cur_data())))

best_methods.S <- best_methods.S %>%
  mutate(best = sapply(best_methods.S$best_methodss, function(x) x[1]),
         second_best = sapply(best_methods.S$best_methodss, function(x) ifelse(length(x) >= 2, x[2], NA)),
         third_best = sapply(best_methods.S$best_methodss, function(x) ifelse(length(x) >= 3, x[3], NA)),
         fourth_best = sapply(best_methods.S$best_methodss, function(x) ifelse(length(x) >= 4, x[4], NA)),
         fifth_best = sapply(best_methods.S$best_methodss, function(x) ifelse(length(x) >= 5, x[5], NA)))

# best_methods.S <- best_methods.S %>%
#   group_by(inversion_name) %>%
#   mutate(second_best = ifelse(length(best_methods.S) >= 2, best_methods.S[2], NA),
#          third_best = ifelse(length(best_methods.S) >= 3, best_methods.S[3], NA)) %>%
#   slice(1) %>%
#   select(inversion_name, best_methods.S, second_best, third_best)

## View the result
print(best_methods.S)

## Get the number of best performances per Inversion Method

sum(sapply(best_methods.S[-c(1,2)], function(col) sum(col == "Beagle", na.rm = TRUE)))
sum(sapply(best_methods.S[-c(1,2)], function(col) sum(col == "Impute2", na.rm = TRUE)))
sum(sapply(best_methods.S[-c(1,2)], function(col) sum(col == "Impute5", na.rm = TRUE)))
sum(sapply(best_methods.S[-c(1,2)], function(col) sum(col == "Minimac4", na.rm = TRUE)))
sum(sapply(best_methods.S[-c(1,2)], function(col) sum(col == "ScoreInvHap", na.rm = TRUE)))
```

```{r, fig.height=15, warning=FALSE}
line.data <- data.frame(yintercept = c(0.80), Lines = c("Imputability threshold (>0.80)"))
p <- ggplot(data = Total.S, 
            aes(x = INV, y = value, fill = variable, 
                color = is_max, 
                group = variable,
                size = is_max)) + 
  geom_bar(stat = "identity", position = position_dodge2(width = 0.9, padding = 0.2)) + 
  geom_hline(aes(yintercept = yintercept, linetype = Lines, color = "gray30"), line.data) +
  scale_fill_brewer(palette = "Set3", name = "Imputation Method") +
  scale_color_manual(values = c('TRUE' = 'black', 'FALSE' = NA), name = c(), labels = c("Best Method"), breaks = c("TRUE")) +
  scale_size_manual(values = c('TRUE' = 1, 'FALSE' = 0)) +
  scale_linetype_manual(values = c("Imputability threshold (>0.80)" = "dashed"), name = c()) +
  facet_wrap(~ INV, ncol = 5, scales = "free_x") +
  labs(y = expression("Imputability"~r^2), title = "Imputation Method Comparison per Inversion in EAS Population") + 
  theme_minimal() +
  theme(
    strip.background = element_rect(fill = "lightblue"),
    strip.text = element_text(color = "darkblue", face = "bold", size = 12),
    strip.text.x.bottom = element_blank(),
    panel.grid.major = element_line(size = 0.5, linetype = 'solid', color = "grey80"),
    panel.grid.minor = element_line(size = 0.25, linetype = 'solid', color = "grey90"),
    axis.title.x = element_blank(),
    axis.text.x = element_blank(),
    plot.title = element_text(face = "bold", size = 30, hjust = .5),
    axis.title.y = element_text(size = 15),
    legend.text = element_text(size = 13),
    legend.title = element_text(size = 15)
  )
p + guides(size = FALSE, color = guide_legend(override.aes = list(fill = NA)))
#ggsave(filename = "Bars_EAS.png", path = "../Results_Stats/", units = "px", width = 7000, height = 4500, bg = "#FFFFFF")
p + guides(size = FALSE, color = guide_legend(override.aes = list(fill = NA))) + theme(legend.position = "top")
```


```{r, fig.height=8, warning=FALSE, fig.width=35}
line.data <- data.frame(yintercept = c(0.80), Lines = c("Imputability threshold (>0.80)"))
ggplot(data = Total.S.Plot, 
            aes(x = INV, y = R2, fill = Impute.Method, 
                color = Impute.Method, 
                size = is_max,
                shape = is_max)) + 
  geom_jitter(width = 0.2, height = 0) + 
  geom_hline(aes(yintercept = yintercept, linetype = Lines, color = "gray30"), line.data) +
  scale_shape_manual(values = c("TRUE" = 17, "FALSE" = 1), name = c(), breaks = c("TRUE"), labels = c("Best Method")) +
  scale_linetype_manual(values = c("Imputability threshold (>0.80)" = "dashed"), name = c()) +
  scale_color_manual(values = c("Beagle" = "#00BF7D", "Impute2" = "#A3A500", "Impute5" = "#E76BF3", "Minimac4" = "#F8766D", "ScoreInvHap" = "#80A1E3", "gray30" = "gray30"), name = "Imputation Method", breaks = c("Beagle", "Impute2", "Impute5", "Minimac4", "ScoreInvHap")) +
  scale_size_manual(values = c('TRUE' = 4, 'FALSE' = 3)) +
  labs(y = expression("Imputability"~r^2), title = "Imputation Method Comparison per Inversion in EAS Population") + 
  guides(size = FALSE, fill = FALSE) +
  theme_classic() +
  theme(
    plot.title = element_text(face = "bold", size = 30, hjust = .5, margin = margin(10,0,20,0)),
    strip.background = element_rect(fill = "lightblue"),
    strip.text = element_text(color = "darkblue", face = "bold"),
    panel.grid.major = element_line(size = 0.5, linetype = 'solid', color = "grey80"),
    panel.grid.minor = element_line(size = 0.25, linetype = 'solid', color = "grey90"),
    axis.title.x = element_blank(),
    axis.title.y = element_text(size = 18),
    legend.text = element_text(size = 13),
    legend.title = element_text(size = 15),
    axis.text.x = element_text(size = 13, angle = 30, hjust = 1, vjust = 0.9),
    axis.text.y = element_text(size = 13),
    legend.position = "top")
#ggsave(filename = "Dots_EAS.png", path = "../Results_Stats/", units = "px", width = 7000, height = 4500, bg = "#FFFFFF")
```



```{r}
library(ggplot2)
library(ggforce)
library(dplyr)
library(ggrepel)

# Sample data
set.seed(123)
df <- data.frame(
  x = rnorm(100),
  y = rnorm(100)
)

# Perform k-means clustering
kmeans_result <- kmeans(df, centers = 3)
df$cluster <- factor(kmeans_result$cluster)
df$label <- paste("Cluster", df$cluster)

# Plot with cluster labels
ggplot(df, aes(x = x, y = y, color = cluster)) +
  geom_point() +
  geom_mark_hull(aes(fill = cluster, label = label), alpha = 0.1) +
  geom_text_repel(aes(label = label), size = 5, max.overlaps = 10) +
  theme_minimal() +
  labs(title = "Clusters with Labels")

```


```{r, fig.height=15}
p <- ggplot(data = Total.A, 
            aes(x = factor(INV), y = value, fill = variable)) + 
  geom_bar(stat = "identity", position = position_dodge(width = 0.9), show.legend = FALSE) + 
  # Highlighted bars on top
  geom_bar(stat = "identity", position = position_dodge(width = 0.9), 
           data = Total.A %>% filter(is_max), 
           aes(x = factor(INV), y = value, fill = variable), 
           color = "black", size = 1, show.legend = FALSE) +
  geom_hline(yintercept = 0.80, linetype = "dashed", color = "gray30") +
  scale_fill_brewer(palette = "Set3") +
  facet_wrap(~ INV, ncol = 5, scales = "free_x") +
  theme_minimal() +
  theme(
    strip.background = element_rect(fill = "lightblue"),
    strip.text = element_text(color = "darkblue", face = "bold"),
    panel.grid.major = element_line(size = 0.5, linetype = 'solid', color = "grey80"),
    panel.grid.minor = element_line(size = 0.25, linetype = 'solid', color = "grey90")
  )

# Print the plot
print(p)
```



### Upset plot

### ALL

```{r}
BEAGLE.Shapeit_Phase.Invs.AFR <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "Shapeit_Phase", pop = "AFR", filter = "Mean")
Impute2.Shapeit_Phase.Invs.AFR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "Shapeit_Phase", pop = "AFR", filter = "Mean")
Impute5.Shapeit_Phase.Invs.AFR <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "Shapeit_Phase", pop = "AFR", filter = "Mean")
Minimac4.Shapeit_Phase.Invs.AFR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "Shapeit_Phase", pop = "AFR", filter = "Mean")
ScoreInvHap.Invs.AFR <- sel_df(Imputation.Info, imp_method = "ScoreInvHap", pop = "AFR", filter = "Mean")

BEAGLE.Shapeit_Phase.Invs.AFR <- BEAGLE.Shapeit_Phase.Invs.AFR[match(Inv.Data.Plot.AFR$INV, BEAGLE.Shapeit_Phase.Invs.AFR$INV),]
rownames(BEAGLE.Shapeit_Phase.Invs.AFR) <- c()
BEAGLE.Shapeit_Phase.Invs.AFR <- column_to_rownames(BEAGLE.Shapeit_Phase.Invs.AFR, var = "INV")
colnames(BEAGLE.Shapeit_Phase.Invs.AFR) <- c("0.50", "0.70", "0.80", "0.90", "0.95")
BEAGLE.Shapeit_Phase.Invs.AFR <- BEAGLE.Shapeit_Phase.Invs.AFR %>% mutate_at(
  vars(`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
BEAGLE.Shapeit_Phase.Invs.AFR <- roundAll(BEAGLE.Shapeit_Phase.Invs.AFR, 2)


Impute2.Shapeit_Phase.Invs.AFR <- Impute2.Shapeit_Phase.Invs.AFR[match(Inv.Data.Plot.AFR$INV, Impute2.Shapeit_Phase.Invs.AFR$INV),]
rownames(Impute2.Shapeit_Phase.Invs.AFR) <- c()
Impute2.Shapeit_Phase.Invs.AFR <- column_to_rownames(Impute2.Shapeit_Phase.Invs.AFR, var = "INV")
colnames(Impute2.Shapeit_Phase.Invs.AFR) <- c("0.50", "0.70", "0.80", "0.90", "0.95")
Impute2.Shapeit_Phase.Invs.AFR <- Impute2.Shapeit_Phase.Invs.AFR %>% mutate_at(
  vars(`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Impute2.Shapeit_Phase.Invs.AFR <- roundAll(Impute2.Shapeit_Phase.Invs.AFR, 2)


Impute5.Shapeit_Phase.Invs.AFR <- Impute5.Shapeit_Phase.Invs.AFR[match(Inv.Data.Plot.AFR$INV, Impute5.Shapeit_Phase.Invs.AFR$INV),]
rownames(Impute5.Shapeit_Phase.Invs.AFR) <- c()
Impute5.Shapeit_Phase.Invs.AFR <- column_to_rownames(Impute5.Shapeit_Phase.Invs.AFR, var = "INV")
colnames(Impute5.Shapeit_Phase.Invs.AFR) <- c("0.50", "0.70", "0.80", "0.90", "0.95")
Impute5.Shapeit_Phase.Invs.AFR <- Impute5.Shapeit_Phase.Invs.AFR %>% mutate_at(
  vars(`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Impute5.Shapeit_Phase.Invs.AFR <- roundAll(Impute5.Shapeit_Phase.Invs.AFR, 2)


Minimac4.Shapeit_Phase.Invs.AFR <- Minimac4.Shapeit_Phase.Invs.AFR[match(Inv.Data.Plot.AFR$INV, Minimac4.Shapeit_Phase.Invs.AFR$INV),]
rownames(Minimac4.Shapeit_Phase.Invs.AFR) <- c()
Minimac4.Shapeit_Phase.Invs.AFR <- column_to_rownames(Minimac4.Shapeit_Phase.Invs.AFR, var = "INV")
colnames(Minimac4.Shapeit_Phase.Invs.AFR) <- c("0.50", "0.70", "0.80", "0.90", "0.95")
Minimac4.Shapeit_Phase.Invs.AFR <- Minimac4.Shapeit_Phase.Invs.AFR %>% mutate_at(
  vars(`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Minimac4.Shapeit_Phase.Invs.AFR <- roundAll(Minimac4.Shapeit_Phase.Invs.AFR, 2)


ScoreInvHap.Invs.AFR <- ScoreInvHap.Invs.AFR[match(Inv.Data.Plot.AFR$INV, ScoreInvHap.Invs.AFR$INV),]
rownames(ScoreInvHap.Invs.AFR) <- c()
ScoreInvHap.Invs.AFR <- column_to_rownames(ScoreInvHap.Invs.AFR, var = "INV")
colnames(ScoreInvHap.Invs.AFR) <- c("R2")
ScoreInvHap.Invs.AFR <- roundAll(ScoreInvHap.Invs.AFR, 2)
ScoreInvHap.Invs.AFR <- ScoreInvHap.Invs.AFR %>% mutate_at(
  vars(`R2`), funs(as.character)
)

BEAGLE.Shapeit_Phase.Invs.EAS <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "Shapeit_Phase", pop = "EAS", filter = "Mean")
Impute2.Shapeit_Phase.Invs.EAS <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "Shapeit_Phase", pop = "EAS", filter = "Mean")
Impute5.Shapeit_Phase.Invs.EAS <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "Shapeit_Phase", pop = "EAS", filter = "Mean")
Minimac4.Shapeit_Phase.Invs.EAS <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "Shapeit_Phase", pop = "EAS", filter = "Mean")
ScoreInvHap.Invs.EAS <- sel_df(Imputation.Info, imp_method = "ScoreInvHap", pop = "EAS", filter = "Mean")

BEAGLE.Shapeit_Phase.Invs.EAS <- BEAGLE.Shapeit_Phase.Invs.EAS[match(Inv.Data.Plot.EAS$INV, BEAGLE.Shapeit_Phase.Invs.EAS$INV),]
rownames(BEAGLE.Shapeit_Phase.Invs.EAS) <- c()
BEAGLE.Shapeit_Phase.Invs.EAS <- column_to_rownames(BEAGLE.Shapeit_Phase.Invs.EAS, var = "INV")
colnames(BEAGLE.Shapeit_Phase.Invs.EAS) <- c("0.50", "0.70", "0.80", "0.90", "0.95")
BEAGLE.Shapeit_Phase.Invs.EAS <- BEAGLE.Shapeit_Phase.Invs.EAS %>% mutate_at(
  vars(`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
BEAGLE.Shapeit_Phase.Invs.EAS <- roundAll(BEAGLE.Shapeit_Phase.Invs.EAS, 2)

Impute2.Shapeit_Phase.Invs.EAS <- Impute2.Shapeit_Phase.Invs.EAS[match(Inv.Data.Plot.EAS$INV, Impute2.Shapeit_Phase.Invs.EAS$INV),]
rownames(Impute2.Shapeit_Phase.Invs.EAS) <- c()
Impute2.Shapeit_Phase.Invs.EAS <- column_to_rownames(Impute2.Shapeit_Phase.Invs.EAS, var = "INV")
colnames(Impute2.Shapeit_Phase.Invs.EAS) <- c("0.50", "0.70", "0.80", "0.90", "0.95")
Impute2.Shapeit_Phase.Invs.EAS <- Impute2.Shapeit_Phase.Invs.EAS %>% mutate_at(
  vars(`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Impute2.Shapeit_Phase.Invs.EAS <- roundAll(Impute2.Shapeit_Phase.Invs.EAS, 2)


Impute5.Shapeit_Phase.Invs.EAS <- Impute5.Shapeit_Phase.Invs.EAS[match(Inv.Data.Plot.EAS$INV, Impute5.Shapeit_Phase.Invs.EAS$INV),]
rownames(Impute5.Shapeit_Phase.Invs.EAS) <- c()
Impute5.Shapeit_Phase.Invs.EAS <- column_to_rownames(Impute5.Shapeit_Phase.Invs.EAS, var = "INV")
colnames(Impute5.Shapeit_Phase.Invs.EAS) <- c("0.50", "0.70", "0.80", "0.90", "0.95")
Impute5.Shapeit_Phase.Invs.EAS <- Impute5.Shapeit_Phase.Invs.EAS %>% mutate_at(
  vars(`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Impute5.Shapeit_Phase.Invs.EAS <- roundAll(Impute5.Shapeit_Phase.Invs.EAS, 2)


Minimac4.Shapeit_Phase.Invs.EAS <- Minimac4.Shapeit_Phase.Invs.EAS[match(Inv.Data.Plot.EAS$INV, Minimac4.Shapeit_Phase.Invs.EAS$INV),]
rownames(Minimac4.Shapeit_Phase.Invs.EAS) <- c()
Minimac4.Shapeit_Phase.Invs.EAS <- column_to_rownames(Minimac4.Shapeit_Phase.Invs.EAS, var = "INV")
colnames(Minimac4.Shapeit_Phase.Invs.EAS) <- c("0.50", "0.70", "0.80", "0.90", "0.95")
Minimac4.Shapeit_Phase.Invs.EAS <- Minimac4.Shapeit_Phase.Invs.EAS %>% mutate_at(
  vars(`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Minimac4.Shapeit_Phase.Invs.EAS <- roundAll(Minimac4.Shapeit_Phase.Invs.EAS, 2)


ScoreInvHap.Invs.EAS <- ScoreInvHap.Invs.EAS[match(Inv.Data.Plot.EAS$INV, ScoreInvHap.Invs.EAS$INV),]
rownames(ScoreInvHap.Invs.EAS) <- c()
ScoreInvHap.Invs.EAS <- column_to_rownames(ScoreInvHap.Invs.EAS, var = "INV")
colnames(ScoreInvHap.Invs.EAS) <- c("R2")
ScoreInvHap.Invs.EAS <- roundAll(ScoreInvHap.Invs.EAS, 2)
ScoreInvHap.Invs.EAS <- ScoreInvHap.Invs.EAS %>% mutate_at(
  vars(`R2`), funs(as.character)
)


BEAGLE.Shapeit_Phase.Invs.EUR <- sel_df(Imputation.Info, imp_method = "Beagle", condition = "Shapeit_Phase", pop = "EUR", filter = "Mean")
Impute2.Shapeit_Phase.Invs.EUR <- sel_df(Imputation.Info, imp_method = "Impute2", condition = "Shapeit_Phase", pop = "EUR", filter = "Mean")
Impute5.Shapeit_Phase.Invs.EUR <- sel_df(Imputation.Info, imp_method = "Impute5", condition = "Shapeit_Phase", pop = "EUR", filter = "Mean")
Minimac4.Shapeit_Phase.Invs.EUR <- sel_df(Imputation.Info, imp_method = "Minimac4", condition = "Shapeit_Phase", pop = "EUR", filter = "Mean")
ScoreInvHap.Invs.EUR <- sel_df(Imputation.Info, imp_method = "ScoreInvHap", pop = "EUR", filter = "Mean")

BEAGLE.Shapeit_Phase.Invs.EUR <- BEAGLE.Shapeit_Phase.Invs.EUR[match(Inv.Data.Plot.EUR$INV, BEAGLE.Shapeit_Phase.Invs.EUR$INV),]
rownames(BEAGLE.Shapeit_Phase.Invs.EUR) <- c()
BEAGLE.Shapeit_Phase.Invs.EUR <- column_to_rownames(BEAGLE.Shapeit_Phase.Invs.EUR, var = "INV")
colnames(BEAGLE.Shapeit_Phase.Invs.EUR) <- c("0.50", "0.70", "0.80", "0.90", "0.95")
BEAGLE.Shapeit_Phase.Invs.EUR <- BEAGLE.Shapeit_Phase.Invs.EUR %>% mutate_at(
  vars(`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
BEAGLE.Shapeit_Phase.Invs.EUR <- roundAll(BEAGLE.Shapeit_Phase.Invs.EUR, 2)

Impute2.Shapeit_Phase.Invs.EUR <- Impute2.Shapeit_Phase.Invs.EUR[match(Inv.Data.Plot.EUR$INV, Impute2.Shapeit_Phase.Invs.EUR$INV),]
rownames(Impute2.Shapeit_Phase.Invs.EUR) <- c()
Impute2.Shapeit_Phase.Invs.EUR <- column_to_rownames(Impute2.Shapeit_Phase.Invs.EUR, var = "INV")
colnames(Impute2.Shapeit_Phase.Invs.EUR) <- c("0.50", "0.70", "0.80", "0.90", "0.95")
Impute2.Shapeit_Phase.Invs.EUR <- Impute2.Shapeit_Phase.Invs.EUR %>% mutate_at(
  vars(`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Impute2.Shapeit_Phase.Invs.EUR <- roundAll(Impute2.Shapeit_Phase.Invs.EUR, 2)


Impute5.Shapeit_Phase.Invs.EUR <- Impute5.Shapeit_Phase.Invs.EUR[match(Inv.Data.Plot.EUR$INV, Impute5.Shapeit_Phase.Invs.EUR$INV),]
rownames(Impute5.Shapeit_Phase.Invs.EUR) <- c()
Impute5.Shapeit_Phase.Invs.EUR <- column_to_rownames(Impute5.Shapeit_Phase.Invs.EUR, var = "INV")
colnames(Impute5.Shapeit_Phase.Invs.EUR) <- c("0.50", "0.70", "0.80", "0.90", "0.95")
Impute5.Shapeit_Phase.Invs.EUR <- Impute5.Shapeit_Phase.Invs.EUR %>% mutate_at(
  vars(`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Impute5.Shapeit_Phase.Invs.EUR <- roundAll(Impute5.Shapeit_Phase.Invs.EUR, 2)


Minimac4.Shapeit_Phase.Invs.EUR <- Minimac4.Shapeit_Phase.Invs.EUR[match(Inv.Data.Plot.EUR$INV, Minimac4.Shapeit_Phase.Invs.EUR$INV),]
rownames(Minimac4.Shapeit_Phase.Invs.EUR) <- c()
Minimac4.Shapeit_Phase.Invs.EUR <- column_to_rownames(Minimac4.Shapeit_Phase.Invs.EUR, var = "INV")
colnames(Minimac4.Shapeit_Phase.Invs.EUR) <- c("0.50", "0.70", "0.80", "0.90", "0.95")
Minimac4.Shapeit_Phase.Invs.EUR <- Minimac4.Shapeit_Phase.Invs.EUR %>% mutate_at(
  vars(`0.50`, `0.70`, `0.80`, `0.90`, `0.95`), funs(as.character)
)
Minimac4.Shapeit_Phase.Invs.EUR <- roundAll(Minimac4.Shapeit_Phase.Invs.EUR, 2)


ScoreInvHap.Invs.EUR <- ScoreInvHap.Invs.EUR[match(Inv.Data.Plot.EUR$INV, ScoreInvHap.Invs.EUR$INV),]
rownames(ScoreInvHap.Invs.EUR) <- c()
ScoreInvHap.Invs.EUR <- column_to_rownames(ScoreInvHap.Invs.EUR, var = "INV")
colnames(ScoreInvHap.Invs.EUR) <- c("R2")
ScoreInvHap.Invs.EUR <- roundAll(ScoreInvHap.Invs.EUR, 2)
ScoreInvHap.Invs.EUR <- ScoreInvHap.Invs.EUR %>% mutate_at(
  vars(`R2`), funs(as.character)
)


BEAGLE.Shapeit_Phase.Imp.AFR <- BEAGLE.Shapeit_Phase.Invs.AFR[BEAGLE.Shapeit_Phase.Invs.AFR$`0.90` >= 0.8,]
BEAGLE.Shapeit_Phase.Imp.AFR <- rownames(BEAGLE.Shapeit_Phase.Imp.AFR[!is.na(BEAGLE.Shapeit_Phase.Imp.AFR$`0.90`),])
BEAGLE.Shapeit_Phase.Imp.AFR

Impute2.Shapeit_Phase.Imp.AFR <- Impute2.Shapeit_Phase.Invs.AFR[Impute2.Shapeit_Phase.Invs.AFR$`0.90` >= 0.8,]
Impute2.Shapeit_Phase.Imp.AFR <- rownames(Impute2.Shapeit_Phase.Imp.AFR[!is.na(Impute2.Shapeit_Phase.Imp.AFR$`0.90`),])
Impute2.Shapeit_Phase.Imp.AFR

Impute5.Shapeit_Phase.Imp.AFR <- Impute5.Shapeit_Phase.Invs.AFR[Impute5.Shapeit_Phase.Invs.AFR$`0.90` >= 0.8,]
Impute5.Shapeit_Phase.Imp.AFR <- rownames(Impute5.Shapeit_Phase.Imp.AFR[!is.na(Impute5.Shapeit_Phase.Imp.AFR$`0.90`),])
Impute5.Shapeit_Phase.Imp.AFR

Minimac4.Shapeit_Phase.Imp.AFR <- Minimac4.Shapeit_Phase.Invs.AFR[Minimac4.Shapeit_Phase.Invs.AFR$`0.90` >= 0.8,]
Minimac4.Shapeit_Phase.Imp.AFR <- rownames(Minimac4.Shapeit_Phase.Imp.AFR[!is.na(Minimac4.Shapeit_Phase.Imp.AFR$`0.90`),])
Minimac4.Shapeit_Phase.Imp.AFR

ScoreInvHap.Invs.AFR$Inv <- rownames(ScoreInvHap.Invs.AFR)
ScoreInvHap.Imp.AFR <- ScoreInvHap.Invs.AFR[!is.na(ScoreInvHap.Invs.AFR$R2),]
ScoreInvHap.Imp.AFR <- rownames(ScoreInvHap.Imp.AFR[ScoreInvHap.Imp.AFR$R2 >= 0.8,])
ScoreInvHap.Imp.AFR



BEAGLE.Shapeit_Phase.Imp.EUR <- BEAGLE.Shapeit_Phase.Invs.EUR[BEAGLE.Shapeit_Phase.Invs.EUR$`0.90` >= 0.8,]
BEAGLE.Shapeit_Phase.Imp.EUR <- rownames(BEAGLE.Shapeit_Phase.Imp.EUR[!is.na(BEAGLE.Shapeit_Phase.Imp.EUR$`0.90`),])
BEAGLE.Shapeit_Phase.Imp.EUR

Impute2.Shapeit_Phase.Imp.EUR <- Impute2.Shapeit_Phase.Invs.EUR[Impute2.Shapeit_Phase.Invs.EUR$`0.90` >= 0.8,]
Impute2.Shapeit_Phase.Imp.EUR <- rownames(Impute2.Shapeit_Phase.Imp.EUR[!is.na(Impute2.Shapeit_Phase.Imp.EUR$`0.90`),])
Impute2.Shapeit_Phase.Imp.EUR

Impute5.Shapeit_Phase.Imp.EUR <- Impute5.Shapeit_Phase.Invs.EUR[Impute5.Shapeit_Phase.Invs.EUR$`0.90` >= 0.8,]
Impute5.Shapeit_Phase.Imp.EUR <- rownames(Impute5.Shapeit_Phase.Imp.EUR[!is.na(Impute5.Shapeit_Phase.Imp.EUR$`0.90`),])
Impute5.Shapeit_Phase.Imp.EUR

Minimac4.Shapeit_Phase.Imp.EUR <- Minimac4.Shapeit_Phase.Invs.EUR[Minimac4.Shapeit_Phase.Invs.EUR$`0.90` >= 0.8,]
Minimac4.Shapeit_Phase.Imp.EUR <- rownames(Minimac4.Shapeit_Phase.Imp.EUR[!is.na(Minimac4.Shapeit_Phase.Imp.EUR$`0.90`),])
Minimac4.Shapeit_Phase.Imp.EUR

ScoreInvHap.Invs.EUR$Inv <- rownames(ScoreInvHap.Invs.EUR)
ScoreInvHap.Imp.EUR <- ScoreInvHap.Invs.EUR[!is.na(ScoreInvHap.Invs.EUR$R2),]
ScoreInvHap.Imp.EUR <- rownames(ScoreInvHap.Imp.EUR[ScoreInvHap.Imp.EUR$R2 >= 0.8,])
ScoreInvHap.Imp.EUR



BEAGLE.Shapeit_Phase.Imp.EAS <- BEAGLE.Shapeit_Phase.Invs.EAS[BEAGLE.Shapeit_Phase.Invs.EAS$`0.90` >= 0.8,]
BEAGLE.Shapeit_Phase.Imp.EAS <- rownames(BEAGLE.Shapeit_Phase.Imp.EAS[!is.na(BEAGLE.Shapeit_Phase.Imp.EAS$`0.90`),])
BEAGLE.Shapeit_Phase.Imp.EAS

Impute2.Shapeit_Phase.Imp.EAS <- Impute2.Shapeit_Phase.Invs.EAS[Impute2.Shapeit_Phase.Invs.EAS$`0.90` >= 0.8,]
Impute2.Shapeit_Phase.Imp.EAS <- rownames(Impute2.Shapeit_Phase.Imp.EAS[!is.na(Impute2.Shapeit_Phase.Imp.EAS$`0.90`),])
Impute2.Shapeit_Phase.Imp.EAS

Impute5.Shapeit_Phase.Imp.EAS <- Impute5.Shapeit_Phase.Invs.EAS[Impute5.Shapeit_Phase.Invs.EAS$`0.90` >= 0.8,]
Impute5.Shapeit_Phase.Imp.EAS <- rownames(Impute5.Shapeit_Phase.Imp.EAS[!is.na(Impute5.Shapeit_Phase.Imp.EAS$`0.90`),])
Impute5.Shapeit_Phase.Imp.EAS

Minimac4.Shapeit_Phase.Imp.EAS <- Minimac4.Shapeit_Phase.Invs.EAS[Minimac4.Shapeit_Phase.Invs.EAS$`0.90` >= 0.8,]
Minimac4.Shapeit_Phase.Imp.EAS <- rownames(Minimac4.Shapeit_Phase.Imp.EAS[!is.na(Minimac4.Shapeit_Phase.Imp.EAS$`0.90`),])
Minimac4.Shapeit_Phase.Imp.EAS

ScoreInvHap.Invs.EAS$Inv <- rownames(ScoreInvHap.Invs.EAS)
ScoreInvHap.Imp.EAS <- ScoreInvHap.Invs.EAS[!is.na(ScoreInvHap.Invs.EAS$R2),]
ScoreInvHap.Imp.EAS <- rownames(ScoreInvHap.Imp.EAS[ScoreInvHap.Imp.EAS$R2 >= 0.8,])
ScoreInvHap.Imp.EAS

AFR_Info <- read.csv(paste0(wd,"/Results_Stats/Inversions_State_AFR.txt"), sep = "\t", header = FALSE)
EUR_Info <- read.csv(paste0(wd,"/Results_Stats/Inversions_State_EUR.txt"), sep = "\t", header = FALSE)
EAS_Info <- read.csv(paste0(wd,"/Results_Stats/Inversions_State_EAS.txt"), sep = "\t", header = FALSE)

rsIHA <- AFR_Info$V1[AFR_Info$V2 == "Polymorphic"]
rsIHE <- EUR_Info$V1[EUR_Info$V2 == "Polymorphic"]
rsIHS <- EAS_Info$V1[EAS_Info$V2 == "Polymorphic"]
```


## Now, plot upset plot

## EUR
```{r}
set_size = function(w, h, factor=1.5) {
  s = 1 * factor
  options(
    repr.plot.width=w * s,
    repr.plot.height=h * s,
    repr.plot.res=100 / factor,
    jupyter.plot_mimetypes='image/png',
    jupyter.plot_scale=1
  )
}

UpEUR <- as.data.frame(rsIHE)
colnames(UpEUR) <- c("Inv")
rownames(UpEUR) <- UpEUR$Inv

UpEUR$BEAGLE <- sapply(UpEUR$Inv, function(x){
  if(!is.na(BEAGLE.Shapeit_Phase.Invs.EUR[x,"0.90"])){
    if(BEAGLE.Shapeit_Phase.Invs.EUR[x,"0.90"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpEUR$IMPUTE2 <- sapply(UpEUR$Inv, function(x){
  if(!is.na(Impute2.Shapeit_Phase.Invs.EUR[x,"0.90"])){
    if(Impute2.Shapeit_Phase.Invs.EUR[x,"0.90"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpEUR$IMPUTE5 <- sapply(UpEUR$Inv, function(x){
  if(!is.na(Impute5.Shapeit_Phase.Invs.EUR[x,"0.90"])){
    if(Impute5.Shapeit_Phase.Invs.EUR[x,"0.90"] >= 0.8){
      1
    } else {0}
  } else {0}
})



UpEUR$Minimac4 <- sapply(UpEUR$Inv, function(x){
  if(!is.na(Minimac4.Shapeit_Phase.Invs.EUR[x,"0.90"])){
    if(Minimac4.Shapeit_Phase.Invs.EUR[x,"0.90"] >= 0.8){
      1
    } else {0}
  } else {0}
})


UpEUR$scoreInvHap <- sapply(UpEUR$Inv, function(x){
  if(!is.na(ScoreInvHap.Invs.EUR[x,"R2"])){
    if(ScoreInvHap.Invs.EUR[x,"R2"] >= 0.8){
      1
    } else {0}
  } else {0}
})

softs = colnames(UpEUR)[2:length(colnames(UpEUR))]

png("UpSet_EUR_SP.png", height =3000, width = 6000)
set_size(5, 3)
(upset(UpEUR, softs, name = "Software", sort_intersections=FALSE,
      base_annotations = list(
        'Intersection size' = intersection_size(mapping=aes(fill='bars_color'),
                                                text_colors=c(
                                                  on_background='black', on_bar='black'),
                                                text = list(size = 40)
                                                ) + 
          scale_fill_manual(values=c('bars_color'='#ff8b8b'), guide='none') +
          ylab(substitute(paste("Imputable inversions (",italic("r\u00B2"),"  0.8)"))) +
          theme(axis.text = element_text(size = 120, color = "black"))
        ),
      matrix = intersection_matrix(geom = geom_point(size = 30),
                                   outline_color = list(active = "#4e8bff", inactive = "#4eb7ff")),
      #stripes = c("#F6F9FF", "#F6F9FF"),
      width_ratio = 0.2,
      set_sizes = (upset_set_size(geom = geom_bar(color = "#ff8b8b", fill = "#ff8b8b"))) +
        geom_text(aes(label=..count..), hjust=-0.4, stat='count', size = 40, color = "black") +
        ylim(45,0),
      intersections = list("scoreInvHap",
                           "Minimac4",
                           "IMPUTE5",
                           "IMPUTE2",
                           "BEAGLE",
                           c("scoreInvHap", "Minimac4"),
                           c("scoreInvHap", "IMPUTE5"),
                           c("scoreInvHap", "IMPUTE2"),
                           c("scoreInvHap", "BEAGLE"),
                           c("Minimac4", "IMPUTE5"),
                           c("Minimac4", "IMPUTE2"),
                           c("Minimac4", "BEAGLE"),
                           c("IMPUTE5", "IMPUTE2"),
                           c("IMPUTE5", "BEAGLE"),
                           c("IMPUTE2", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5"),
                           c("scoreInvHap", "Minimac4", "IMPUTE2"),
                           c("scoreInvHap", "Minimac4", "BEAGLE"),
                           c("scoreInvHap", "IMPUTE5", "IMPUTE2"),
                           c("scoreInvHap", "IMPUTE5", "BEAGLE"),
                           c("scoreInvHap", "IMPUTE2", "BEAGLE"),
                           c("Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("Minimac4", "IMPUTE5", "BEAGLE"),
                           c("Minimac4", "IMPUTE2", "BEAGLE"),
                           c("IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE2", "BEAGLE"),
                           c("scoreInvHap", "IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("Minimac4", "IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("IMPUTE5", "IMPUTE2", "BEAGLE", "Minimac4","scoreInvHap"),
                           'Outside of known sets'),
      sort_sets = F,
      stripes = upset_stripes(geom = geom_blank()),
      themes = upset_modify_themes(
        list(
          'intersections_matrix' = theme(axis.text=element_text(size=130, color = "black")),
          'overall_sizes'=theme(#axis.text.x=element_text(angle=90),
            axis.title = element_text(size = 120))
        )
      )
                                   
      ) & 
    theme(plot.background=element_rect(fill='#F6F9FF', color = '#F6F9FF'),
          # text = element_text(size = 50),
          # axis.text = element_text(size = 60, color = "black"),
          axis.title = element_text(size = 120, color = "black"),
          line = element_line(colour = NULL))
  )

dev.off()


```

### AFR
```{r}
set_size = function(w, h, factor=1.5) {
  s = 1 * factor
  options(
    repr.plot.width=w * s,
    repr.plot.height=h * s,
    repr.plot.res=100 / factor,
    jupyter.plot_mimetypes='image/png',
    jupyter.plot_scale=1
  )
}

UpAFR <- as.data.frame(rsIHA)
colnames(UpAFR) <- c("Inv")
rownames(UpAFR) <- UpAFR$Inv

UpAFR$BEAGLE <- sapply(UpAFR$Inv, function(x){
  if(!is.na(BEAGLE.Shapeit_Phase.Invs.AFR[x,"0.90"])){
    if(BEAGLE.Shapeit_Phase.Invs.AFR[x,"0.90"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpAFR$IMPUTE2 <- sapply(UpAFR$Inv, function(x){
  if(!is.na(Impute2.Shapeit_Phase.Invs.AFR[x,"0.90"])){
    if(Impute2.Shapeit_Phase.Invs.AFR[x,"0.90"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpAFR$IMPUTE5 <- sapply(UpAFR$Inv, function(x){
  if(!is.na(Impute5.Shapeit_Phase.Invs.AFR[x,"0.90"])){
    if(Impute5.Shapeit_Phase.Invs.AFR[x,"0.90"] >= 0.8){
      1
    } else {0}
  } else {0}
})



UpAFR$Minimac4 <- sapply(UpAFR$Inv, function(x){
  if(!is.na(Minimac4.Shapeit_Phase.Invs.AFR[x,"0.90"])){
    if(Minimac4.Shapeit_Phase.Invs.AFR[x,"0.90"] >= 0.8){
      1
    } else {0}
  } else {0}
})


UpAFR$scoreInvHap <- sapply(UpAFR$Inv, function(x){
  if(!is.na(ScoreInvHap.Invs.AFR[x,"R2"])){
    if(ScoreInvHap.Invs.AFR[x,"R2"] >= 0.8){
      1
    } else {0}
  } else {0}
})

softs = colnames(UpAFR)[2:length(colnames(UpAFR))]

png("UpSet_AFR_SP.png", height =3000, width = 6000)
set_size(5, 3)
(upset(UpAFR, softs, name = "Software", sort_intersections=FALSE,
      base_annotations = list(
        'Intersection size' = intersection_size(mapping=aes(fill='bars_color'),
                                                text_colors=c(
                                                  on_background='black', on_bar='black'),
                                                text = list(size = 40)
                                                ) + 
          scale_fill_manual(values=c('bars_color'='#ff8b8b'), guide='none') +
          scale_y_continuous(breaks = c(0,5,10), labels = c(0,5,10)) +
          ylab(substitute(paste("Imputable inversions (",italic("r\u00B2"),"  0.8)"))) +
          theme(axis.text = element_text(size = 120, color = "black"))
        ),
      matrix = intersection_matrix(geom = geom_point(size = 30),
                                   outline_color = list(active = "#4e8bff", inactive = "#4eb7ff")),
      #stripes = c("#F6F9FF", "#F6F9FF"),
      width_ratio = 0.2,
      set_sizes = (upset_set_size(geom = geom_bar(color = "#ff8b8b", fill = "#ff8b8b"))) +
        geom_text(aes(label=..count..), hjust=-0.4, stat='count', size = 40, color = "black") +
        ylim(45,0),
      intersections = list("scoreInvHap",
                           "Minimac4",
                           "IMPUTE5",
                           "IMPUTE2",
                           "BEAGLE",
                           c("scoreInvHap", "Minimac4"),
                           c("scoreInvHap", "IMPUTE5"),
                           c("scoreInvHap", "IMPUTE2"),
                           c("scoreInvHap", "BEAGLE"),
                           c("Minimac4", "IMPUTE5"),
                           c("Minimac4", "IMPUTE2"),
                           c("Minimac4", "BEAGLE"),
                           c("IMPUTE5", "IMPUTE2"),
                           c("IMPUTE5", "BEAGLE"),
                           c("IMPUTE2", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5"),
                           c("scoreInvHap", "Minimac4", "IMPUTE2"),
                           c("scoreInvHap", "Minimac4", "BEAGLE"),
                           c("scoreInvHap", "IMPUTE5", "IMPUTE2"),
                           c("scoreInvHap", "IMPUTE5", "BEAGLE"),
                           c("scoreInvHap", "IMPUTE2", "BEAGLE"),
                           c("Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("Minimac4", "IMPUTE5", "BEAGLE"),
                           c("Minimac4", "IMPUTE2", "BEAGLE"),
                           c("IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE2", "BEAGLE"),
                           c("scoreInvHap", "IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("Minimac4", "IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("IMPUTE5", "IMPUTE2", "BEAGLE", "Minimac4","scoreInvHap"),
                           'Outside of known sets'),
      sort_sets = F,
      stripes = upset_stripes(geom = geom_blank()),
      themes = upset_modify_themes(
        list(
          'intersections_matrix' = theme(axis.text=element_text(size=130, color = "black")),
          'overall_sizes'=theme(#axis.text.x=element_text(angle=90),
            axis.title = element_text(size = 120))
        )
      )
                                   
      ) & 
    theme(plot.background=element_rect(fill='#F6F9FF', color = '#F6F9FF'),
          # text = element_text(size = 50),
          # axis.text = element_text(size = 60, color = "black"),
          axis.title = element_text(size = 120, color = "black"),
          line = element_line(colour = NULL))
  )

dev.off()
```

### EAS
```{r}
set_size = function(w, h, factor=1.5) {
  s = 1 * factor
  options(
    repr.plot.width=w * s,
    repr.plot.height=h * s,
    repr.plot.res=100 / factor,
    jupyter.plot_mimetypes='image/png',
    jupyter.plot_scale=1
  )
}

UpEAS <- as.data.frame(rsIHS)
colnames(UpEAS) <- c("Inv")
rownames(UpEAS) <- UpEAS$Inv

UpEAS$BEAGLE <- sapply(UpEAS$Inv, function(x){
  if(!is.na(BEAGLE.Shapeit_Phase.Invs.EAS[x,"0.90"])){
    if(BEAGLE.Shapeit_Phase.Invs.EAS[x,"0.90"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpEAS$IMPUTE2 <- sapply(UpEAS$Inv, function(x){
  if(!is.na(Impute2.Shapeit_Phase.Invs.EAS[x,"0.90"])){
    if(Impute2.Shapeit_Phase.Invs.EAS[x,"0.90"] >= 0.8){
      1
    } else {0}
  } else {0}
})

UpEAS$IMPUTE5 <- sapply(UpEAS$Inv, function(x){
  if(!is.na(Impute5.Shapeit_Phase.Invs.EAS[x,"0.90"])){
    if(Impute5.Shapeit_Phase.Invs.EAS[x,"0.90"] >= 0.8){
      1
    } else {0}
  } else {0}
})



UpEAS$Minimac4 <- sapply(UpEAS$Inv, function(x){
  if(!is.na(Minimac4.Shapeit_Phase.Invs.EAS[x,"0.90"])){
    if(Minimac4.Shapeit_Phase.Invs.EAS[x,"0.90"] >= 0.8){
      1
    } else {0}
  } else {0}
})


UpEAS$scoreInvHap <- sapply(UpEAS$Inv, function(x){
  if(!is.na(ScoreInvHap.Invs.EAS[x,"R2"])){
    if(ScoreInvHap.Invs.EAS[x,"R2"] >= 0.8){
      1
    } else {0}
  } else {0}
})

softs = colnames(UpEAS)[2:length(colnames(UpEAS))]

png("UpSet_EAS_SP.png", height =3000, width = 6000)
set_size(5, 3)
(upset(UpEAS, softs, name = "Software", sort_intersections=FALSE,
      base_annotations = list(
        'Intersection size' = intersection_size(mapping=aes(fill='bars_color'),
                                                text_colors=c(
                                                  on_background='black', on_bar='black'),
                                                text = list(size = 40)
                                                ) + 
          scale_fill_manual(values=c('bars_color'='#ff8b8b'), guide='none') +
          ylab(substitute(paste("Imputable inversions (",italic("r\u00B2"),"  0.8)"))) +
          theme(axis.text = element_text(size = 120, color = "black"))
        ),
      matrix = intersection_matrix(geom = geom_point(size = 30),
                                   outline_color = list(active = "#4e8bff", inactive = "#4eb7ff")),
      #stripes = c("#F6F9FF", "#F6F9FF"),
      width_ratio = 0.2,
      set_sizes = (upset_set_size(geom = geom_bar(color = "#ff8b8b", fill = "#ff8b8b"))) +
        geom_text(aes(label=..count..), hjust=-0.4, stat='count', size = 40, color = "black") +
        ylim(45,0),
      intersections = list("scoreInvHap",
                           "Minimac4",
                           "IMPUTE5",
                           "IMPUTE2",
                           "BEAGLE",
                           c("scoreInvHap", "Minimac4"),
                           c("scoreInvHap", "IMPUTE5"),
                           c("scoreInvHap", "IMPUTE2"),
                           c("scoreInvHap", "BEAGLE"),
                           c("Minimac4", "IMPUTE5"),
                           c("Minimac4", "IMPUTE2"),
                           c("Minimac4", "BEAGLE"),
                           c("IMPUTE5", "IMPUTE2"),
                           c("IMPUTE5", "BEAGLE"),
                           c("IMPUTE2", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5"),
                           c("scoreInvHap", "Minimac4", "IMPUTE2"),
                           c("scoreInvHap", "Minimac4", "BEAGLE"),
                           c("scoreInvHap", "IMPUTE5", "IMPUTE2"),
                           c("scoreInvHap", "IMPUTE5", "BEAGLE"),
                           c("scoreInvHap", "IMPUTE2", "BEAGLE"),
                           c("Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("Minimac4", "IMPUTE5", "BEAGLE"),
                           c("Minimac4", "IMPUTE2", "BEAGLE"),
                           c("IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5", "IMPUTE2"),
                           c("scoreInvHap", "Minimac4", "IMPUTE5", "BEAGLE"),
                           c("scoreInvHap", "Minimac4", "IMPUTE2", "BEAGLE"),
                           c("scoreInvHap", "IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("Minimac4", "IMPUTE5", "IMPUTE2", "BEAGLE"),
                           c("IMPUTE5", "IMPUTE2", "BEAGLE", "Minimac4","scoreInvHap"),
                           'Outside of known sets'),
      sort_sets = F,
      stripes = upset_stripes(geom = geom_blank()),
      themes = upset_modify_themes(
        list(
          'intersections_matrix' = theme(axis.text=element_text(size=130, color = "black")),
          'overall_sizes'=theme(#axis.text.x=element_text(angle=90),
            axis.title = element_text(size = 120))
        )
      )
                                   
      ) & 
    theme(plot.background=element_rect(fill='#F6F9FF', color = '#F6F9FF'),
          # text = element_text(size = 50),
          # axis.text = element_text(size = 60, color = "black"),
          axis.title = element_text(size = 120, color = "black"),
          line = element_line(colour = NULL))
  )

dev.off()
```
